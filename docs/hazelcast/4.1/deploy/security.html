<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Security :: Hazelcast Documentation</title>
    <link rel="canonical" href="https://JakeSCahill.github.io/hazelcast/4.1/deploy/security.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=GTM-M267KFN"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','GTM-M267KFN')</script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://JakeSCahill.github.io">Hazelcast Documentation</a>
        <div class="navbar-item">
          <input id="search-input" type="text" placeholder="Search docs">
        </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Hazelcast IMDG</a>
            <a class="navbar-item" href="#">Hazelcast Jet</a>
            <a class="navbar-item" href="#">Hazelcast Cloud</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Use cases</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Demos</a>
            <a class="navbar-item" href="#">GitHub</a>
            <a class="navbar-item" href="#">Community</a>
            <a class="navbar-item" href="#">Blog</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="hazelcast" data-version="4.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../hazelcast_overview.html">Hazelcast IMDG</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../hazelcast_overview.html">Overview</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../get-started/getting_started.html">Get Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../get-started/glossary.html">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../develop/hazelcast_clients.html">Develop Solutions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/jcache.html">JCache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/performance.html">Performance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/serialization.html">Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/striim_cdc.html">Striim Hot Cache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/transactions.html">Transactions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/distributed_query.html">Distributed Query</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/distributed_sql.html">Distributed SQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/distributed_events.html">Distributed Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/distributed_computing.html">Distributed Computing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="installing_upgrading.html">Deploy Clusters</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="starting_members_clients.html">Starting Members and Clients</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="setting_up_clusters.html">Setting Up Clusters</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="management.html">Management</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="simulator.html">Hazelcast Simulator</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="wan.html">WAN Replication</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="network_partitioning.html">Network Partitioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../migrate/migration_guides.html">Migrate</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../troubleshoot/common_exception_types.html">Troubleshooting</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../reference/faq.html">Reference</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/dds.html">Distributed data structures</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/system_properties.html">System properties</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/understanding_configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/phone_homes.html">Phone homes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/hazelcast_plugins.html">Plugins</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../contribute/extending_hazelcast.html">Contribute</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../contribute/licenses.html">Licenses</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../contribute/revision_history.html">Documentation changes</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Hazelcast IMDG</span>
    <span class="version">4.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Hazelcast IMDG</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../hazelcast_overview.html">4.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../preface.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../hazelcast_overview.html">Hazelcast IMDG</a></li>
    <li><a href="installing_upgrading.html">Deploy Clusters</a></li>
    <li><a href="security.html">Security</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a class="git" href="https://github.com/JakeSCahill/docs-poc/edit/master/hazelcast-docs/modules/deploy/pages/security.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Security</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise Feature</strong></p>
</div>
<div class="paragraph">
<p>This chapter describes the security features of Hazelcast.
These features allow you to perform security activities, such as
intercepting socket connections and remote operations executed by
the clients, encrypting the communications between the members at socket
level and using SSL socket communication. All of the Security features
explained in this chapter are the features of <span class="blue">Hazelcast IMDG Enterprise</span>
edition.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_jaas_security"><a class="anchor" href="#_enabling_jaas_security"></a>Enabling JAAS Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With Hazelcast&#8217;s extensible, JAAS based security feature, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>authenticate both cluster members and clients</p>
</li>
<li>
<p>and perform access control checks on client operations.
Access control can be done according to endpoint principal
and/or endpoint address.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can enable security declaratively or programmatically,
as shown below.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;security enabled="true"&gt;
    ...
    &lt;/security&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  security:
    enabled: true</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Config cfg = new Config();
SecurityConfig securityCfg = cfg.getSecurityConfig();
securityCfg.setEnabled( true );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, see the <a href="#setting-the-license-key">Setting License Key section</a>
for information on how to set your <span class="blue">Hazelcast IMDG Enterprise</span>
license.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_socket_interceptor"><a class="anchor" href="#_socket_interceptor"></a>Socket Interceptor</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hazelcast allows you to intercept socket connections before a member
joins a cluster or a client connects to a member of a cluster.
This allow you to add custom hooks to join and perform connection
procedures (like identity checking using a
custom network authentication protocol, etc.).</p>
</div>
<div class="paragraph">
<p>To use the socket interceptor, implement <code>com.hazelcast.nio.MemberSocketInterceptor</code>
for members and <code>com.hazelcast.nio.SocketInterceptor</code> for clients.</p>
</div>
<div class="paragraph">
<p>The following is an example socket interceptor implementation for the member side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    public static class MySocketInterceptor implements MemberSocketInterceptor {

        private String memberId;

        public MySocketInterceptor() {
        }

        @Override
        public void onAccept(Socket socket) throws IOException {
            socket.getOutputStream().write(memberId.getBytes());
            byte[] bytes = new byte[1024];
            int len = socket.getInputStream().read(bytes);
            String otherMemberId = new String(bytes, 0, len);
            if (!otherMemberId.equals("secondMember")) {
                throw new RuntimeException("Not a known member!!!");
            }
        }

        @Override
        public void init(Properties properties) {
            memberId = properties.getProperty("member-id");
        }

        @Override
        public void onConnect(Socket socket) throws IOException {
            socket.getOutputStream().write(memberId.getBytes());
            byte[] bytes = new byte[1024];
            int len = socket.getInputStream().read(bytes);
            String otherMemberId = new String(bytes, 0, len);
            if (!otherMemberId.equals("firstMember")) {
                throw new RuntimeException("Not a known member!!!");
            }
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can declaratively configure this socket interceptor as follows:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;network&gt;
        &lt;socket-interceptor enabled="true"&gt;
            &lt;class-name&gt;com.hazelcast.examples.MySocketInterceptor&lt;/class-name&gt;
            &lt;properties&gt;
                &lt;property name="property1"&gt;value1&lt;/property&gt;
                &lt;property name="property2"&gt;value2&lt;/property&gt;
                &lt;property name=foo&gt;bar&lt;/property&gt;
            &lt;/properties&gt;
        &lt;/socket-interceptor&gt;
    &lt;/network&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  network:
    socket-interceptor:
        enabled: true
        class-name: com.hazelcast.examples.MySocketInterceptor
        properties:
          property1: value1
          property2: value2
          foo: bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example configuration of the above socket
interceptor for the client side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">    public static void main(String[] args) {

        Config config = createConfig();
        Hazelcast.newHazelcastInstance(config);

        ClientConfig clientConfig = createClientConfig();
        HazelcastClient.newHazelcastClient(clientConfig);
    }

    private static Config createConfig() {
        Config config = new Config();
        //config.setLicenseKey(ENTERPRISE_LICENSE_KEY);
        config.setProperty("hazelcast.wait.seconds.before.join", "0");

        SocketInterceptorConfig interceptorConfig = new SocketInterceptorConfig();
        interceptorConfig.setEnabled(true).setClassName(MySocketInterceptor.class.getName());
        config.getNetworkConfig().setSocketInterceptorConfig(interceptorConfig);

        return config;
    }

    private static ClientConfig createClientConfig() {
        ClientConfig clientConfig = new ClientConfig();
        //clientConfig.setLicenseKey(ENTERPRISE_LICENSE_KEY);
        SocketInterceptorConfig interceptorConfig = new SocketInterceptorConfig();
        interceptorConfig.setEnabled(true).setClassName(MySocketInterceptor.class.getName());
        clientConfig.getNetworkConfig().setSocketInterceptorConfig(interceptorConfig);
        return clientConfig;
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security_interceptor"><a class="anchor" href="#_security_interceptor"></a>Security Interceptor</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hazelcast allows you to intercept every remote operation executed
by the client. This lets you add a very flexible custom security logic.
To do this, implement <code>com.hazelcast.security.SecurityInterceptor</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">    private static class MySecurityInterceptor implements SecurityInterceptor {

        @Override
        public void before(Credentials credentials, String objectType, String objectName, String methodName,
                           Parameters parameters) throws AccessControlException {
            if (objectName.equals(DENIED_MAP_NAME)) {
                throw new RuntimeException("Denied Map!!!");
            }
            if (methodName.equals(DENIED_METHOD)) {
                throw new RuntimeException("Denied Method!!!");
            }
            Object firstParam = parameters.get(0);
            Object secondParam = parameters.get(1);
            if (firstParam.equals(DENIED_KEY)) {
                throw new RuntimeException("Denied Key!!!");
            }
            if (secondParam.equals(DENIED_VALUE)) {
                throw new RuntimeException("Denied Value!!!");
            }
        }

        @Override
        public void after(Credentials credentials, String objectType, String objectName, String methodName,
                          Parameters parameters) {
            System.err.println("qwe c: " + credentials + "\t\tt: " + objectType + "\t\tn: " + objectName
                    + "\t\tm: " + methodName + "\t\tp1: " + parameters.get(0) + "\t\tp2: " + parameters.get(1));
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>before</code> method is called before processing the request on the
remote server. The <code>after</code> method is called after the processing.
Exceptions thrown while executing the <code>before</code> method are propagated
to the client, but exceptions thrown while executing the <code>after</code> method
are suppressed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_encryption"><a class="anchor" href="#_encryption"></a>Encryption</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hazelcast offers features which allow to reach a required privacy on
communication level by enabling encryption. Encryption is based on
<a href="http://java.sun.com/javase/6/docs/technotes/guides/security/crypto/CryptoSpec.html" target="_blank" rel="noopener">Java Cryptography Architecture</a> (JCA).</p>
</div>
<div class="paragraph">
<p>There are two different encryption features:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>TLS protocol</p>
<div class="ulist">
<ul>
<li>
<p>transport level encryption</p>
</li>
<li>
<p>supported by members and clients</p>
</li>
<li>
<p>TCP-only, i.e., multicast join messages are not encrypted</p>
<div class="paragraph">
<p>More details in the <a href="#tlsssl">TLS/SSL section</a></p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Symmetric encryption for Hazelcast member protocol</p>
<div class="ulist">
<ul>
<li>
<p>only supported by the members; communication with clients is not encrypted</p>
</li>
<li>
<p>multicast join messages are encrypted, too</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The preferred and recommended feature is the TLS protocol as it&#8217;s a
standard way how to protect communication on transport level:
Both TLS and symmetric encryption are for encrypting the network traffic.
TLS is already superior to symmetric encryption on more than one aspects as seen
above. Symmetric encryption is only supported in member-member communication while
TLS can encrypt client communications as well. When there is no specific reason to use
symmetric encryption, we recommend you to use the TLS protocol.</p>
</div>
<div class="paragraph">
<p>Symmetric encryption for Hazelcast member protocol can be configured
with cipher algorithms implemented by security providers and accessed
through Java Cryptography Architecture.
Check documentation of your Java version to learn about supported algorithm
names. The following are some examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AES</code></p>
</li>
<li>
<p><code>PBEWithMD5AndDES</code></p>
</li>
<li>
<p><code>DES/ECB/PKCS5Padding</code></p>
</li>
<li>
<p><code>Blowfish</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hazelcast uses <code>MD5</code> message-digest algorithm as the cryptographic
hash function. You can also use the salting process by giving a salt
and password which are then concatenated and processed with <code>MD5</code>, and
the resulting output is stored with the salt.</p>
</div>
<div class="paragraph">
<p>In symmetric encryption, each member uses the same key, so the key is
shared. Here is an example configuration for symmetric encryption.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;network&gt;
        &lt;symmetric-encryption enabled="true"&gt;
            &lt;algorithm&gt;AES&lt;/algorithm&gt;
            &lt;salt&gt;thesalt&lt;/salt&gt;
            &lt;password&gt;thepass&lt;/password&gt;
            &lt;iteration-count&gt;175&lt;/iteration-count&gt;
        &lt;/symmetric-encryption&gt;
    &lt;/network&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  network:
    symmetric-encryption:
      enabled: true
      algorithm: AES
      salt: thesalt
      password: thepass
      iteration-count: 175</code></pre>
</div>
</div>
<div class="paragraph">
<p>You set the encryption algorithm, the salt, password and the iteration count to be used
for generating the secret key. You also need to set the <code>enabled</code> attribute to <code>true</code>.
Note that all members should have the same encryption configuration.</p>
</div>
<div class="paragraph">
<p>Since symmetric encryption relies on JCA, you can additionally benefit from the
algorithms provided by the Bouncy Castle Crypto APIs. For this,
you need to set the <code>hazelcast.security.bouncy.enabled</code> property to <code>true</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tlsssl"><a class="anchor" href="#tlsssl"></a>TLS/SSL</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You cannot use TLS/SSL when <a href="#encryption">Hazelcast Encryption</a>
is enabled.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can use the SSL (Secure Sockets Layer)
protocol to establish an encrypted communication
across your Hazelcast cluster with key stores and trust stores. Note that, if
you are developing applications using Java 8, you will be using its
successor TLS (Transport Layer Security).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is NOT recommended to reuse the key stores and trust stores
for external applications.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_tlsssl_for_hazelcast_members"><a class="anchor" href="#_tlsssl_for_hazelcast_members"></a>TLS/SSL for Hazelcast Members</h3>
<div class="paragraph">
<p>Hazelcast allows you to encrypt socket level communication between
Hazelcast members and between Hazelcast clients and members, for end
to end encryption. To use it, you need to implement
<code>com.hazelcast.nio.ssl.SSLContextFactory</code> and configure the SSL section
in the network configuration.</p>
</div>
<div class="paragraph">
<p>The following is the implementation code snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MySSLContextFactory implements SSLContextFactory {
    public void init( Properties properties ) throws Exception {
    }

    public SSLContext getSSLContext() {
        ...
        SSLContext sslCtx = SSLContext.getInstance( "the protocol to be used" );
        return sslCtx;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is the base declarative configuration for the
implemented <code>SSLContextFactory</code>:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;network&gt;
        &lt;ssl enabled="true"&gt;
            &lt;factory-class-name&gt;
                com.hazelcast.examples.MySSLContextFactory
            &lt;/factory-class-name&gt;
            &lt;properties&gt;
                &lt;property name="foo"&gt;bar&lt;/property&gt;
            &lt;/properties&gt;
        &lt;/ssl&gt;
    &lt;/network&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  network:
    ssl:
      enabled: true
      factory-class-name: com.hazelcast.examples.MySSLContextFactory
      properties:
        foo: bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hazelcast provides a default SSLContextFactory,
<code>com.hazelcast.nio.ssl.BasicSSLContextFactory</code>, which uses the configured
keystore to initialize <code>SSLContext</code>; see the following example configuration
for TLS/SSL.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;network&gt;
        &lt;ssl enabled="true"&gt;
            &lt;factory-class-name&gt;
                com.hazelcast.nio.ssl.BasicSSLContextFactory
            &lt;/factory-class-name&gt;
            &lt;properties&gt;
                &lt;property name="protocol"&gt;TLSv1.2&lt;/property&gt;
                &lt;property name="mutualAuthentication"&gt;REQUIRED&lt;/property&gt;
                &lt;property name="keyStore"&gt;/opt/hazelcast-keystore.p12&lt;/property&gt;
                &lt;property name="keyStorePassword"&gt;secret.123&lt;/property&gt;
                &lt;property name="keyStoreType"&gt;PKCS12&lt;/property&gt;
                &lt;property name="trustStore"&gt;/opt/hazelcast-truststore.p12&lt;/property&gt;
                &lt;property name="trustStorePassword"&gt;changeit&lt;/property&gt;
                &lt;property name="trustStoreType"&gt;PKCS12&lt;/property&gt;
            &lt;/properties&gt;
        &lt;/ssl&gt;
    &lt;/network&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  network:
    ssl:
      enabled: true
      factory-class-name: com.hazelcast.nio.ssl.BasicSSLContextFactory
      properties:
        protocol: TLSv1.2
        mutualAuthentication: REQUIRED
        keyStore: /opt/hazelcast-keystore.p12
        keyStorePassword: secret.123
        keyStoreType: PKCS12
        trustStore: /opt/hazelcast-truststore.p12
        trustStorePassword: changeit
        trustStoreType: PKCS12</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following are the descriptions of the properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>keyStore</code>: Path of your keystore file.</p>
</li>
<li>
<p><code>keyStorePassword</code>: Password to access the key from your
keystore file.</p>
</li>
<li>
<p><code>keyManagerAlgorithm</code>: Name of the algorithm based on which
the authentication keys are provided.</p>
</li>
<li>
<p><code>keyStoreType</code>: Type of the keystore. Its default value is <code>JKS</code>.
Another commonly used type is the <code>PKCS12</code>. Available keystore/truststore
types depend on your Operating system and the Java runtime.</p>
</li>
<li>
<p><code>trustStore</code>: Path of your truststore file. The file truststore is a
keystore file that contains a collection of certificates trusted by your
application.</p>
</li>
<li>
<p><code>trustStorePassword</code>: Password to unlock the truststore file.</p>
</li>
<li>
<p><code>trustManagerAlgorithm</code>: Name of the algorithm based on which the
trust managers are provided.</p>
</li>
<li>
<p><code>trustStoreType</code>: Type of the truststore. Its default value is <code>JKS</code>.
Another commonly used type is the <code>PKCS12</code>. Available keystore/truststore
types depend on your Operating system and the Java runtime.</p>
</li>
<li>
<p><code>mutualAuthentication</code>: Mutual authentication configuration. It&#8217;s empty
by default which means the client side of connection is not authenticated.
Available values are:</p>
<div class="ulist">
<ul>
<li>
<p><code>REQUIRED</code> - server forces usage of a trusted client certificate</p>
</li>
<li>
<p><code>OPTIONAL</code> - server asks for a client certificate, but it doesn&#8217;t
require it</p>
<div class="paragraph">
<p>See the <a href="#mutual-authentication">Mutual Authentication section</a>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>ciphersuites</code>: Comma-separated list of cipher suite names allowed
to be used. Its default value are all supported suites in your Java runtime.</p>
</li>
<li>
<p><code>protocol</code>: Name of the algorithm which is used in your TLS/SSL. Its
default value is <code>TLS</code>. Available values are:</p>
<div class="ulist">
<ul>
<li>
<p><code>TLS</code></p>
</li>
<li>
<p><code>TLSv1</code></p>
</li>
<li>
<p><code>TLSv1.1</code></p>
</li>
<li>
<p><code>TLSv1.2</code></p>
</li>
<li>
<p><code>TLSv1.3</code></p>
<div class="paragraph">
<p>For the <code>protocol</code> property, we recommend you to provide TLS with its
version information, e.g., <code>TLSv1.2</code>. Note that if you write only <code>TLS</code>,
your application chooses the TLS version according to your Java version.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>validateIdentity</code>: Flag which allows enabling endpoint identity validation. It means, during the TLS handshake client verifies if the server&#8217;s hostname (or IP address) matches the information in X.509 certificate (Subject Alternative Name extension). Possible values are <code>"true"</code> and <code>"false"</code> (default).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_tlsssl_for_hazelcast_clients"><a class="anchor" href="#_tlsssl_for_hazelcast_clients"></a>TLS/SSL for Hazelcast Clients</h3>
<div class="paragraph">
<p>The TLS configuration in Hazelcast clients is very similar to member configuration.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast-client&gt;
    ...
    &lt;network&gt;
        &lt;ssl enabled="true"&gt;
            &lt;factory-class-name&gt;
                com.hazelcast.nio.ssl.BasicSSLContextFactory
            &lt;/factory-class-name&gt;
            &lt;properties&gt;
                &lt;property name="protocol"&gt;TLSv1.2&lt;/property&gt;
                &lt;property name="trustStore"&gt;/opt/hazelcast-client.truststore&lt;/property&gt;
                &lt;property name="trustStorePassword"&gt;changeit&lt;/property&gt;
                &lt;property name="trustStoreType"&gt;JKS&lt;/property&gt;

                &lt;!-- Following properties are only needed when the mutual authentication is used. --&gt;
                &lt;property name="keyStore"&gt;/opt/hazelcast-client.keystore&lt;/property&gt;
                &lt;property name="keyStorePassword"&gt;clientsSecret&lt;/property&gt;
                &lt;property name="keyStoreType"&gt;JKS&lt;/property&gt;
            &lt;/properties&gt;
        &lt;/ssl&gt;
    &lt;/network&gt;
    ...
&lt;/hazelcast-client&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast-client:
  network:
    ssl:
      enabled: true
      factory-class-name: com.hazelcast.nio.ssl.BasicSSLContextFactory
      properties:
        protocol: TLSv1.2

        trustStore: /opt/hazelcast-client.truststore
        trustStorePassword: changeit
        trustStoreType: JKS

        # Following properties are only needed when the mutual authentication is used.
        keyStore: /opt/hazelcast-client.keystore
        keyStorePassword: clientsSecret
        keyStoreType: JKS</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same <code>BasicSSLContextFactory</code> properties used for members are available
on clients.
Clients don&#8217;t need to set <code>mutualAuthentication</code> property as it&#8217;s used in
configuring the server side of TLS connections.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mutual_authentication"><a class="anchor" href="#_mutual_authentication"></a>Mutual Authentication</h3>
<div class="paragraph">
<p>TLS connections have two sides: the one opening the connection (TLS client)
and the one accepting the connection (TLS server).
By default only the TLS server proves its identity by presenting a certificate
to the TLS client.
The mutual authentication means that also the TLS clients prove their identity
to the TLS servers.</p>
</div>
<div class="paragraph">
<p>Hazelcast members can be on both sides of TLS connection - TLS servers
and TLS clients.
Hazelcast clients are always on the client side of a TLS connection.</p>
</div>
<div class="paragraph">
<p>By default Hazelcast members have keyStore used to identify themselves
to the clients and other members.
Both Hazelcast members and Hazelcast clients have trustStore used to define
which members they can trust.</p>
</div>
<div class="paragraph">
<p>When the mutual authentication feature is enabled, Hazelcast clients
need to provide keyStore.
A client proves its identity by providing its certificate to the Hazelcast
member it&#8217;s connecting to.
The member only accepts the connection if the client&#8217;s certificate is
present in the member&#8217;s trustStore.</p>
</div>
<div class="paragraph">
<p>To enable the mutual authentication, set the <code>mutualAuthentication</code> property
value to <code>REQUIRED</code> on the member side, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">Config cfg = new Config();
Properties props = new Properties();

props.setProperty("mutualAuthentication", "REQUIRED");
props.setProperty("keyStore", "/opt/hazelcast.keystore");
props.setProperty("keyStorePassword", "123456");
props.setProperty("trustStore", "/opt/hazelcast.truststore");
props.setProperty("trustStorePassword", "123456");

cfg.getNetworkConfig().setSSLConfig(new SSLConfig().setEnabled(true).setProperties(props));
Hazelcast.newHazelcastInstance(cfg);</code></pre>
</div>
</div>
<div class="paragraph">
<p>And on the client side, you need to set client identity
by providing the keystore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">clientSslProps.setProperty("keyStore", "/opt/client.keystore");
clientSslProps.setProperty("keyStorePassword", "123456");</code></pre>
</div>
</div>
<div class="paragraph">
<p>The property <code>mutualAuthentication</code> has the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>REQUIRED</code>: Server asks for client certificate. If the client
does not provide a keystore or the provided keystore is not verified
against member&#8217;s truststore, the client is not authenticated.</p>
</li>
<li>
<p><code>OPTIONAL</code>: Server asks for client certificate, but client is not
required to provide any valid certificate.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When a new client is introduced with a new keystore, the
truststore on the member side should be updated accordingly to
include new clients' information to be able to accept it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the below example snippet to see the full configuration on the
client side:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">ClientConfig config = new ClientConfig();
Properties clientSslProps = new Properties();
clientSslProps.setProperty("keyStore", "/opt/client.keystore");
clientSslProps.setProperty("keyStorePassword", "123456");
clientSslProps.setProperty("trustStore", "/opt/client.truststore");
clientSslProps.setProperty("trustStorePassword", "123456");

config.getNetworkConfig().setSSLConfig(new SSLConfig().setEnabled(true).setProperties(clientSslProps));
HazelcastClient.newHazelcastClient(config);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the mutual authentication is not required, the Hazelcast members accept all
incoming TLS connections without verifying if the connecting side is trusted.
Therefore it&#8217;s recommended to require the mutual authentication in Hazelcast
members configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tlsssl_performance_improvements_for_java"><a class="anchor" href="#_tlsssl_performance_improvements_for_java"></a>TLS/SSL Performance Improvements for Java</h3>
<div class="paragraph">
<p>TLS/SSL can have a significant impact on performance. There are a few ways to
increase the performance.</p>
</div>
<div class="paragraph">
<p>The first thing that can be done is making sure that AES intrinsics are used.
Modern CPUs (2010 or newer Westmere) have hardware support for AES encryption/decryption
and if a Java 8 or newer JVM is
used, the JIT automatically makes use of these AES intrinsics. They can also be
explicitly enabled using <code>-XX:+UseAES -XX:+UseAESIntrinsics</code>,
or disabled using <code>-XX:-UseAES -XX:-UseAESIntrinsics</code>.</p>
</div>
<div class="paragraph">
<p>A lot of encryption algorithms make use of padding because they encrypt/decrypt in
fixed sized blocks. If there is no enough data
for a block, the algorithm relies on random number generation to pad. Under Linux,
the JVM automatically makes use of <code>/dev/random</code> for
the generation of random numbers. <code>/dev/random</code> relies on entropy to be able to
generate random numbers. However, if this entropy is
insufficient to keep up with the rate requiring random numbers, it can slow down
the encryption/decryption since <code>/dev/random</code> will
block; it could block for minutes waiting for sufficient entropy . This can be fixed
by setting the <code>-Djava.security.egd=file:/dev/./urandom</code> system property.
For a more permanent solution, modify the
<code>&lt;JAVA_HOME&gt;/jre/lib/security/java.security</code> file, look for the
<code>securerandom.source=/dev/urandom</code> and change it
to <code>securerandom.source=file:/dev/./urandom</code>. Switching to <code>/dev/urandom</code> could
be controversial because <code>/dev/urandom</code> will not
block if there is a shortage of entropy and the returned random values could
theoretically be vulnerable to a cryptographic attack.
If this is a concern in your application, use <code>/dev/random</code> instead.</p>
</div>
<div class="paragraph">
<p>Hazelcast&#8217;s Java smart client automatically makes use of extra I/O threads
for encryption/decryption and this have a significant impact on the performance.
This can be changed using the <code>hazelcast.client.io.input.thread.count</code> and
<code>hazelcast.client.io.output.thread.count</code> client system properties.
By default it is 1 input thread and 1 output thread. If TLS/SSL is enabled,
it defaults to 3 input threads and 3 output threads.
Having more client I/O threads than members in the cluster does not lead to
an increased performance. So with a 2-member cluster,
2 in and 2 out threads give the best performance.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integrating_openssl_boringssl"><a class="anchor" href="#_integrating_openssl_boringssl"></a>Integrating OpenSSL / BoringSSL</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You cannot integrate OpenSSL into Hazelcast when <a href="#encryption">Hazelcast Encryption</a>
is enabled.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>TLS/SSL in Java is normally provided by the JRE. However, the performance overhead can be
significant; even with AES intrinsics
enabled. If you are using a x86_64 system (Linux, Mac, Windows), Hazelcast supports native
integration for TLS/SSL which can provide significant performance
improvements. There are two supported native TLS/SSL libraries available through
<a href="https://netty.io/wiki/forked-tomcat-native.html" target="_blank" rel="noopener">netty-tcnative</a> libraries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OpenSSL</p>
<div class="ulist">
<ul>
<li>
<p>dynamically linked</p>
</li>
<li>
<p>prerequisites: <code>libapr</code>, <code>openssl</code> packages installed on your system</p>
</li>
</ul>
</div>
</li>
<li>
<p>BoringSSL - Google managed fork of the OpenSSL</p>
<div class="ulist">
<ul>
<li>
<p>statically linked</p>
</li>
<li>
<p>easier to get started with</p>
</li>
<li>
<p>benefits: reduced code footprint, additional features</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The native TLS integration can be used on clients and/or members. For best performance, it
is recommended to install on a client and member and
configure the appropriate cipher suite(s).</p>
</div>
<div class="paragraph">
<p>Check the <a href="https://netty.io/wiki/forked-tomcat-native.html" target="_blank" rel="noopener">netty-tcnative</a> page
for installation details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the Java version is
less than 11 and OpenSSL capabilities are detected
(also the appropriate Java libraries are included) and if no
explicit <code>SSLEngineFactory</code> is set, Hazelcast IMDG defaults to use OpenSSL.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_netty_libraries"><a class="anchor" href="#_netty_libraries"></a>Netty Libraries</h3>
<div class="paragraph">
<p>For the native TLS/SSL integration in Java, the <a href="https://netty.io/" target="_blank" rel="noopener">Netty</a> library is used.</p>
</div>
<div class="paragraph">
<p>Make sure the following libraries from the Netty framework are on the classpath:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>netty-handler</code> and its dependencies</p>
</li>
<li>
<p>one of <code>tc-native</code> implementations</p>
<div class="ulist">
<ul>
<li>
<p>either BoringSSL: <code>netty-tcnative-boringssl-static-{tcnative_version}.jar</code></p>
</li>
<li>
<p>or OpenSSL: <code>netty-tcnative-{tcnative_version}-{os_arch}.jar</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is very important that the version of Netty JAR(s) corresponds to
a very specific version of <code>netty-tcnative</code>. In case of doubt, the
simplest thing to do is to download the <code>netty-&lt;version&gt;.tar.bz2</code> file
from the <a href="https://netty.io/downloads.html" target="_blank" rel="noopener">Netty</a> website and check which
<code>netty-tcnative</code> version is used for that Netty release.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_using_boringssl"><a class="anchor" href="#_using_boringssl"></a>Using BoringSSL</h3>
<div class="paragraph">
<p>The statically linked BoringSSL binaries are included within the <code>netty-tcnative</code>
libraries. There is no need to install additional software on supported systems.</p>
</div>
<div class="paragraph">
<p>Example Maven dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.netty&lt;/groupId&gt;
        &lt;artifactId&gt;netty-tcnative-boringssl-static&lt;/artifactId&gt;
        &lt;version&gt;2.0.12.Final&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.netty&lt;/groupId&gt;
        &lt;artifactId&gt;netty-handler&lt;/artifactId&gt;
        &lt;version&gt;4.1.27.Final&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_openssl"><a class="anchor" href="#_using_openssl"></a>Using OpenSSL</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install OpenSSL. Make sure that you are installing 1.0.1 or newer release.
See its documentation at
<a href="https://github.com/openssl/openssl/blob/master/INSTALL.md" target="_blank" rel="noopener">github.com/openssl</a>.</p>
</li>
<li>
<p>Install Apache Portable Runtime (APR) library. See <a href="https://apr.apache.org/download.cgi" target="_blank" rel="noopener">apr.apache.org</a>.</p>
<div class="paragraph">
<p>For RHEL: <code>sudo yum -y install apr openssl</code></p>
</div>
<div class="paragraph">
<p>For Ubuntu: <code>sudo apt-get -y install libapr1 openssl</code></p>
</div>
<div class="paragraph">
<p>For Alpine Linux: <code>apk add --update apr openssl</code></p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Example Maven dependencies (for Linux):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.netty&lt;/groupId&gt;
        &lt;artifactId&gt;netty-tcnative&lt;/artifactId&gt;
        &lt;version&gt;2.0.12.Final&lt;/version&gt;
        &lt;classifier&gt;linux-x86_64&lt;/classifier&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.netty&lt;/groupId&gt;
        &lt;artifactId&gt;netty-handler&lt;/artifactId&gt;
        &lt;version&gt;4.1.27.Final&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_hazelcast_for_openssl"><a class="anchor" href="#_configuring_hazelcast_for_openssl"></a>Configuring Hazelcast for OpenSSL</h3>
<div class="paragraph">
<p>Configuring OpenSSL in Hazelcast is straight forward. On the client and/or
member side, the following snippet enables TLS/SSL
using OpenSSL:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;network&gt;
        &lt;ssl enabled="true"&gt;
            &lt;factory-class-name&gt;com.hazelcast.nio.ssl.OpenSSLEngineFactory&lt;/factory-class-name&gt;
            &lt;properties&gt;
                &lt;property name="protocol"&gt;TLSv1.2&lt;/property&gt;
                &lt;property name="trustCertCollectionFile"&gt;trusted-certs.pem&lt;/property&gt;
                 &lt;!-- If the TLS mutual authentication is not used,
                     then the key configuration is not needed on the client side. --&gt;
                &lt;property name="keyFile"&gt;privkey.pem&lt;/property&gt;
                &lt;property name="keyCertChainFile"&gt;chain.pem&lt;/property&gt;
            &lt;/properties&gt;
        &lt;/ssl&gt;
    &lt;/network&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yml hljs" data-lang="yml">hazelcast:
  network:
    ssl:
      enabled: true
      factory-class-name: com.hazelcast.nio.ssl.OpenSSLEngineFactory
      properties:
        protocol: TLSv1.2
        trustCertCollectionFile: trusted-certs.pem

        # If the TLS mutual authentication is not used, following lines (key configuration) are not needed on the client side.
        keyFile: privkey.pem
        keyCertChainFile: chain.pem</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration is similar to a regular TLS/SSL integration. The main differences
are the <code>OpenSSLEngineFactory</code> factory class and the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>keyFile</code>: Path of your PKCS#8 key file in PEM format.</p>
</li>
<li>
<p><code>keyPassword</code>: Password to access the key file when it&#8217;s encrypted.</p>
</li>
<li>
<p><code>keyCertChainFile</code>: Path to an X.509 certificate chain file in PEM format.</p>
</li>
<li>
<p><code>trustCertCollectionFile</code>: Path to an X.509 certificate collection file in PEM format.</p>
</li>
<li>
<p><code>fipsMode</code>: Boolean flag to switch OpenSSL into the FIPS mode. See the <a href="#fips-140-2">FIPS 140-2 section</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The key and certificate related properties take precedence over keyStore and
trustStore configurations.
Using keyStores and trustStores together with OpenSSL causes problems on some
Java versions, therefore we recommend to use the OpenSSL native way.</p>
</div>
<div class="paragraph">
<p>The following are the other supported properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>keyStore</code>: Path of your keystore file.</p>
<div class="ulist">
<ul>
<li>
<p><em>Using the <code>keyStore</code> property is not recommended, use <code>keyFile</code> and
<code>keyCertChainFile</code> instead</em></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>keyStorePassword</code>: Password to access the key from your keystore file.</p>
</li>
<li>
<p><code>keyStoreType</code>: Type of the keystore. Its default value is <code>JKS</code>. Another
commonly used type is the <code>PKCS12</code>. Available keystore/truststore types depend
on your Operating system and the Java runtime.</p>
</li>
<li>
<p><code>keyManagerAlgorithm</code>: Name of the algorithm based on which the authentication
keys are provided.</p>
</li>
<li>
<p><code>trustManagerAlgorithm</code>: Name of the algorithm based on which the trust managers
are provided.</p>
</li>
<li>
<p><code>trustStore</code>: Path of your truststore file. The file truststore is a keystore file
that contains a collection of certificates
 trusted by your application. Its type should be <code>JKS</code>.</p>
<div class="ulist">
<ul>
<li>
<p><em>Using the <code>trustStore</code> property is not recommended, use <code>trustCertCollectionFile</code> instead</em></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>trustStorePassword</code>: Password to unlock the truststore file.</p>
</li>
<li>
<p><code>trustStoreType</code>: Type of the truststore. Its default value is <code>JKS</code>. Another
commonly used type is the <code>PKCS12</code>. Available keystore/truststore types depend on
your operating system and the Java runtime.</p>
</li>
<li>
<p><code>ciphersuites</code>: Comma-separated list of cipher suite names allowed to be used.</p>
</li>
<li>
<p><code>protocol</code>: Name of the algorithm which is used in your TLS/SSL. Its default
value is <code>TLSv1.2</code>. Available values are:</p>
<div class="ulist">
<ul>
<li>
<p><code>TLS</code></p>
</li>
<li>
<p><code>TLSv1</code></p>
</li>
<li>
<p><code>TLSv1.1</code></p>
</li>
<li>
<p><code>TLSv1.2</code></p>
</li>
<li>
<p><code>SSL</code> <em>(insecure!)</em></p>
</li>
<li>
<p><code>SSLv2</code> <em>(insecure!)</em></p>
</li>
<li>
<p><code>SSLv3</code> <em>(insecure!)</em></p>
<div class="paragraph">
<p>All of the algorithms listed above support Java 8 and higher versions. For the
<code>protocol</code> property, we recommend you to provide SSL or TLS with its version
information, e.g., <code>TLSv1.2</code>. Note that if you
provide only <code>SSL</code> or <code>TLS</code> as a value for the <code>protocol</code> property, they are
converted to <code>SSLv3</code> and <code>TLSv1.2</code>, respectively. We strongly recommend to avoid
SSL protocols.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>validateIdentity</code>: Flag which allows enabling endpoint identity validation. It means, during the TLS handshake client verifies if the server&#8217;s hostname (or IP address) matches the information in X.509 certificate (Subject Alternative Name extension). Possible values are <code>"true"</code> and <code>"false"</code> (default).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_other_tls_related_configuration"><a class="anchor" href="#_other_tls_related_configuration"></a>Other TLS related configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_tlsssl_for_hazelcast_management_center"><a class="anchor" href="#_tlsssl_for_hazelcast_management_center"></a>TLS/SSL for Hazelcast Management Center</h3>
<div class="paragraph">
<p>In order to use a secured communication between the Hazelcast cluster and Management Center,
you have to configure Management Center as explained in the
<a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#connecting-hazelcast-members-to-management-center" target="_blank" rel="noopener">Connecting Hazelcast members to Management Center section</a> in the Hazelcast
Management Center Reference Manual.</p>
</div>
<div class="sect3">
<h4 id="_updating_certificates_in_the_running_cluster"><a class="anchor" href="#_updating_certificates_in_the_running_cluster"></a>Updating Certificates in the Running Cluster</h4>
<div class="paragraph">
<p>Hazelcast allows updating TLS certificates on the members
without fully stopping the cluster. You can stop the cluster members
one by one and replace the certificates gradually. We can
distinguish two cases based on the fact if the new certificate
is already trusted:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>New certificates are not trusted on the members.</p>
<div class="paragraph">
<p>This is usually a case when self-signed certificates are used on the members.</p>
</div>
<div class="paragraph">
<p>Before we can deploy new member certificates, we have to
update the list of trusted certificates on all members.
Complete the following steps on each member (one by one) in the cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gracefully shutdown the member</p>
</li>
<li>
<p>Wait for the cluster safe state (rebalance)</p>
</li>
<li>
<p>Import all new certificates to the member&#8217;s truststore,
so it contains both old and new ones.</p>
<div class="paragraph">
<p>You can use the <code>keytool</code> executable from Java installation
to import the new certificates. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">keytool -import -noprompt \
  -keystore member.truststore -storepass s3crEt \
  -alias new-cert-1 -file member-new-cert.crt</code></pre>
</div>
</div>
</li>
<li>
<p>Start the member with the updated truststore</p>
</li>
<li>
<p>Wait for the cluster safe state (rebalance)</p>
<div class="paragraph">
<p>After completing the above steps, follow the steps
described in the next point (certificates trusted).</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>New certificates are already trusted on the members</p>
<div class="paragraph">
<p>Switch certificate on each member one by one:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gracefully shutdown the member</p>
</li>
<li>
<p>Wait for the cluster safe state (rebalance)</p>
</li>
<li>
<p>Replace the private key and certificate in the member&#8217;s keystore</p>
</li>
<li>
<p>Start the member with the updated keystore</p>
</li>
<li>
<p>Wait for the cluster safe state (rebalance)</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_cipher_suites"><a class="anchor" href="#_configuring_cipher_suites"></a>Configuring Cipher Suites</h3>
<div class="paragraph">
<p>To get the best performance, the correct <a href="https://en.wikipedia.org/wiki/Cipher_suite" target="_blank" rel="noopener">cipher suites</a>
need to be configured.
Each cipher suite has different performance and security characteristics and depending on the
hardware and selected cipher suite, the overhead of TLS can range from dramatic to almost
negligible.</p>
</div>
<div class="paragraph">
<p>The cipher suites are configured using the <code>ciphersuites</code> property as shown below:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;network&gt;
        &lt;ssl enabled="true"&gt;
            &lt;factory-class-name&gt;...&lt;/factory-class-name&gt;
            &lt;properties&gt;
                &lt;property name="keyStore"&gt;upload/hazelcast.keystore&lt;/property&gt;
                &lt;property name="ciphersuites"&gt;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,
                                      TLS_ECDH_RSA_WITH_3DES_EDE_CBC_SHA&lt;/property&gt;
           &lt;/properties&gt;
       &lt;/ssl&gt;
    &lt;/network&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  network:
    ssl:
      enabled: true
      factory-class-name: ...
      properties:
        keyStore: upload/hazelcast.keystore
        ciphersuites: TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,
                                      TLS_ECDH_RSA_WITH_3DES_EDE_CBC_SHA</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ciphersuites</code> property accepts a comma separated list (spaces, enters, tabs are
filtered out) of cipher suites in the order
of preference.</p>
</div>
<div class="paragraph">
<p>You can configure a member and client with different cipher suites; but there should be
at least one shared cipher suite.</p>
</div>
<div class="paragraph">
<p>One of the cipher suites that gave very low overhead but still provides solid security
is <code>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</code>.
However in our measurements this cipher suite only performs well using OpenSSL; using
the regular Java TLS integration, it performs
badly. So keep that in mind when configuring a client using regular SSL and a member
using OpenSSL.</p>
</div>
<div class="paragraph">
<p>Please check with your security expert to determine which cipher suites are appropriate
and run performance tests to see which ones perform
well in your environment.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t configure the cipher suites, then both client and/or member determine a cipher
suite by themselves during the TLS/SSL
handshake. This can lead to suboptimal performance and lower security than required.</p>
</div>
</div>
<div class="sect2">
<h3 id="_other_ways_of_configuring_properties"><a class="anchor" href="#_other_ways_of_configuring_properties"></a>Other Ways of Configuring Properties</h3>
<div class="paragraph">
<p>You can set all the properties presented in this section using the <code>javax.net.ssl</code> prefix,
e.g., <code>javax.net.ssl.keyStore</code>
and <code>javax.net.ssl.keyStorePassword</code>.</p>
</div>
<div class="paragraph">
<p>Also note that these properties can be specified using the related Java system properties and
also Java&#8217;s <code>-D</code> command line
option. This is very useful if you require a more flexible configuration, e.g., when doing
performance tests.</p>
</div>
<div class="paragraph">
<p>See below examples equivalent to each other:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>System.setProperty("javax.net.ssl.trustStore", "/user/home/hazelcast.ts");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Djavax.net.ssl.trustStore=/user/home/hazelcast.ts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another two examples equivalent to each other:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>System.setProperty("javax.net.ssl.ciphersuites", "TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDH_RSA_WITH_3DES_EDE_CBC_SHA");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Djavax.net.ssl.ciphersuites=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDH_RSA_WITH_3DES_EDE_CBC_SHA</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_validating_secrets_using_strength_policy"><a class="anchor" href="#_validating_secrets_using_strength_policy"></a>Validating Secrets Using Strength Policy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hazelcast IMDG Enterprise offers a secret validation mechanism including a strength
policy. The term "secret" here refers to the symmetric encryption password,
salt and other passwords and keys.</p>
</div>
<div class="paragraph">
<p>For this validation, Hazelcast IMDG Enterprise comes with the <code>DefaultSecretStrengthPolicy</code>
class to identify all possible weaknesses of secrets and to display a warning
in the system logger. Note that, by default, no matter how weak the secrets are, the
cluster members still start after logging this warning; however, this is
configurable (see the <a href="#enforcing-the-secret-strength-policy">Enforcing the Secret Strength Policy</a> section).</p>
</div>
<div class="paragraph">
<p>The following are the requirements (rules) for the secrets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Minimum length of eight characters; and</p>
</li>
<li>
<p>Large keyspace use, ensuring the use of at least three of the following:</p>
<div class="ulist">
<ul>
<li>
<p>mixed case</p>
</li>
<li>
<p>alpha</p>
</li>
<li>
<p>numerals</p>
</li>
<li>
<p>special characters</p>
</li>
<li>
<p>no dictionary words</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rules "Minimum length of eight characters" and "no dictionary words" can
be configured using the following system properties:</p>
</div>
<div class="paragraph">
<p><code>hazelcast.security.secret.policy.min.length</code>: Set the minimum secret
length. The default is 8 characters.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Dhazelcast.security.secret.policy.min.length=10</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>hazelcast.security.dictionary.policy.wordlist.path</code>: Set the path of a wordlist
available in the file system. The default is <code>/usr/share/dict/words</code>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Dhazelcast.security.dictionary.policy.wordlist.path=/Desktop/myWordList</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_using_a_custom_secret_strength_policy"><a class="anchor" href="#_using_a_custom_secret_strength_policy"></a>Using a Custom Secret Strength Policy</h3>
<div class="paragraph">
<p>You can implement SecretStrengthPolicy to develop your custom strength policy
for a more flexible or strict security. After you implement it, you can use the
following system property to point to your custom class:</p>
</div>
<div class="paragraph">
<p><code>hazelcast.security.secret.strength.default.policy.class</code>: Set the full name of
the custom class.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Dhazelcast.security.secret.strength.default.policy.class=com.impl.myStrengthPolicy</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enforcing_the_secret_strength_policy"><a class="anchor" href="#_enforcing_the_secret_strength_policy"></a>Enforcing the Secret Strength Policy</h3>
<div class="paragraph">
<p>By default, secret strength policy is NOT enforced. This means, if a weak
secret is detected, an informative warning is shown in the system logger and
the members continue to initialize. However, you can enforce the policy using
the following system property so that the members are not started until the
weak secret errors are fixed:</p>
</div>
<div class="paragraph">
<p><code>hazelcast.security.secret.strength.policy.enforced</code>: Set to true to enforce
the secret strength policy. The default is false. To enforce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Dhazelcast.security.secret.strength.policy.enforced=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example warning when secret strength policy is NOT enforced,
i.e., the above system property is set to false:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ SECURITY WARNING @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Group password does not meet the current policy and complexity requirements.
*Must not be set to the default.
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example warning when secret strength policy is enforced, i.e., the
above system property is set to true:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-plain hljs" data-lang="plain">WARNING: [192.168.2.112]:5701 [dev] [4.0-SNAPSHOT]
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ SECURITY WARNING @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Symmetric Encryption Password does not meet the current policy and complexity requirements.
*Must contain at least 1 number.
*Must contain at least 1 special character.
Group Password does not meet the current policy and complexity requirements.
*Must not be set to the default.
*Must have at least 1 lower and 1 upper case characters.
*Must contain at least 1 number.
*Must contain at least 1 special character.
Symmetric Encryption Salt does not meet the current policy and complexity requirements.
*Must contain 8 or more characters.
*Must contain at least 1 number.
*Must contain at least 1 special character.
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Exception in thread "main" com.hazelcast.security.WeakSecretException: Weak secrets found in configuration, check output above for more details.
at com.hazelcast.security.impl.WeakSecretsConfigChecker.evaluateAndReport(WeakSecretsConfigChecker.java:49)
at com.hazelcast.instance.EnterpriseNodeExtension.printNodeInfo(EnterpriseNodeExtension.java:197)
at com.hazelcast.instance.Node.&lt;init&gt;(Node.java:194)
at com.hazelcast.instance.HazelcastInstanceImpl.createNode(HazelcastInstanceImpl.java:163)
at com.hazelcast.instance.HazelcastInstanceImpl.&lt;init&gt;(HazelcastInstanceImpl.java:130)
at com.hazelcast.instance.HazelcastInstanceFactory.constructHazelcastInstance(HazelcastInstanceFactory.java:195)
at com.hazelcast.instance.HazelcastInstanceFactory.newHazelcastInstance(HazelcastInstanceFactory.java:174)
at com.hazelcast.instance.HazelcastInstanceFactory.newHazelcastInstance(HazelcastInstanceFactory.java:124)
at com.hazelcast.core.Hazelcast.newHazelcastInstance(Hazelcast.java:58)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-realms"><a class="anchor" href="#security-realms"></a>Security Realms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hazelcast IMDG 4.0 introduces a new security configuration: security realms.
Realms allow configuring JAAS authentication and/or own identity
independently on the module which consumes this configuration.
The realm is a named configuration and other modules just reference it by name.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">Unresolved include directive in modules/deploy/pages/security.adoc - include::javatestresource/hazelcast-security-realms.xml[]</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">security:
  enabled: true
  realms:
    - name: realm1
      authentication:
        jaas:
          - class-name: com.hazelcast.examples.MyRequiredLoginModule
            usage: REQUIRED
            properties:
              property: value
      identity:
        credentials-factory:
          class-name: com.hazelcast.examples.MyCredentialsFactory
          properties:
            property: value
  member-authentication:
    realm: realm1
  client-authentication:
    realm: realm1</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_authentication_configuration"><a class="anchor" href="#_authentication_configuration"></a>Authentication Configuration</h3>
<div class="paragraph">
<p>There are several types of authentication configuration available in a security realm.
The realm cannot have more than one authentication method specified.</p>
</div>
<div class="paragraph">
<p>The following are the available authentication types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jaas</code>: It allows defining JAAS login module stacks.</p>
</li>
<li>
<p><code>ldap</code>: It verifies <code>PasswordCredentials</code> against an LDAP server.</p>
</li>
<li>
<p><code>kerberos</code>: It verifies the Kerberos token provided in <code>TokenCredentials</code>.</p>
</li>
<li>
<p><code>tls</code>: It verifies that the TLS mutual authentication was used
in the incoming connection and the peer&#8217;s certificate chain is available.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_jaas_authentication_type"><a class="anchor" href="#_jaas_authentication_type"></a>JAAS Authentication Type</h4>
<div class="paragraph">
<p>The <code>&lt;jaas&gt;</code> authentication configuration is the most flexible
form of the authentication configuration, but it requires knowledge
of JAAS login modules and related concepts. It allows using
custom login modules and ordering them in a login module stack.</p>
</div>
<div class="paragraph">
<p>The following is a sample configuration which authenticates against an LDAP server or
database as a fallback:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">Unresolved include directive in modules/deploy/pages/security.adoc - include::javatestresource/hazelcast-authentication-types.xml[]</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yml hljs" data-lang="yml">realms:
  - name: jaasRealm
    authentication:
      jaas:
        - class-name: com.examples.LdapLoginModule
          usage: SUFFICIENT
          properties:
            url: ldap://corp-ldap
        - class-name: com.examples.DatabaseLoginModule
          usage: SUFFICIENT
          properties:
            type: ora18
            host: corp-db
            table: USERS</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details, see the <a href="#jaas-authentication">JAAS authentication section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ldap_authentication_type"><a class="anchor" href="#_ldap_authentication_type"></a>LDAP Authentication Type</h4>
<div class="paragraph">
<p>LDAP servers are one of the most popular identity stores in companies.
They can track information about the organization structure,
users, groups, servers and configurations.</p>
</div>
<div class="paragraph">
<p>Hazelcast supports authentication and authorization against LDAP servers.
The authentication verifies the provided name and password.
The authorization part allows to map roles to the authenticated user.</p>
</div>
<div class="paragraph">
<p>The password verification during the authentication is possible by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>making a new LDAP bind operation with the given name and password</p>
</li>
<li>
<p>using a separate "admin connection" to verify the provided password
against an LDAP object attribute.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The LDAP authentication allows also a role mapping.
As there are more ways how roles can be mapped in the LDAP,
Hazelcast provides several approaches to retrieve them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>attribute</code>: The role name is stored as an attribute in the object representing the identity.</p>
</li>
<li>
<p><code>direct</code> mapping: The identity object contains an attribute with reference to the role object(s).</p>
</li>
<li>
<p><code>reverse</code> mapping: The role objects having a reference to the identity object are searched.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>direct</code> and <code>reverse</code> mapping modes also allow a role search recursion.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. LDAP Configuration Options</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Option Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>url</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL of the LDAP server. The value is configured as the JNDI environment
property, i.e., <code>java.naming.provider.url</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>socket-factory-class-name</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Socket factory class name. The factory can be used for fine grained
configuration of the TLS protocol on top of the LDAP protocol, i.e., <code>ldaps</code> scheme.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>parse-dn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, it treats the value of <code>role-mapping-attribute</code> as a DN and
extracts only the <code>role-name-attribute</code> values as role names. If set to <code>false</code>,
the whole value of <code>role-mapping-attribute</code> is used as a role name.</p>
<p class="tableblock">This option is only used when the <code>role-mapping-mode</code> option has the value <code>attribute</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>role-context</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP Context in which assigned roles are searched, e.g., <code>ou=Roles,dc=hazelcast,dc=com</code>.</p>
<p class="tableblock">This option is only used when the <code>role-mapping-mode</code> option has the value <code>reverse</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>role-filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>([role-mapping-attribute]={MEMBERDN})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP search string which usually contains a placeholder <code>{MEMBERDN}</code> to be
replaced by the provided login name, e.g., <code>(member={MEMBERDN})</code>.</p>
<p class="tableblock">If the role search recursion is enabled (see <code>role-recursion-max-depth</code>), the <code>{MEMBERDN}</code>
is replaced by role DNs in the recurrent searches.</p>
<p class="tableblock">This option is only used when the <code>role-mapping-mode</code> option has the value <code>reverse</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>role-mapping-attribute</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the LDAP attribute which contains either the role name or role DN.</p>
<p class="tableblock">This option is  used when the <code>role-mapping-mode</code> option has the value <code>attribute</code> or <code>direct</code>.
If the mapping mode is <code>reverse</code>, the value is used in <code>role-filter</code> default value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>role-mapping-mode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>attribute</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Role mapping mode. It can have one of the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>attribute</code>: The user object in the LDAP contains directly role name in the
given attribute. Role name can be parsed from a DN string when <code>parse-dn=true</code>
No additional LDAP query is done to find assigned roles.</p>
</li>
<li>
<p><code>direct</code>: The user object contains an attribute with DN(s) of assigned
role(s). Role object(s) is/are loaded from the LDAP and the role name is
retrieved from its attributes. Role search recursion can be enabled for this mode.</p>
</li>
<li>
<p><code>reverse</code>: The role objects are located by executing an LDAP search query
with the given <code>role-filter</code>. In this case, the role object usually contains
attributes with DNs of the assigned users. Role search recursion can be enabled for this mode.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>role-name-attribute</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This option may refer to a name of LDAP attribute within the role object which
contains the role name in case of <code>direct</code> and <code>reverse</code> role mapping mode. It may also refer
to the attribute name within X.500 name stored in <code>role-mapping-attribute</code> when
<code>role-mapping-mode=attribute</code> and <code>parse-dn=true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>role-recursion-max-depth</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum depth of role search recursion. The default value 1 means
the role search recursion is disabled.</p>
<p class="tableblock">This option is only used when the <code>role-mapping-mode</code> option has value <code>direct</code> or <code>reverse</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>role-search-scope</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>subtree</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>LDAP search scope used for <code>role-filter</code> search. It can have one of the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>subtree</code>: Searches for objects in the given context and its subtree.</p>
</li>
<li>
<p><code>one-level</code>: Searches just one-level under the given context.</p>
</li>
<li>
<p><code>object</code>: Searches (or tests) just for the context object itself (if it matches the filter criteria).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This option is only used when the <code>role-mapping-mode</code> option has the value <code>reverse</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user-name-attribute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP attribute name whose value is used as a name in
<code>ClusterIdentityPrincipal</code> added to the JAAS Subject.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>system-user-dn</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Admin account DN. If configured, then the following are true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For the user and role object, search queries are used an admin connection instead
of the "user" one created by LDAP bind with provided credentials.</p>
</li>
<li>
<p>LDAP authentication doesn&#8217;t expect the full user DN to be provided as a login name.
It rather expects names like <code>"jduke"</code> than <code>"uid=jduke,ou=Engineering,o=Hazelcast,dc=com"</code>;</p>
</li>
<li>
<p>The admin connection allows verifying the provided user credentials against a
value defined in the <code>password-attribute</code> option.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>system-user-password</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin&#8217;s password (for <code>system-user-dn</code> account).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>system-authentication</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>simple</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the authentication mechanism used for the admin LDAP connection.
It&#8217;s used as a value for JNDI environment property <code>Context#SECURITY_AUTHENTICATION</code>.
You can specify <code>GSSAPI</code> to authenticate with the Kerberos protocol.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password-attribute</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Credentials verification is done by the new LDAP binds by default.
Nevertheless, the password can be stored in a non-default LDAP attribute,
and in this case use <code>password-attribute</code> to configure against which
LDAP attribute (within the user object) is the provided password compared
during the login. As a result, if the <code>password-attribute</code> option is provided,
then the extra LDAP bind to verify credentials is not done and passwords
are just compared within the Hazelcast code after retrieving the user object from LDAP server.</p>
<p class="tableblock">This option is only used when the admin connection is configured, i.e., when <code>system-user-dn</code> or <code>system-authentication</code> is defined.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user-context</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP context in which the user objects are searched, e.g., <code>ou=Users,dc=hazelcast,dc=com</code>.</p>
<p class="tableblock">This option is only used when the admin connection is configured, i.e., when <code>system-user-dn</code> or <code>system-authentication</code> is defined.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user-filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(uid={login})</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP search string for retrieving the user objects based on the provided login name.
It usually contains a placeholder substring <code>{login}</code> which is replaced by the provided login name.</p>
<p class="tableblock">This option is only used when the admin connection is configured, i.e., when <code>system-user-dn</code> or <code>system-authentication</code> is defined.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user-search-scope</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>subtree</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>LDAP search scope used for <code>user-filter</code> search. It can have one of the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>subtree</code>: Searches for objects in the given context and its subtree.</p>
</li>
<li>
<p><code>one-level</code>: Searches just one-level under the given context.</p>
</li>
<li>
<p><code>object</code>: Searches (or tests) just for the context object itself (if it matches the filter criteria).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This option is only used when the admin connection is configured, i.e., when <code>system-user-dn</code> or <code>system-authentication</code> is defined.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>skip-authentication</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Flag which allows disabling password verification and
only takes care about filling <code>HazelcastPrincipal</code> instances into the
Subject.</p>
</div>
<div class="paragraph">
<p>This option is only used when the admin connection is configured, i.e., when <code>system-user-dn</code> or <code>system-authentication</code> is defined.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>security-realm</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If specified, given realm name is used for authentication of
a (temporary) Subject which is then used for doing LDAP queries.</p>
</div>
<div class="paragraph">
<p>This option is only used when the admin connection is configured, i.e., when <code>system-user-dn</code> or <code>system-authentication</code> is defined.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Detailed logging for LDAP authentication can be enabled by
configuring a more verbose logger level for the <code>com.hazelcast.security</code>
package as described in the <a href="#security-debugging">Security Debugging section</a>.</p>
</div>
<div class="sect4">
<h5 id="_tls_protected_ldap_server_connections"><a class="anchor" href="#_tls_protected_ldap_server_connections"></a>TLS Protected LDAP Server Connections</h5>
<div class="paragraph">
<p>The LDAP authentication type supports TLS protected connections
to LDAP servers, i.e., the <code>ldaps</code> protocol scheme. The TLS is
handled on the Java runtime side (JNDI API and URL handlers).</p>
</div>
<div class="paragraph">
<p>When using TLS, the LDAP provider will, by default, use the socket factory,
<code>javax.net.ssl.SSLSocketFactory</code> for creating a TLS socket to communicate
with the server, using the default JSSE configuration. By default, the server&#8217;s
certificate is validated against Java default CA certificate store and hostname
in LDAPs URL is verified against the name(s) in the server certificate. The behavior
can be controlled globally by using <code>javax.net.ssl.*</code> properties. Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">java -Djavax.net.ssl.trustStore=/opt/hazelcast.truststore \
  -Djavax.net.ssl.trustStorePassword=123456 \
  -Djavax.net.ssl.keyStore=/opt/hazelcast.keystore \
  -Djavax.net.ssl.keyStorePassword=123456 \
  ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>There can be also properties specific to vendor or Java version allowing more
fine-grained control. Here is an example on disabling host name validation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">-Dcom.sun.jndi.ldap.object.disableEndpointIdentification=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>When even more control is necessary, you can implement your own
<code>SSLSocketFactory</code> and use its class name as the value in the <code>ldap</code>
authentication option <code>socket-factory-class-name</code>.</p>
</div>
<div class="paragraph">
<p>Here is an example custom socket factory class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package security.ldap;

import java.io.FileInputStream;
import java.io.IOException;
import java.net.InetAddress;
import java.net.Socket;
import java.security.KeyStore;
import java.security.SecureRandom;

import javax.net.SocketFactory;
import javax.net.ssl.SSLContext;
import javax.net.ssl.SSLSocketFactory;
import javax.net.ssl.TrustManagerFactory;

public class CustomSSLSocketFactory extends SSLSocketFactory {

    private static final SocketFactory INSTANCE = new CustomSSLSocketFactory();

    /**
     * JNDI uses this method when creating {@code ldaps} connections.
     */
    public static SocketFactory getDefault() {
        return INSTANCE;
    }

    private SSLSocketFactory delegate;

    public CustomSSLSocketFactory() {
        try {
            KeyStore trustStore = KeyStore.getInstance(KeyStore.getDefaultType());
            try (FileInputStream fis = new FileInputStream("/opt/ldap.truststore")) {
                trustStore.load(fis, "S3cr3t".toCharArray());
            }
            TrustManagerFactory tmFactory = TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());
            tmFactory.init(trustStore);
            SSLContext sc = SSLContext.getInstance("TLS");
            sc.init(null, tmFactory.getTrustManagers(), new SecureRandom());
            delegate = sc.getSocketFactory();
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    @Override
    public String[] getDefaultCipherSuites() {
        return delegate.getDefaultCipherSuites();
    }

    @Override
    public String[] getSupportedCipherSuites() {
        return delegate.getSupportedCipherSuites();
    }

    @Override
    public Socket createSocket(Socket arg0, String arg1, int arg2, boolean arg3) throws IOException {
        return delegate.createSocket(arg0, arg1, arg2, arg3);
    }

    @Override
    public Socket createSocket(String arg0, int arg1) throws IOException {
        return delegate.createSocket(arg0, arg1);
    }

    @Override
    public Socket createSocket(InetAddress arg0, int arg1) throws IOException {
        return delegate.createSocket(arg0, arg1);
    }

    @Override
    public Socket createSocket(String arg0, int arg1, InetAddress arg2, int arg3) throws IOException {
        return delegate.createSocket(arg0, arg1, arg2, arg3);
    }

    @Override
    public Socket createSocket(InetAddress arg0, int arg1, InetAddress arg2, int arg3) throws IOException {
        return delegate.createSocket(arg0, arg1, arg2, arg3);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The authentication configuration could look like as follows:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">Unresolved include directive in modules/deploy/pages/security.adoc - include::javatestresource/hazelcast-authentication-types.xml[]</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yml hljs" data-lang="yml">realms:
  - name: ldapsRealm
    authentication:
      ldap:
         url: ldaps://ldapserver.acme.com
         socket-factory-class-name: security.ldap.CustomSSLSocketFactory
         role-mapping-attribute: cn</code></pre>
</div>
</div>
<div class="paragraph">
<p>The LDAP authentication is backed by the JNDI API in Java.
It has also the failover support. You can configure multiple space-separated
URLs in the <code>&lt;url&gt;</code> option:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">Unresolved include directive in modules/deploy/pages/security.adoc - include::javatestresource/hazelcast-authentication-types.xml[]</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yml hljs" data-lang="yml">realms:
  - name: ldapFallbackRealm
    authentication:
      ldap:
         url: ldap://ldap-master.example.com ldap://ldap-backup.example.com</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kerberos-authentication"><a class="anchor" href="#kerberos-authentication"></a>Kerberos Authentication Type</h4>
<div class="paragraph">
<p>The Kerberos authentication protocol is one of the standard solutions
for single sign-on (SSO). It&#8217;s well established in many companies. Hazelcast
supports Kerberos authentication as an Enterprise feature and it also
provides Kerberos integration to LDAP-based authorization.</p>
</div>
<div class="paragraph">
<p>The Kerberos support in Hazelcast has 2 configuration parts: identity
and authentication. The identity part is responsible for retrieving the service
ticket from Kerberos KDC (Key Distribution Center).
The authentication part verifies the service tickets.</p>
</div>
<div class="paragraph">
<p>Default Service principal names for Hazelcast members are in the form
<code>hz/address@REALM</code>, e.g., <code>hz/192.168.1.1@ACME.COM</code>.</p>
</div>
<div class="paragraph">
<p>Before a service ticket is issued, the client side of the connection has to be
authenticated, which means the TGT (Ticket Granting Ticket) is present in the Subject.</p>
</div>
<div class="paragraph">
<p>Hazelcast delegates the TGT retrieval to vendor specific <code>Krb5LoginModule</code>
implementations (find the correct login module and its options in your Java
documentation). On the Hazelcast side, the <code>security-ream</code> property allows
referencing another realm with <code>Krb5LoginModule</code> configured.</p>
</div>
<div class="listingblock primary">
<div class="title">Sample Kerberos Identity Configuration XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;realm name="kerberosRealm"&gt;
    &lt;identity&gt;
        &lt;kerberos&gt;
            &lt;realm&gt;ACME.COM&lt;/realm&gt;
            &lt;security-realm&gt;krb5Initiator&lt;/security-realm&gt;
        &lt;/kerberos&gt;
    &lt;/identity&gt;
&lt;/realm&gt;
&lt;realm name="krb5Initiator"&gt;
    &lt;authentication&gt;
        &lt;jaas&gt;
            &lt;login-module class-name="com.sun.security.auth.module.Krb5LoginModule" usage="REQUIRED"&gt;
                &lt;properties&gt;
                    &lt;property name="useTicketCache"&gt;true&lt;/property&gt;
                    &lt;property name="doNotPrompt"&gt;true&lt;/property&gt;
                &lt;/properties&gt;
            &lt;/login-module&gt;
        &lt;/jaas&gt;
    &lt;/authentication&gt;
&lt;/realm&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">realms:
  - name: kerberosRealm
      identity:
        kerberos:
          realm: ACME.COM
          security-realm: krb5Initiator
  - name: krb5Initiator
      authentication:
        jaas:
          class-name: com.sun.security.auth.module.Krb5LoginModule
            properties:
              useTicketCache: true
              doNotPrompt: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;kerberos&gt;</code> identity configuration has the following properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. The &lt;kerberos&gt; Identity Configuration Options</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spn</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows configuring static Service Principal Name (SPN). It&#8217;s
meant for use cases where all the members share a single Kerberos identity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>service-name-prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"hz/"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the prefix of SPN. By default the member&#8217;s
principal name (for which this credentials
factory asks the service ticket) is in the form
<code>"[servicePrefix][memberIpAddress]@[REALM]"</code>, e.g.,
<code>"hz/192.168.1.1@ACME.COM"</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>realm</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos realm name, e.g., <code>"ACME.COM"</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>security-realm</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Security realm name in the Hazelcast configuration used
for Kerberos authentication. The authentication configuration in the
referenced security realm will be used to fill the Subject with the Kerberos
credentials, e.g., TGT.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>use-canonical-hostname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag which controls if canonical hostnames should be used instead of IP addresses
in generated Service Principal names.
This property is only used when Service Principal name is not static, i.e., when <code>spn</code> option
is not configured).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>principal</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos principal name. This is a helper option which can be used together
with the <code>keytabFile</code> to replace the <code>security-realm</code> configuration.</p>
<p class="tableblock"><em>We don&#8217;t recommend using this property in production!</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keytabFile</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to a keytab file with the current principal&#8217;s secrets.
This is a helper option which can be used together
with the <code>principal</code> to replace the <code>security-realm</code> configuration.</p>
<p class="tableblock"><em>We don&#8217;t recommend using this property in production!</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The authenticating part on the server side is able to
accept the Kerberos tickets and verify them. Again the Kerberos
authentication is delegated to another realm with the Kerberos login module
configured.</p>
</div>
<div class="listingblock primary">
<div class="title">Sample Kerberos Authentication Configuration XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;realm name="kerberosRealm"&gt;
    &lt;authentication&gt;
        &lt;kerberos&gt;
            &lt;security-realm&gt;krb5Acceptor&lt;/security-realm&gt;
        &lt;/kerberos&gt;
    &lt;/authentication&gt;
&lt;/realm&gt;
&lt;realm name="krb5Acceptor"&gt;
    &lt;authentication&gt;
        &lt;jaas&gt;
            &lt;login-module class-name="com.sun.security.auth.module.Krb5LoginModule" usage="REQUIRED"&gt;
                &lt;properties&gt;
                    &lt;property name="isInitiator"&gt;false&lt;/property&gt;
                    &lt;property name="useTicketCache"&gt;false&lt;/property&gt;
                    &lt;property name="doNotPrompt"&gt;true&lt;/property&gt;
                    &lt;property name="useKeyTab"&gt;true&lt;/property&gt;
                    &lt;property name="storeKey"&gt;true&lt;/property&gt;
                    &lt;property name="principal"&gt;hz/192.168.1.1@ACME.COM&lt;/property&gt;
                    &lt;property name="keyTab"&gt;/opt/member1.keytab&lt;/property&gt;
                &lt;/properties&gt;
            &lt;/login-module&gt;
        &lt;/jaas&gt;
    &lt;/authentication&gt;
&lt;/realm&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">realms:
  name: kerberosRealm
    authentication:
      kerberos:
        security-realm: krb5Acceptor
  name: krb5Acceptor
    authentication:
      jaas:
        - class-name: com.sun.security.auth.module.Krb5LoginModule
          usage: REQUIRED
          properties:
            isInitiator: false
            useTicketCache: false
            doNotPrompt: true
            useKeyTab: true
            storeKey: true
            principal: hz/192.168.1.1@ACME.COM
            keyTab: /opt/member1.keytab</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>krb5Acceptor</code> realm configuration in the snippet only loads the Kerberos secrets from
a keytab file and it doesn&#8217;t authenticate against a KDC.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. The &lt;kerberos&gt; Authentication Configuration Options</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>relax-flags-check</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows disabling some of the checks on the
incoming token, e.g., passes authentication even if the mutual
authentication is required by the token.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>use-name-without-realm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When set to <code>true</code>, then the Kerberos realm part is removed from the
authenticated name, e.g., <code>"<a href="mailto:jduke@ACME.COM">jduke@ACME.COM</a>"</code> becomes just <code>"jduke"</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>security-realm</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Security realm name in the Hazelcast configuration used
for Kerberos authentication. The authentication configuration in the
referenced security realm will be used to fill the Subject with the Kerberos
credentials, e.g., Keytab.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>principal</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kerberos principal name. This is a helper option which can be used together
with the <code>keytabFile</code> to replace the <code>security-realm</code> configuration.</p>
<p class="tableblock"><em>We don&#8217;t recommend using this property in production!</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keytabFile</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to a keytab file with the current principal&#8217;s secrets.
This is a helper option which can be used together
with the <code>principal</code> to replace the <code>security-realm</code> configuration.</p>
<p class="tableblock"><em>We don&#8217;t recommend using this property in production!</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>GssApiLoginModule</code> (implementing Kerberos authentication)
derives from the abstract <code>ClusterLoginModule</code>. As a result the <code>&lt;kerberos&gt;</code>
configuration supports the common options, too: <code>skip-identity</code>, <code>skip-endpoint</code> and
<code>skip-role</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The Kerberos authentication in Hazelcast is only able to validate connections on
the server side. It doesn&#8217;t support mutual authentication.</p>
</li>
<li>
<p>The Generic Security Services API (GSS-API) is not used for protecting (wrapping)
the messages after the authentication, e.g., encryption, integrity checks. It&#8217;s only used for
accepting tokens.</p>
</li>
<li>
<p>The token itself is not protected against Man-in-the-Middle (MITM) attacks.
If an attacker is able to eavesdrop the token and use it before the
original sender, then the attacker succeeds with the authentication but
the original sender won&#8217;t.</p>
<div class="ulist">
<ul>
<li>
<p>There is a replay protection in Java which caches the already used tokens.</p>
</li>
<li>
<p>Java Kerberos implementation accepts the token for 5 minutes (by default)
from its creation.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Time has to be synchronized on the machines where the Kerberos is
used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are running Hazelcast in an untrusted network with a MITM attack
risk, then enable encryption on Hazelcast protocols to prevent stealing
the token.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_kerberos_and_ldap_integration"><a class="anchor" href="#_kerberos_and_ldap_integration"></a>Kerberos and LDAP integration</h4>
<div class="paragraph">
<p>The Kerberos authentication allows loading role mapping information from
an LDAP server (usually the one backing the Kerberos KDC server, too).
Therefore the <code>&lt;ldap&gt;</code> authentication configuration is also available as
sub-configuration of the <code>&lt;kerberos&gt;</code> authentication.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;realm name="kerberosRealm"&gt;
    &lt;authentication&gt;
        &lt;kerberos&gt;
            &lt;skip-role&gt;true&lt;/skip-role&gt;
            &lt;security-realm&gt;krb5Acceptor&lt;/security-realm&gt;
            &lt;ldap&gt;
                &lt;url&gt;ldap://ldap.hazelcast.com&lt;/url&gt;
                &lt;system-authentication&gt;GSSAPI&lt;/system-authentication&gt;
                &lt;role-mapping-attribute&gt;memberOf&lt;/role-mapping-attribute&gt;
                &lt;security-realm&gt;krb5Initiator&lt;/security-realm&gt;
                &lt;user-filter&gt;(krb5PrincipalName={login})&lt;/user-filter&gt;
                &lt;skip-authentication&gt;true&lt;/skip-authentication&gt;
            &lt;/ldap&gt;
        &lt;/kerberos&gt;
    &lt;/authentication&gt;
&lt;/realm&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">realms:
  - name: kerberosRealm
    authentication:
      kerberos:
        skip-role: true
        security-realm: krb5Acceptor
        ldap:
          url: ldap://ldap.hazelcast.com
          system-authentication: GSSAPI
          security-realm: krb5Initiator
          skip-authentication: true
          user-filter: "(krb5PrincipalName={login})"
          role-mapping-attribute: memberOf</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Kerberos-LDAP integration doesn&#8217;t support credentials delegation,
i.e., reusing client&#8217;s ticket for accessing the LDAP. It only allows using
the member&#8217;s Kerberos credentials to authenticate into the LDAP.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_simplified_kerberos_configuration"><a class="anchor" href="#_simplified_kerberos_configuration"></a>Simplified Kerberos Configuration</h4>
<div class="paragraph">
<p>To simplify the Kerberos configuration process for new users, Hazelcast allows
skipping <code>Krb5LoginModule</code> JAAS configuration within separate security realms.
Instead it&#8217;s possible to define the <code>principal</code> and <code>keytabFile</code> options in the
<code>kerberos</code> identity and authentication configurations.
If these options are used instead of the <code>security-realm</code>, then a new temporary
realm is generated on the fly during the authentication.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hz:realm name="simpleKerberosRealm"&gt;
    &lt;hz:authentication&gt;
        &lt;hz:kerberos&gt;
            &lt;hz:principal&gt;hz/127.0.0.1@HAZELCAST.COM&lt;/hz:principal&gt;
            &lt;hz:keytab-file&gt;/opt/localhost.keytab&lt;/hz:keytab-file&gt;
        &lt;/hz:kerberos&gt;
    &lt;/hz:authentication&gt;
    &lt;hz:identity&gt;
        &lt;hz:kerberos&gt;
            &lt;hz:realm&gt;HAZELCAST.COM&lt;/hz:realm&gt;
            &lt;hz:principal&gt;hz/127.0.0.1@HAZELCAST.COM&lt;/hz:principal&gt;
            &lt;hz:keytab-file&gt;/opt/localhost.keytab&lt;/hz:keytab-file&gt;
        &lt;/hz:kerberos&gt;
    &lt;/hz:identity&gt;
&lt;/hz:realm&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">realms:
  - name: simpleKerberosRealm
    authentication:
      kerberos:
        principal: hz/127.0.0.1@HAZELCAST.COM
        keytab-file: /opt/localhost.keytab
    identity:
      kerberos:
        realm: HAZELCAST.COM
        principal: hz/127.0.0.1@HAZELCAST.COM
        keytab-file: /opt/localhost.keytab</code></pre>
</div>
</div>
<div class="paragraph">
<p>A warning is logged during the first usage of the simplified configuration form.
It includes the generated configuration, so you can use it as a starting point
to define the full Kerberos configuration. An example warning log is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>12:37:41,187  WARN [KerberosCredentialsFactory] Using generated Kerberos initiator
realm configuration is not intended for production use. It's recommended
to properly configure the Krb5LoginModule manually to fit your needs.
Following configuration was generated from provided keytab and principal properties:
&lt;realm name="krb5Initiator"&gt;
  &lt;authentication&gt;
    &lt;jaas&gt;
      &lt;login-module class-name="com.sun.security.auth.module.Krb5LoginModule" usage="REQUIRED"&gt;
        &lt;properties&gt;
          &lt;property name="isInitiator"&gt;true&lt;/property&gt;
          &lt;property name="useKeyTab"&gt;true&lt;/property&gt;
          &lt;property name="refreshKrb5Config"&gt;true&lt;/property&gt;
          &lt;property name="doNotPrompt"&gt;true&lt;/property&gt;
          &lt;property name="storeKey"&gt;true&lt;/property&gt;
          &lt;property name="keyTab"&gt;/opt/localhost.keytab&lt;/property&gt;
          &lt;property name="principal"&gt;hz/127.0.0.1@HAZELCAST.COM&lt;/property&gt;
        &lt;/properties&gt;
      &lt;/login-module&gt;
    &lt;/jaas&gt;
  &lt;/authentication&gt;
&lt;/realm&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tls_authentication_type"><a class="anchor" href="#_tls_authentication_type"></a>TLS Authentication Type</h4>
<div class="paragraph">
<p>Hazelcast is able to protect network communication using TLS.
The TLS mutual authentication is also supported. It means not only the
server side identifies itself to a client side (member, client, REST client, etc.),
but also the client side needs to prove its identity by using a TLS (X.509) certificate.</p>
</div>
<div class="paragraph">
<p>The <code>tls</code> authentication type verifies within the JAAS authentication
that the incoming connection already authenticated the client&#8217;s TLS certificate.
A <code>ClusterIdentityPrincipal</code> uses the subject DN (distinguished name)
from the client&#8217;s TLS certificate.</p>
</div>
<div class="paragraph">
<p>This authentication type is able to parse a role name from the client&#8217;s certificate
subject DN. The <code>&lt;tls&gt;</code> element has an attribute, <code>roleAttribute</code>, which specifies
a part of DN to be used as a role name.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">Unresolved include directive in modules/deploy/pages/security.adoc - include::javatestresource/hazelcast-authentication-types.xml[]</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">realms:
  name: tlsRealm
    authentication:
      tls:
        roleAttribute: cn</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>tls</code> authentication  uses <code>cn</code> attribute from the subject DN as the role name.
If the subject DN in the certificate is <code>cn=admin,ou=Devs,o=Hazelcast</code> for instance,
then the following <code>Principals</code> are added:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ClusterIdentityPrincipal: CN=admin,OU=Devs,O=Hazelcast</code></p>
</li>
<li>
<p><code>ClusterRolePrincipal: admin</code></p>
</li>
<li>
<p><code>ClusterEndpointPrincipal: [remote address of the connecting party]</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_identity_configuration"><a class="anchor" href="#_identity_configuration"></a>Identity Configuration</h3>
<div class="paragraph">
<p>The Identity configuration allows defining own <a href="#credentials">Credentials</a>.
These Credentials are used to authenticate to other systems.</p>
</div>
<div class="paragraph">
<p>Available identity configuration types are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>username-password</code>: Defines a new <code>PasswordCredentials</code> object.</p>
</li>
<li>
<p><code>token</code>: Defines a new <code>TokenCredentials</code> object.</p>
</li>
<li>
<p><code>kerberos</code>: Defines the Kerberos identity which uses the
service tickets stored in the <code>TokenCredentials</code> object.</p>
</li>
<li>
<p><code>credentials-factory</code>: Configures the factory class which creates the <code>Credentials</code> objects.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="credentials"><a class="anchor" href="#credentials"></a>Credentials</h4>
<div class="paragraph">
<p>One of the key elements in Hazelcast security is the <code>Credentials</code> object, which
represents evidence of the identity (member or client).
The content of <code>Credentials</code> object is verified during the authentication.
Credentials is an interface which extends <code>Serializable</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface Credentials extends Serializable {
    String getName();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two subtype interfaces which simplify the <code>Credentials</code> usage.
The subtypes reflect data provided in the client authentication messages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name and password (<code>com.hazelcast.security.PasswordCredentials</code>)</p>
</li>
<li>
<p>Byte array token (<code>com.hazelcast.security.TokenCredentials</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The interfaces have the following forms:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface PasswordCredentials extends Credentials {
    String getPassword();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface TokenCredentials extends Credentials {
  byte[] getToken();

  default Data asData() {
      return new HeapData(getToken());
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Credentials</code> instance can be retrieved in the login modules
by handling a <code>CredentialsCallback</code>.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_password_credentials"><a class="anchor" href="#_password_credentials"></a>Password Credentials</h4>
<div class="paragraph">
<p>A <code>PasswordCredentials</code> implementation can be configured as a
simple identity representation. It is configured by the <code>&lt;username-password/&gt;</code>
XML configuration element as shown below:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">Unresolved include directive in modules/deploy/pages/security.adoc - include::javatestresource/hazelcast-password-realm.xml[]</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">realms:
  name: passwordRealm
    identity:
      username-password:
        username: member1
        password: s3crEt
member-authentication:
  realm: passwordRealm</code></pre>
</div>
</div>
<div class="paragraph">
<p>The equivalent programmatic configuration is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_token_credentials"><a class="anchor" href="#_token_credentials"></a>Token Credentials</h4>
<div class="paragraph">
<p><code>TokenCredentials</code> instances are also simply configurable for
identity representation. The <code>&lt;token/&gt;</code> XML configuration element
allows using either plain ASCII tokens or Base64 encoded values.
Its optional argument <code>encoding</code> can have either <code>base64</code> or <code>none</code> (default)
as its value.</p>
</div>
<div class="paragraph">
<p>The following two realms define the same token value - bytes of the "Hazelcast" string:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">Unresolved include directive in modules/deploy/pages/security.adoc - include::javatestresource/hazelcast-authentication-types.xml[]</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">realms:
  name: tokenRealm1
    identity:
      token: Hazelcast
  name: tokenRealm2
    identity:
      token:
        encoding: base64
        value: SGF6ZWxjYXN0</code></pre>
</div>
</div>
<div class="paragraph">
<p>The equivalent programmatic configuration is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kerberos_identity"><a class="anchor" href="#_kerberos_identity"></a>Kerberos Identity</h4>
<div class="paragraph">
<p>The <code>kerberos</code> identity type is used to retrieve Kerberos service tickets to access
a member with the <code>kerberos</code> authentication type configured. The resulting tickets
are <code>TokenCredentials</code> instances. Read more about <code>kerberos</code> identity in
the <a href="#kerberos-authentication">Kerberos authentication section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_credentials_factory"><a class="anchor" href="#_credentials_factory"></a>Credentials Factory</h4>
<div class="paragraph">
<p>The most flexible way to define the <code>Credentials</code> objects
is using a custom credential factory. It is an implementation
of <code>com.hazelcast.security.ICredentialsFactory</code>
interface. Its <code>newCredentials()</code> method is the one which provides credentials.</p>
</div>
<div class="paragraph">
<p>The XML configuration uses <code>&lt;credentials-factory&gt;</code> element to define the factory class.</p>
</div>
<div class="paragraph">
<p>The behavior of credential factories can be controlled by specifying factory properties.
The properties are provided in the <code>init(Properties)</code> method.</p>
</div>
<div class="paragraph">
<p>A sample configuration is shown below:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">Unresolved include directive in modules/deploy/pages/security.adoc - include::javatestresource/hazelcast-authentication-types.xml[]</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">realms:
  name: credentialsFactoryRealm
    identity:
      credentials-factory:
        class-name: com.examples.TOTPCredentialsFactory
        properties:
          seed: 3132333435363738393031323334353637383930</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_security_realms_on_the_client_side"><a class="anchor" href="#_security_realms_on_the_client_side"></a>Security Realms on the Client Side</h3>
<div class="paragraph">
<p>Hazelcast IMDG 4.1 introduces a limited support of security realms in native clients.
The configuration allows specifying JAAS login modules which can be referenced from
the Kerberos identity configuration.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;security&gt;
    &lt;kerberos&gt;
        &lt;realm&gt;ACME.COM&lt;/realm&gt;
        &lt;security-realm&gt;krb5Initiator&lt;/security-realm&gt;
    &lt;/kerberos&gt;
    &lt;realms&gt;
        &lt;realm name="krb5Initiator"&gt;
            &lt;authentication&gt;
                &lt;jaas&gt;
                    &lt;login-module class-name="com.sun.security.auth.module.Krb5LoginModule" usage="REQUIRED"&gt;
                        &lt;properties&gt;
                            &lt;property name="useTicketCache"&gt;true&lt;/property&gt;
                            &lt;property name="doNotPrompt"&gt;true&lt;/property&gt;
                        &lt;/properties&gt;
                    &lt;/login-module&gt;
                &lt;/jaas&gt;
            &lt;/authentication&gt;
        &lt;/realm&gt;
    &lt;/realms&gt;
&lt;/security&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">security:
  kerberos:
    realm: ACME.COM
    security-realm: krb5Initiator
    realms:
      name: krb5Initiator
        authentication:
          jaas:
            class-name: com.sun.security.auth.module.Krb5LoginModule
            usage: REQUIRED
            properties:
              useTicketCache: true
              doNotPrompt: true</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jaas-authentication"><a class="anchor" href="#jaas-authentication"></a>JAAS authentication</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_jaas_principals_used_in_hazelcast"><a class="anchor" href="#_jaas_principals_used_in_hazelcast"></a>JAAS Principals used in Hazelcast</h3>
<div class="paragraph">
<p>Hazelcast works with the following JAAS <a href="https://docs.oracle.com/javase/8/docs/api/java/security/Principal.html" target="_blank" rel="noopener">Principal</a>
implementations added to the <a href="https://docs.oracle.com/javase/8/docs/api/javax/security/auth/Subject.html" target="_blank" rel="noopener">Subject</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ClusterIdentityPrincipal</code>: Represents the name of authenticated party (usually
one instance in the <code>Subject</code>).</p>
</li>
<li>
<p><code>ClusterRolePrincipal</code>: Represents the role assigned to the authenticated party
(usually zero or more instances in the <code>Subject</code>).</p>
</li>
<li>
<p><code>ClusterEndpointPrincipal</code>: Represents the remote address of the authenticated
party (usually one instance in the <code>Subject</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These implementations share a common abstract parent class <code>HazelcastPrincipal</code>,
so it is simple to find them in the JAAS <code>Subject</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Set&lt;HazelcastPrincipal&gt; hazelcastPrincipals =
            subject.getPrincipals(HazelcastPrincipal.class);</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_callbacks_supported_in_login_modules"><a class="anchor" href="#_callbacks_supported_in_login_modules"></a>Callbacks Supported in Login Modules</h4>
<div class="paragraph">
<p>JAAS <a href="https://docs.oracle.com/javase/8/docs/api/javax/security/auth/callback/Callback.html" target="_blank" rel="noopener">Callback</a>
instances are used for accessing different kinds of data from the
<a href="http://docs.oracle.com/javase/8/docs/api/javax/security/auth/spi/LoginModule.html" target="_blank" rel="noopener">LoginModule</a>
implementations. Hazelcast supports the following <code>Callback</code> types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>javax.security.auth.callback.NameCallback</code>: Retrieves a name from <code>Credentials</code> object.</p>
</li>
<li>
<p><code>javax.security.auth.callback.PasswordCallback</code>: Retrieves a password from <code>PasswordCredentials</code> object.</p>
</li>
<li>
<p><code>com.hazelcast.security.CertificatesCallback</code>: Retrieves the TLS certificate chain (if any) of the connecting party.</p>
</li>
<li>
<p><code>com.hazelcast.security.ClusterNameCallback</code>: Retrieves the cluster name used for the authentication.</p>
</li>
<li>
<p><code>com.hazelcast.security.CredentialsCallback</code>: Retrieves <code>Credentials</code> used for authentication.</p>
</li>
<li>
<p><code>com.hazelcast.security.ConfigCallback</code>: Retrieves the <code>Config</code> object of current Hazelcast member.</p>
</li>
<li>
<p><code>com.hazelcast.security.EndpointCallback</code>: Retrieves the remote address of the connecting party.</p>
</li>
<li>
<p><code>com.hazelcast.security.SerializationServiceCallback</code>: Retrieves <code>SerializationService</code> of current Hazelcast member.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The callbacks are usually used in the <code>login()</code> method of a login module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_clusterloginmodule"><a class="anchor" href="#_clusterloginmodule"></a>ClusterLoginModule</h3>
<div class="paragraph">
<p>Hazelcast has an abstract implementation of <code>LoginModule</code> that contains
shared logic and cleanup operations. It automatically creates the
<code>ClusterEndpointPrincipal</code> instance and it also provides the <code>addRole(String)</code>
method which simplifies adding the <code>ClusterRolePrincipal</code> instances.</p>
</div>
<div class="paragraph">
<p><code>ClusterLoginModule</code> implements all methods from the <code>LoginModule</code>
interface and makes them final. It provides protected methods with empty
implementations, e.g., <code>onCommit()</code>, to align the logic to user needs.
The module comes also with the following abstract methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getName()</code>: It is used to retrieve the name of <code>ClusterIdentityPrincipal</code>.</p>
</li>
<li>
<p><code>onLogin()</code>: Logic of the login method which needs to be provided.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Extending the <code>ClusterLoginModule</code> is recommended instead of implementing
all the required stuff from scratch.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public abstract class ClusterLoginModule implements LoginModule {

  protected abstract boolean onLogin() throws LoginException;
  protected abstract String getName();

  protected void onInitialize() {
  }

  protected boolean onCommit() throws LoginException {
      return true;
  }

  protected boolean onAbort() throws LoginException {
      return true;
  }

  protected boolean onLogout() throws LoginException {
      return true;
  }
  // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ClusterLoginModule</code> supports a basic set of login module options,
which allow skipping adding principals of a given type to the JAAS Subject.
It allows, for instance, to have just one <code>ClusterIdentityPrincipal</code> in
the <code>Subject</code> even if there are more login modules in the chain:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. ClusterLoginModule options</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Option Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>skipIdentity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don&#8217;t add any <code>ClusterIdentityPrincipal</code> to the Subject.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>skipRole</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don&#8217;t add any <code>ClusterRolePrincipal</code> to the Subject.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>skipEndpoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don&#8217;t add any <code>ClusterEndpointPrincipal</code> to the Subject.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_enterprise_integration"><a class="anchor" href="#_enterprise_integration"></a>Enterprise Integration</h3>
<div class="paragraph">
<p>Using the above API, you can implement a <code>LoginModule</code> that performs
authentication against the security system of your choice,
such databases, directory services or some other corporate standard you might have.
For example, you may wish to have your clients send an identification
token in the <code>Credentials</code> object.
This token can then be sent to your backend security system via the
<code>LoginModule</code> that runs on the cluster side.</p>
</div>
<div class="paragraph">
<p>Additionally, the same system may authenticate the user and also then
return the roles that are attributed to the user. These roles can then
be used for data structure authorization.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
See the <a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jaas/JAASRefGuide.html" target="_blank" rel="noopener">JAAS Reference Guide</a>
for further information.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cluster_member_security"><a class="anchor" href="#_cluster_member_security"></a>Cluster Member Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hazelcast supports the standard Java Security (JAAS) based authentication
between the cluster members. A <a href="#security-realms">Security Realm</a> can
be referenced by <code>&lt;member-authentication/&gt;</code> element to define authentication
between the member and identity of the current member.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;security enabled="true"&gt;
      &lt;realms&gt;
          &lt;realm name="memberRealm"&gt;
              &lt;authentication&gt;
                &lt;ldap&gt;
                    &lt;url&gt;ldap://corp-ldap.example.com/&lt;/url&gt;
                &lt;/ldap&gt;
              &lt;/authentication&gt;
              &lt;identity&gt;
                &lt;username-password username="uid=member1,dc=example,dc=com" password="s3crEt"/&gt;
              &lt;/identity&gt;
          &lt;/realm&gt;
      &lt;/realms&gt;
      &lt;member-authentication realm="memberRealm"/&gt;
    &lt;/security&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  security:
    enabled: true
    realms:
      name: memberRealm
      authentication:
        ldap:
          url: ldap://corp-ldap.example.com
      identity:
        username-password:
          username: uid=member1,dc=example,dc=com
          password: s3crEt
    member-authentication:
      realm: memberRealm</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="default-authentication"><a class="anchor" href="#default-authentication"></a>Default authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Default Authentication is used when security is enabled and no explicit
authentication configuration is provided. It can happen when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>member-authentication</code> is not configured</p>
</li>
<li>
<p>the security realm referenced by <code>member-authentication</code> doesn&#8217;t contain the <code>authentication</code> configuration</p>
</li>
<li>
<p><code>client-authentication</code> is not configured</p>
</li>
<li>
<p>the security realm referenced by <code>client-authentication</code> doesn&#8217;t contain the <code>authentication</code> configuration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The behavior of the default authentication mechanism depends on <strong>member&#8217;s identity configuration</strong>
(i.e., <code>identity</code> configuration in the security realm referenced from <code>member-authentication</code>).
If the <code>identity</code> is configured as a <code>username-password</code>, then the authenticated username and password
credentials are checked for equality with these configured ones. In all other cases, only the incoming
cluster name is checked for equality with the one configured on the authenticating member.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_native_client_security"><a class="anchor" href="#_native_client_security"></a>Native Client Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hazelcast&#8217;s Client security includes both authentication and authorization.</p>
</div>
<div class="sect2">
<h3 id="_authentication"><a class="anchor" href="#_authentication"></a>Authentication</h3>
<div class="paragraph">
<p>The authentication mechanism works in similar way as the cluster member authentication.</p>
</div>
<div class="paragraph">
<p>To implement the client authentication, you reference a <a href="#security-realms">Security Realm</a>
with the <code>authentication</code> section defined in the <code>&lt;client-authentication/&gt;</code> element
of a cluster member configuration.</p>
</div>
<div class="paragraph">
<p>The <code>authentication</code> configuration defines a method used to verify the client&#8217;s identity
and assign its roles.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;security enabled="true"&gt;
      &lt;realms&gt;
          &lt;realm name="clientRealm"&gt;
              &lt;authentication&gt;
                &lt;ldap&gt;
                    &lt;url&gt;ldap://corp-ldap.example.com/&lt;/url&gt;
                    &lt;role-mapping-attribute&gt;cn&lt;/role-mapping-attribute&gt;
                &lt;/ldap&gt;
              &lt;/authentication&gt;
          &lt;/realm&gt;
      &lt;/realms&gt;
      &lt;member-authentication realm="clientRealm"/&gt;
    &lt;/security&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yml hljs" data-lang="yml">hazelcast:
  security:
    enabled: true
    realms:
      name: clientRealm
      authentication:
        ldap:
          url: ldap://corp-ldap.example.com/
          role-mapping-attribute: cn
    member-authentication:
      realm: clientRealm</code></pre>
</div>
</div>
<div class="paragraph">
<p>The identity of the connecting client is defined on the client side.
Usually, there are no security realms on the clients, but just identity
defined directly in the security configuration:</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast-client&gt;
    ...
    &lt;security&gt;
      &lt;username-password username="uid=member1,dc=example,dc=com" password="s3crEt"/&gt;
    &lt;/security&gt;
    ...
&lt;/hazelcast-client&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yml hljs" data-lang="yml">hazelcast-client:
  security:
    username-password:
      username: uid=member1,dc=example,dc=com
      password: s3crEt</code></pre>
</div>
</div>
<div class="paragraph">
<p>On the clients, You can use the same identity types as in security realms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>username-password</code></p>
</li>
<li>
<p><code>token</code></p>
</li>
<li>
<p><code>kerberos</code> <em>(may require an additional security realm definition)</em></p>
</li>
<li>
<p><code>credentials-factory</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_authorization"><a class="anchor" href="#_authorization"></a>Authorization</h3>
<div class="paragraph">
<p>Hazelcast client authorization is configured by a client permission
policy. Hazelcast has a default permission policy implementation that uses
permission configurations defined in the Hazelcast security configuration.
Default policy permission checks are done against instance types (map, queue, etc.),
instance names (map, queue, name, etc.), instance actions (put, read, remove, add, etc.),
the client endpoint address (<code>ClusterEndpointPrincipal</code>) and client roles (<code>ClusterRolePrincipal</code>).</p>
</div>
<div class="paragraph">
<p>The default permission policy allows to use comma separated names in the <code>principal</code>
attribute configuration.</p>
</div>
<div class="paragraph">
<p>You can define the instance and principal names as wildcards using the <code>"*"</code> character.
See the <a href="#using-wildcards">Using Wildcards</a> section for details.</p>
</div>
<div class="paragraph">
<p>The endpoint names can use range characters <code>"-"</code> and <code>"*"</code> as described
in the <a href="#interfaces">Interfaces</a> section.</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;security enabled="true"&gt;
        &lt;client-permissions&gt;
            &lt;!-- Principals 'admin' and 'root' from endpoint '127.0.0.1' have all permissions. --&gt;
            &lt;all-permissions principal="admin,root"&gt;
                &lt;endpoints&gt;
                    &lt;endpoint&gt;127.0.0.1&lt;/endpoint&gt;
                &lt;/endpoints&gt;
            &lt;/all-permissions&gt;

            &lt;!-- Principals named 'dev' from all endpoints have 'create', 'destroy',
            'put', 'read' permissions for map named 'myMap'. --&gt;
            &lt;map-permission name="myMap" principal="dev"&gt;
                &lt;actions&gt;
                    &lt;action&gt;create&lt;/action&gt;
                    &lt;action&gt;destroy&lt;/action&gt;
                    &lt;action&gt;put&lt;/action&gt;
                    &lt;action&gt;read&lt;/action&gt;
                &lt;/actions&gt;
            &lt;/map-permission&gt;

            &lt;!-- All principals from endpoints '127.0.0.1' or matching to '10.10.*.*'
            have 'put', 'read', 'remove' permissions for map
            whose name matches to 'com.foo.entity.*'. --&gt;
            &lt;map-permission name="com.foo.entity.*"&gt;
                &lt;endpoints&gt;
                    &lt;endpoint&gt;10.10.*.*&lt;/endpoint&gt;
                    &lt;endpoint&gt;127.0.0.1&lt;/endpoint&gt;
                &lt;/endpoints&gt;
                &lt;actions&gt;
                    &lt;action&gt;put&lt;/action&gt;
                    &lt;action&gt;read&lt;/action&gt;
                    &lt;action&gt;remove&lt;/action&gt;
                &lt;/actions&gt;
            &lt;/map-permission&gt;

            &lt;!-- Principals named 'dev' from endpoints matching to either
            '192.168.1.1-100' or '192.168.2.*'
            have 'create', 'add', 'remove' permissions for all queues. --&gt;
            &lt;queue-permission name="*" principal="dev"&gt;
                &lt;endpoints&gt;
                    &lt;endpoint&gt;192.168.1.1-100&lt;/endpoint&gt;
                    &lt;endpoint&gt;192.168.2.*&lt;/endpoint&gt;
                &lt;/endpoints&gt;
                &lt;actions&gt;
                    &lt;action&gt;create&lt;/action&gt;
                    &lt;action&gt;add&lt;/action&gt;
                    &lt;action&gt;remove&lt;/action&gt;
                &lt;/actions&gt;
            &lt;/queue-permission&gt;

           &lt;!-- All principals from all endpoints have transaction permission.--&gt;
           &lt;transaction-permission /&gt;
       &lt;/client-permissions&gt;
    &lt;/security&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yml hljs" data-lang="yml">hazelcast:
  security:
    enabled: true
    client-permissions:
      on-join-operation: RECEIVE
      all:
        principal: admin,root
        endpoints:
          - 127.0.0.1
      map:
        - name: myMap
          principal: dev
          endpoints:
            - 127.0.0.1
          actions:
            - create
            - destroy
            - put
            - read
      map:
        - name: com.foo.entity
          principal: dev
          endpoints:
            - 10.10.*.*
            - 127.0.0.1
          actions:
            - put
            - read
            - remove
      queue:
        - name: "*"
          principal: dev
          endpoints:
            - 192.168.1.1-100
            - 192.168.2.*
          actions:
            - create
            - add
            - remove
      transaction:</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also define your own policy by implementing <code>com.hazelcast.security.IPermissionPolicy</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.hazelcast.security;
/**
 * IPermissionPolicy is used to determine any Subject's
 * permissions to perform a security sensitive Hazelcast operation.
 *
 */
public interface IPermissionPolicy {
  void configure( SecurityConfig securityConfig, Properties properties );

  PermissionCollection getPermissions( Subject subject,
                                       Class&lt;? extends Permission&gt; type );

  void destroy();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Permission policy implementations can access client-permissions that are in the
configuration by using <code>SecurityConfig.getClientPermissionConfigs()</code> when
Hazelcast calls the <code>configure(SecurityConfig securityConfig, Properties properties)</code> method.</p>
</div>
<div class="paragraph">
<p>The <code>IPermissionPolicy.getPermissions(Subject subject, Class&lt;? extends Permission&gt; type)</code>
method is used to determine a client request that has been granted permission to
perform a security-sensitive operation.</p>
</div>
<div class="paragraph">
<p>Permission policy should return a <code>PermissionCollection</code> containing permissions
of the given type for the given <code>Subject</code>. The Hazelcast access controller calls
<code>PermissionCollection.implies(Permission)</code> on returning <code>PermissionCollection</code> and
it decides whether the current <code>Subject</code> has permission to access the requested resources.</p>
</div>
</div>
<div class="sect2">
<h3 id="_permissions"><a class="anchor" href="#_permissions"></a>Permissions</h3>
<div class="paragraph">
<p>The following is the list of client permissions that can be configured on the member:</p>
</div>
<div class="paragraph">
<p><strong>All Permission:</strong></p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;all-permissions principal="principal"&gt;
    &lt;endpoints&gt;
        ...
    &lt;/endpoints&gt;
&lt;/all-permissions&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">all:
  principal: principal
  endpoints:
    - ..</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Map Permission:</strong></p>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, put, read, remove, lock, intercept, index, listen</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;map-permission name="name" principal="principal"&gt;
    &lt;endpoints&gt;
        ...
    &lt;/endpoints&gt;
    &lt;actions&gt;
        ...
    &lt;/actions&gt;
&lt;/map-permission&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">map:
  - name: name
    principal: principal
    endpoints:
      - ..
    actions:
      - ..</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Queue Permission:</strong></p>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, add, remove, read, listen</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;queue-permission name="name" principal="principal"&gt;
    &lt;endpoints&gt;
        ...
    &lt;/endpoints&gt;
    &lt;actions&gt;
        ...
    &lt;/actions&gt;
&lt;/queue-permission&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">queue:
  - name: name
    principal: principal
    endpoints:
      - ..
    actions:
      - ..</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Multimap Permission:</strong></p>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, put, read, remove, listen, lock</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;multimap-permission name="name" principal="principal"&gt;
    &lt;endpoints&gt;
        ...
    &lt;/endpoints&gt;
    &lt;actions&gt;
        ...
     &lt;/actions&gt;
&lt;/multimap-permission&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">multimap:
  - name: name
    principal: principal
    endpoints:
      - ..
    actions:
      - ..</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Topic Permission:</strong></p>
</div>
<div class="paragraph">
<p>Actions: create, destroy, publish, listen</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;topic-permission name="name" principal="principal"&gt;
    &lt;endpoints&gt;
        ...
    &lt;/endpoints&gt;
    &lt;actions&gt;
        ...
    &lt;/actions&gt;
&lt;/topic-permission&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">topic:
  - name: name
    principal: principal
    endpoints:
      - ..
    actions:
      - ..</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>List Permission:</strong></p>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, add, read, remove, listen</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;list-permission name="name" principal="principal"&gt;
    &lt;endpoints&gt;
        ...
    &lt;/endpoints&gt;
    &lt;actions&gt;
        ...
    &lt;/actions&gt;
&lt;/list-permission&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">list:
  - name: name
    principal: principal
    endpoints:
      - ..
    actions:
      - ..</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Set Permission:</strong></p>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, add, read, remove, listen</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;set-permission name="name" principal="principal"&gt;
    &lt;endpoints&gt;
        ...
    &lt;/endpoints&gt;
    &lt;actions&gt;
        ...
    &lt;/actions&gt;
&lt;/set-permission&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">set:
  - name: name
    principal: principal
    endpoints:
      - ..
    actions:
      - ..</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Lock Permission:</strong></p>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, lock, read</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;lock-permission name="name" principal="principal"&gt;
    &lt;endpoints&gt;
        ...
    &lt;/endpoints&gt;
    &lt;actions&gt;
        ...
    &lt;/actions&gt;
&lt;/lock-permission&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">lock:
  - name: name
    principal: principal
    endpoints:
      - ..
    actions:
      - ..</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>AtomicLong Permission:</strong></p>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, read, modify</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;atomic-long-permission name="name" principal="principal"&gt;
    &lt;endpoints&gt;
        ...
    &lt;/endpoints&gt;
    &lt;actions&gt;
        ...
    &lt;/actions&gt;
&lt;/atomic-long-permission&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">atomic-long:
  - name: name
    principal: principal
    endpoints:
      - ..
    actions:
      - ..</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>CountDownLatch Permission:</strong></p>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, read, modify</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;countdown-latch-permission name="name" principal="principal"&gt;
    &lt;endpoints&gt;
        ...
    &lt;/endpoints&gt;
    &lt;actions&gt;
        ...
    &lt;/actions&gt;
&lt;/countdown-latch-permission&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">countdown-latch:
  - name: name
    principal: principal
    endpoints:
      - ..
    actions:
      - ..</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>FlakeIdGenerator Permission:</strong></p>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, read, modify</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;flake-id-generator-permission name="name" principal="principal"&gt;
    &lt;endpoints&gt;
        ...
    &lt;/endpoints&gt;
    &lt;actions&gt;
        ...
    &lt;/actions&gt;
&lt;/flake-id-generator-permission&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">flake-id-generator:
  - name: name
    principal: principal
    endpoints:
      - ..
    actions:
      - ..</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Semaphore Permission:</strong></p>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, acquire, release, read</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;semaphore-permission name="name" principal="principal"&gt;
    &lt;endpoints&gt;
        ...
    &lt;/endpoints&gt;
    &lt;actions&gt;
        ...
    &lt;/actions&gt;
&lt;/semaphore-permission&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">semaphore:
  - name: name
    principal: principal
    endpoints:
      - ..
    actions:
      - ..</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Executor Service Permission:</strong></p>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;executor-service-permission name="name" principal="principal"&gt;
    &lt;endpoints&gt;
        ...
    &lt;/endpoints&gt;
    &lt;actions&gt;
        ...
    &lt;/actions&gt;
&lt;/executor-service-permission&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">executor-service:
  - name: name
    principal: principal
    endpoints:
      - ..
    actions:
      - ..</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Transaction Permission:</strong></p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;transaction-permission principal="principal"&gt;
    &lt;endpoints&gt;
        ...
    &lt;/endpoints&gt;
&lt;/transaction-permission&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">transaction:
  principal: principal
  endpoints:
    - ..</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Cache Permission:</strong></p>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, put, read, remove, listen</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;cache-permission name="/hz/cache-name" principal="principal"&gt;
    &lt;endpoints&gt;
        ...
    &lt;/endpoints&gt;
    &lt;actions&gt;
        ...
    &lt;/actions&gt;
&lt;/cache-permission&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">cache:
  - name: /hz/cache-name
    principal: principal
    endpoints:
      - ..
    actions:
      - ..</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The name provided in <code>cache-permission</code> must be the Hazelcast distributed
object name corresponding to the <code>Cache</code> as described in
the <a href="#jcache-hazelcast-instance-integration">JCache - Hazelcast Instance Integration section</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>User Code Deployment Permission:</strong></p>
</div>
<div class="paragraph">
<p>Actions: all, deploy</p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;user-code-deployment-permission principal="principal"&gt;
    &lt;endpoints&gt;
        ...
    &lt;/endpoints&gt;
    &lt;actions&gt;
        ...
    &lt;/actions&gt;
&lt;/user-code-deployment-permission&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">user-code-deployment:
  principal: principal
  endpoints:
    - ..
  actions:
    - ..</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_handling_permissions_when_a_new_member_joins"><a class="anchor" href="#_handling_permissions_when_a_new_member_joins"></a>Handling Permissions When a New Member Joins</h4>
<div class="paragraph">
<p>By default, the set of permissions defined in the leader member of a cluster is
distributed to the newly joining members, overriding their own permission
configurations, if any. However, you can configure a new member to be joined, so that
it keeps its own set of permissions and even send these to the existing members in
the cluster. This can be done dynamically, i.e., without needing to restart the
cluster, using either one of the following configuration options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>on-join-operation</code> configuration attribute</p>
</li>
<li>
<p>the <code>setOnJoinPermissionOperation()</code> method</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the above, you can choose whether a new member joining to a cluster will
apply the client permissions stored in its own configuration, or use the ones
defined in the cluster. The behaviors that you can specify with the configuration
are <code>RECEIVE</code>, <code>SEND</code> and <code>NONE</code>, which are described after the examples below.</p>
</div>
<div class="paragraph">
<p>The following are the examples for both approaches on how to use them:</p>
</div>
<div class="paragraph">
<p><strong>Declarative Configuration:</strong></p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;security enabled="true"&gt;
        &lt;client-permissions on-join-operation="SEND"&gt;
            &lt;!-- ... --&gt;
        &lt;/client-permissions&gt;
    &lt;/security&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  security:
    enabled: true
    client-permissions:
      on-join-operation: SEND</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic Configuration:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Config config = new Config();
config.getSecurityConfig()
    .setEnabled(true)
    .setOnJoinPermissionOperation(OnJoinPermissionOperationName.SEND);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The behaviors are explained below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>RECEIVE</code>: Applies the permissions from the leader member in the
cluster before join. This is the default value.</p>
</li>
<li>
<p><code>SEND</code>: Doesn&#8217;t apply the permissions from the leader member before join.
If the security is enabled, then it refreshes or replaces the cluster wide
permissions with the ones in the new member after the join is complete.
This option is suitable for the scenarios where you need to replace the
cluster wide permissions without restarting the cluster.</p>
</li>
<li>
<p><code>NONE</code>: Neither applies pre-join permissions, nor sends the local permissions
to the other members. It means that the new member does not send its own
permission definitions to the cluster, but keeps them when it joins. However,
after the join, when you update the permissions in the other cluster members,
those updates are also sent to the newly joining member. Therefore, this option
is suitable for the scenarios where you need to elevate privileges temporarily
on a single member (preferably a <a href="#enabling-lite-members">lite member</a>) for a
limited time period. The clients which want to use these temporary permissions
have to access the cluster through this single new member, meaning that you need
to disable <a href="#setting-smart-routing">smart routing</a> for such clients.</p>
<div class="paragraph">
<p>Note that, the <code>create</code> and <code>destroy</code> permissions will not work when using
the <code>NONE</code> option, since the distributed objects need to be created/destroyed on all the members.</p>
</div>
<div class="paragraph">
<p>The following is an example for a scenario where <code>NONE</code> is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">// temporary member, in the below case a lite member
Config config = new Config().setLiteMember(true);
PermissionConfig allPermission = new PermissionConfig(PermissionType.ALL, "*", null);
config.getSecurityConfig()
  .setEnabled(true)
  .setOnJoinPermissionOperation(OnJoinPermissionOperationName.NONE)
  .addClientPermissionConfig(allPermission);
HazelcastInstance hzLite = Hazelcast.newHazelcastInstance(config);

// temporary client connecting only to the lite member
String memberAddr = ...;
ClientConfig clientConfig = new ClientConfig();
clientConfig.getNetworkConfig().setSmartRouting(false)
  .addAddress(memberAddr);
HazelcastInstance client = HazelcastClient.newHazelcastClient(clientConfig);

// do operations with escalated privileges:
client.getMap("protectedConfig").put("master.resolution", "1920");

// shutdown the client and lite member
client.shutdown();
hzLite.shutdown();</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="auditlog"><a class="anchor" href="#auditlog"></a>Logging Auditable Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hazelcast IMDG Enterprise allows observing some important cluster events
using the Auditlog feature. Auditable events have a unique type ID;
they contain a timestamp and importance level.
The events may also contain a message and parameters.
Supported event type identifiers are listed in <a href="https://docs.hazelcast.org/docs/4.1/javadoc/com/hazelcast/auditlog/AuditlogTypeIds.html" target="_blank" rel="noopener"><code>AuditlogTypeIds</code></a>.</p>
</div>
<div class="paragraph">
<p>You can enable the auditlog feature in the configuration as follows:</p>
</div>
<div class="paragraph">
<p><strong>Declarative Configuration:</strong></p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;auditlog enabled="true" /&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  auditlog:
    enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic Configuration:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Config config = new Config();
config.getAuditLogConfig().setEnabled(true);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default auditlog implementation uses Hazelcast logging configuration and writes the events
as log entries with the category name <code>"hazelcast.auditlog"</code>.</p>
</div>
<div class="paragraph">
<p><strong>Sample Log4j2 configuration writing auditable events to a Syslog:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;Configuration&gt;
    &lt;Appenders&gt;
        &lt;Syslog name="Syslog" format="RFC5424"
            host="syslog.acme.com" port="514" protocol="TCP"
            appName="Hazelcast" newLine="true" messageId="Audit" id="hz" /&gt;
    &lt;/Appenders&gt;

     &lt;Loggers&gt;
        &lt;Logger name="hazelcast.auditlog" level="debug"&gt;
            &lt;AppenderRef ref="Syslog" /&gt;
        &lt;/Logger&gt;
    &lt;/Loggers&gt;
&lt;/Configuration&gt;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_auditlog_spi"><a class="anchor" href="#_auditlog_spi"></a>Auditlog SPI</h3>
<div class="paragraph">
<p>The auditlog has its own SPI allowing you to provide your implementations.
Relevant classes and interfaces are located
in the <a href="https://docs.hazelcast.org/docs/4.1/javadoc/com/hazelcast/auditlog/package-summary.html" target="_blank" rel="noopener"><code>com.hazelcast.auditlog</code> package</a>.</p>
</div>
<div class="paragraph">
<p>The central point of auditlog SPI is the
<a href="https://docs.hazelcast.org/docs/4.1/javadoc/com/hazelcast/auditlog/AuditlogService.html" target="_blank" rel="noopener"><code>AuditlogService</code> interface</a>
and its <code>log(&#8230;&#8203;)</code> methods. Their implementations are responsible for
processing auditable events, e.g., writing them to a database.</p>
</div>
<div class="paragraph">
<p><code>AuditlogService</code> also creates the
<a href="https://docs.hazelcast.org/docs/4.1/javadoc/com/hazelcast/auditlog/EventBuilder.html" target="_blank" rel="noopener"><code>EventBuilder</code></a>
instances which are used to build
<a href="https://docs.hazelcast.org/docs/4.1/javadoc/com/hazelcast/auditlog/AuditableEvent.html" target="_blank" rel="noopener"><code>AuditableEvents</code></a>.</p>
</div>
<div class="paragraph">
<p>Another important piece in the SPI is the
<a href="https://docs.hazelcast.org/docs/4.1/javadoc/com/hazelcast/auditlog/AuditlogServiceFactory.html" target="_blank" rel="noopener"><code>AuditlogServiceFactory</code> interface</a>.
The factory class allows the <code>AuditlogService</code> initialization based on parameters.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-debugging"><a class="anchor" href="#security-debugging"></a>Security Debugging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The biggest part of business logic related to security
in Hazelcast is located in the <code>com.hazelcast.security</code> Java package.
You can investigate the issues by printing more debug info from this package.</p>
</div>
<div class="paragraph">
<p>An example Log4J2 configuration is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;Configuration&gt;
    &lt;Loggers&gt;
        &lt;Logger name="com.hazelcast.security" level="ALL"/&gt;
    &lt;/Loggers&gt;
&lt;/Configuration&gt;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_java_security_debugging"><a class="anchor" href="#_java_security_debugging"></a>Java Security Debugging</h3>
<div class="paragraph">
<p>Java is able to print the debug information about using the security components.
During the security troubleshooting, it&#8217;s often helpful to print the additional
information by using the following system property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Djava.security.debug=all</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the
<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/troubleshooting-security.html" target="_blank" rel="noopener">Troubleshooting Security</a>
Java guide for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tls_debugging"><a class="anchor" href="#_tls_debugging"></a>TLS debugging</h3>
<div class="paragraph">
<p>To assist with the TLS/SSL issues, you can use the following
system property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Djavax.net.debug=all</code></pre>
</div>
</div>
<div class="paragraph">
<p>This property provides a lot of logging output including the TLS/SSL
handshake, that can be used to determine the cause of the problem. See the
<a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/ReadDebug.html" target="_blank" rel="noopener">Debugging TSL/SSL Connections</a>
guide for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fips_140_2"><a class="anchor" href="#_fips_140_2"></a>FIPS 140-2</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Federal Information Processing Standard (FIPS) 140-2 is a US government
computer security standard published by National Institute of Standards and
Technology (NIST). It specifies the security requirements for cryptographic
modules. FIPS 140-2 compliance is often a requirement of the software systems
used by the US government agencies.</p>
</div>
<div class="paragraph">
<p>The NIST manages a list of FIPS certified cryptographic modules. These modules
are certified under the Cryptographic Module Validation Program. The list can
be searched online <a href="https://csrc.nist.gov/projects/cryptographic-module-validation-program/validated-modules/search" target="_blank" rel="noopener">here</a>.</p>
</div>
<div class="paragraph">
<p>Hazelcast uses external modules for cryptographic tasks and it can be configured
to use a FIPS 140-2 validated module. It means most of the configuration
required for FIPS is outside of the Hazelcast configuration. To run
Hazelcast in the FIPS compliant mode you have to set the underlying Java
runtime into FIPS mode. It may also require switching the underlying
Operating System into the FIPS mode. We consider using a FIPS enabled OS as
a recommended approach even in cases when it&#8217;s not asked for explicitly.</p>
</div>
<div class="paragraph">
<p>Hazelcast is not an authority which should document switching different Java
runtimes into the FIPS mode. Please consult the documentation of your Java
version to learn how to enable the FIPS mode. Usually it means changing the
list of security providers in the <code>java.security</code> JREconfigurationfile.</p>
</div>
<div class="paragraph">
<p>Hazelcast is only responsible for enabling the OpenSSL native library into
FIPS mode (see the <a href="#integrating-openssl-boringssl">Integrating OpenSSL section</a>).
If the Hazelcast cluster configuration enables TLS communication using the
native OpenSSL library, you have to enable its FIPS mode in the Hazelcast
<code>OpenSSLEngineFactory</code> configuration.
The FIPS mode is controlled by an optional <code>true</code>/<code>false</code> property called
<code>fipsMode</code>. It is disabled by default.</p>
</div>
<div class="paragraph">
<p><strong>Example OpenSSL configuration in the FIPS mode:</strong></p>
</div>
<div class="listingblock primary">
<div class="title">XML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;network&gt;
        &lt;ssl enabled="true"&gt;
            &lt;factory-class-name&gt;com.hazelcast.nio.ssl.OpenSSLEngineFactory&lt;/factory-class-name&gt;

            &lt;properties&gt;
                &lt;property name="fipsMode"&gt;true&lt;/property&gt;
                &lt;property name="protocol"&gt;TLSv1.2&lt;/property&gt;
                &lt;property name="trustCertCollectionFile"&gt;trusted-certs.pem&lt;/property&gt;
                &lt;property name="keyFile"&gt;privkey.pem&lt;/property&gt;
                &lt;property name="keyCertChainFile"&gt;chain.pem&lt;/property&gt;
            &lt;/properties&gt;
        &lt;/ssl&gt;
    &lt;/network&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">YAML</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">hazelcast:
  network:
    ssl:
      enabled: true
      factory-class-name: com.hazelcast.nio.ssl.OpenSSLEngineFactory
      properties:
        fipsMode: true
        protocol: TLSv1.2
        trustCertCollectionFile: trusted-certs.pem
        keyFile: privkey.pem
        keyCertChainFile: chain.pem</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the <code>fipsMode</code> property is set to <code>true</code>, the native OpenSSL engine is
either set to the FIPS mode or an exception is thrown, e.g., in the cases when
OpenSSL is compiled without the FIPS support.</p>
</div>
<div class="paragraph">
<p>If there is more Hazelcast instances (members or clients) with TLS enabled
employing the OpenSSL, then all of them must have the <code>fipsMode</code> property
configured in the same way, either enabled or disabled.</p>
</div>
<div class="paragraph">
<p>When the FIPS mode is successfully enabled, you will see the following
<code>INFO</code> level message in the log files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>OpenSSL is enabled in FIPS mode.</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
BoringSSL libraries don&#8217;t support the FIPS mode.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_example_fips_140_2_environment"><a class="anchor" href="#_example_fips_140_2_environment"></a>Example FIPS 140-2 environment</h3>
<div class="paragraph">
<p>The FIPS environment configuration steps depend on the used operating system
and Java version. You should consult with their documentation for the specific configurations.</p>
</div>
<div class="paragraph">
<p>We will describe a sample configuration which uses Red Hat Enterprise Linux
(RHEL) version 7 and IBM Java SDK 8. If you find any difference between the
sample configuration described here and the documentation of the OS and Java
vendors, use the vendor&#8217;s up-to-date instructions instead.</p>
</div>
<div class="paragraph">
<p><strong>Switching RHEL 7 into the FIPS mode</strong></p>
</div>
<div class="paragraph">
<p>The steps on how to configure RHEL 7 in FIPS 140-2 mode are described in the
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/chap-federal_standards_and_regulations" target="_blank" rel="noopener">Security guide</a> on the Red Hat customer portal.</p>
</div>
<div class="paragraph">
<p>Perform the following steps for the already installed systems:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the <code>dracut-fips</code> package using the YUM package manager.</p>
</li>
<li>
<p>Run the <code>dracut</code>command to regenerate the <code>initramfs</code>file.</p>
</li>
<li>
<p>Add the <code>fips=1</code>option to the kernel command line of the boot loader.</p>
</li>
<li>
<p>Disable prelinking (if it was enabled before.</p>
</li>
<li>
<p>Reboot the system.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After finishing these steps, check if the FIPS mode is enabled by running
the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash"># Following command should print "crypto.fips_enabled = 1" (value 1 means the FIPS mode is enabled)
sysctl crypto.fips_enabled</code></pre>
</div>
</div>
<div class="paragraph">
<p>To automate theFIPS mode enablement on RHEL 7, you can check the script
which is shared in the <a href="https://access.redhat.com/discussions/3487481" target="_blank" rel="noopener">Red Hat discussion forum</a>.</p>
</div>
<div class="paragraph">
<p><strong>Switching IBM Java SDK into the FIPS mode</strong></p>
</div>
<div class="paragraph">
<p>IBM Java 8 provides the FIPS mode itself without any third party
dependencies.</p>
</div>
<div class="paragraph">
<p>Details on how to enable the FIPS 140-2 validated configuration can be
found in the <a href="https://www.ibm.com/support/knowledgecenter/SSYKE2_8.0.0/com.ibm.java.security.component.80.doc/security-component/security-overview.html" target="_blank" rel="noopener">Security guide</a> in the Java 8 documentation.</p>
</div>
<div class="paragraph">
<p>First, it&#8217;s necessary to edit the<code>jre/lib/security/java.security</code> file and
do the following changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Put <code>IBMJCEFIPS</code> as the first security provider. It will be the first provider
to be selected when a JCA API call is made without specifying an explicit security provider.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">security.provider.1=com.ibm.crypto.fips.provider.IBMJCEFIPS</code></pre>
</div>
</div>
<div class="paragraph">
<p>And re-number the original set of security providers by increasing the priority
of provider by one, i.e., the old <code>security.provider.1</code> becomes <code>security.provider.2</code> and so on.</p>
</div>
</li>
<li>
<p>Add the new security properties (related to handling TLS protected communication):</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-plain hljs" data-lang="plain">ssl.SocketFactory.provider=com.ibm.jsse2.SSLSocketFactoryImpl
ssl.ServerSocketFactory.provider=com.ibm.jsse2.SSLServerSocketFactoryImpl</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Security provider covering the TLS implementation in IBM Java is <code>IBMJSSE2</code>.
To instruct this provider about using the FIPS validated security primitives
(from<code>IBMJCEFIPS</code>), use additional system properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>-Dcom.ibm.jsse2.usefipsprovider=true -Dcom.ibm.jsse2.usefipsProviderName=IBMJCEFIPS</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<link rel="shortcut icon" href="http://hazelcast.com/images/favicon.png">
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/search.js" id="search-script" data-base-path="../../.." data-page-path="/hazelcast/4.1/deploy/security.html"></script>
<script async src="../../../_/../search-index.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
