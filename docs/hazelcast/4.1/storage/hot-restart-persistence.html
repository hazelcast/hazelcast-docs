<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hot Restart Persistence Hazelcast Documentation</title>
    <link rel="canonical" href="https://jakescahill.github.io/docs-poc/hazelcast/4.1/storage/hot-restart-persistence.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
<link rel="stylesheet" href="../../../_/css/expanded-image.css">

<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-M267KFN"></script>
<script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','GTM-M267KFN')</script>
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'GTM-M267KFN', 'auto')
ga('send', 'pageview')
</script>
<!-- End Google Analytics -->
<script src="https://kit.fontawesome.com/097f7829d8.js" crossorigin="anonymous"></script>
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://jakescahill.github.io/docs-poc">Hazelcast Documentation</a>
            <div class="navbar-item">
                <input id="search-input" type="text" placeholder="Search docs">
            </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://jakescahill.github.io/docs-poc/home/index.html">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://hazelcast.org/platform/">Hazelcast Cloud</a>
            <a class="navbar-item" href="https://hazelcast.org/imdg/">Hazelcast IMDG</a>
            <a class="navbar-item" href="https://jet-start.sh">Hazelcast Jet</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Learn</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://jakescahill.github.io/docs-poc/home/index.html">Docs</a>
            <a class="navbar-item" href="https://training.hazelcast.com/">Online Training</a>
            <a class="navbar-item" href="https://hazelcast.org/resources/">Search Resources</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://hazelcast.org/hub/">Hub</a>
            <a class="navbar-item" href="https://hazelcast.org/use-cases/">Use Cases</a>
            <a class="navbar-item" href="https://hazelcast.org/community/">Community</a>
            <a class="navbar-item" href="https://hazelcast.org/blog/">Blog</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://hazelcast.com/get-started/">Get Hazelcast</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="hazelcast" data-version="4.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Hazelcast IMDG</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Hazelcast IMDG Reference Manual</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../getting-started.html">Quickstart</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../overview/hazelcast-overview.html">Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview/what-is-imdg.html">What is Hazelcast IMDG?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview/architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview/topology.html">Topology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview/data-partitioning.html">Data Partitioning</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview/use-cases.html">Use Cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview/resources.html">Resources</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../installation/installing-upgrading.html">Installing and Upgrading</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/installing-using-cli.html">CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/installing-using-maven.html">Maven</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/installing-using-docker.html">Docker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/installing-using-download-archives.html">Download Archives</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/deploying-hazelcast-cloud.html">Hazelcast Cloud</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/deploying-in-kubernetes.html">Kubernetes/OpenShift Deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/deploying-in-vmware-tanzu.html">Deploying in VMware Tanzu</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/deploying-in-cloud.html">Deploying in Cloud Providers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/using-enterprise-edition.html">Using Pro and Enterprise editions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/rolling-upgrades.html">Rolling Member Upgrades</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/running-in-modular-java.html">Running in Modular Java</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../installation/supported-jvms.html">Supported Java Virtual Machines</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../starting-members-clients.html">Starting the Members and Clients</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../configuration/understanding-configuration.html">Understanding Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/configuring-declaratively.html">Configuring Declaratively</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/configuring-programmatically.html">Configuring Programmatically</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/configuring-with-system-properties.html">Configuring with System Properties</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/configuring-within-spring.html">Configuring within the Spring Context</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/overriding-configuration-settings.html">Overriding Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/dynamic-data-structure-configuration.html">Dynamically Adding Data Structure Configuration on a Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/checking-configuration.html">Checking Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/pattern-matcher.html">Configuration Pattern Matcher</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/using-wildcards.html">Using Wildcards</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/using-variables.html">Using Variables</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/variable-replacers.html">Variable Replacers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../clusters/setting-up-clusters.html">Setting Up Clusters</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clusters/discovery-mechanisms.html">Discovery Mechanisms</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clusters/discovering-by-auto-detection.html">Discovering Members by Auto Detection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clusters/discovering-by-tcp.html">Discovering Members by TCP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clusters/discovering-by-multicast.html">Discovering Members by Multicast</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clusters/discovering-native-clients.html">Discovering Native Clients</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clusters/creating-clusters.html">Creating Clusters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clusters/deploying-code-on-member.html">Deploying User Code on the Member</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clusters/deploying-code-from-clients.html">Deploying User Code from Clients</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clusters/accessing-domain-objects.html">Accessing Domain Objects without Domain Classes - BETA</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clusters/partition-group-configuration.html">Partition Group Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clusters/logging-configuration.html">Logging Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clusters/network-configuration.html">Other Network Configurations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clusters/failure-detector-configuration.html">Failure Detector Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clusters/advanced-network-configuration.html">Advanced Network Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../data-structures/distributed-data-structures.html">Distributed Data Structures</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/overview.html">Overview of Hazelcast Distributed Objects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/map.html">Map</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/queue.html">Queue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/priority-queue.html">Priority Queue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/multimap.html">MultiMap</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/set.html">Set</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/list.html">List</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/ringbuffer.html">Ringbuffer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/topic.html">Topic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/reliable-topic.html">Reliable Topic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/fencedlock.html">FencedLock</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/iatomiclong.html">IAtomicLong</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/isemaphore.html">ISemaphore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/iatomicreference.html">IAtomicReference</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/icountdownlatch.html">ICountDownLatch</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/pn-counter.html">PN Counter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/flake-id-generator.html">Flake ID Generator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/replicated-map.html">Replicated Map</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/cardinality-estimator-service.html">Cardinality Estimator Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data-structures/event-journal.html">Event Journal</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../events/distributed-events.html">Distributed Events</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/cluster-events.html">Cluster Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/object-events.html">Distributed Object Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/event-listeners-for-clients.html">Event Listeners for Hazelcast Clients</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../events/global-event-configuration.html">Global Event Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../hazelcast-jet.html">Hazelcast Jet</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../computing/distributed-computing.html">Distributed Computing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../computing/executor-service.html">Executor Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../computing/durable-executor-service.html">Durable Executor Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../computing/scheduled-executor-service.html">Scheduled Executor Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../computing/entry-processor.html">Entry Processor</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../sql/distributed-sql.html">SQL</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sql/querying-imap.html">Querying IMap</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sql/data-types.html">Data Types</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sql/select-statement.html">SELECT</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sql/expressions.html">Expressions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sql/lite-members.html">Lite Members</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sql/how-distributed-sql-works.html">How Distributed SQL Works</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../sql/sql-and-high-density-memory.html">SQL on Data Structures Backed by High-Density Memory Store</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../query/distributed-query.html">Distributed Query</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../query/how-distributed-query-works.html">How Distributed Query Works</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../query/custom-attributes.html">Custom Attributes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../query/aggregations.html">Aggregations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../query/projections.html">Projections</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../query/continuous-query-cache.html">Continuous Query Cache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../query/mapreduce-deprecation-and-removal.html">MapReduce Deprecation and Removal</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../cp-subsystem/cp-subsystem.html">CP Subsystem</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cp-subsystem/discovery-process.html">CP Discovery Process</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cp-subsystem/persistence.html">CP Subsystem Persistence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cp-subsystem/member-shutdown.html">CP Member Shutdown</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cp-subsystem/fault-tolerance.html">CP Subsystem&#8217;s Fault Tolerance Capabilities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cp-subsystem/listeners.html">CP Subsystem Listeners</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cp-subsystem/sessions.html">CP Sessions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cp-subsystem/fencedlock.html">FencedLock</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cp-subsystem/configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cp-subsystem/unsafe-mode.html">CP Subsystem Unsafe Mode</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cp-subsystem/management.html">CP Subsystem Management</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../transactions/transactions.html">Transactions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transactions/creating-a-transaction-interface.html">Creating a Transaction Interface</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../transactions/providing-xa-transactions.html">Providing XA Transactions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../jcache/jcache.html">Hazelcast JCache</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jcache/overview.html">JCache Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jcache/setup.html">JCache Setup and Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jcache/providers.html">JCache Providers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jcache/api.html">JCache API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jcache/api.html">JCache API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jcache/hazelcast-integration.html">JCache - Hazelcast Instance Integration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jcache/icache.html">Hazelcast JCache Extension - ICache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../jcache/tck.html">Testing for JCache Specification Compliance</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../integrated-clustering/integrated-clustering.html">Integrated Clustering</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrated-clustering/hibernate-second-level-cache.html">Integration with Hibernate Second Level Cache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrated-clustering/web-session-replication.html">Web Session Replications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrated-clustering/javaee.html">Integration with Java EE</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrated-clustering/spring.html">Integration with Spring</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="storage.html">Storage</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="high-density-memory.html">High-Density Memory Store</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sizing-practices.html">Sizing Practices</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="hot-restart-persistence.html">Hot Restart Persistence</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../striim-cdc.html">Database CDC Integration Using Striim Hot Cache</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../clients/hazelcast-clients.html">Hazelcast Clients</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clients/java.html">Java Client</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clients/cplusplus.html">C++ Client</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clients/dotnet.html">.NET Client</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clients/rest.html">REST Client</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clients/memcache.html">Memcache Client</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clients/python.html">Python Client</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clients/nodejs.html">Node.js Client</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../clients/go.html">Go Client</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../serialization/serialization.html">Serialization</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../serialization/interface-types.html">Serialization Interface Types</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../serialization/comparing-interfaces.html">Comparing Serialization Interfaces</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../serialization/implementing-java-serializable.html">Implementing Java Serializable and Externalizable</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../serialization/implementing-dataserializable.html">Implementing DataSerializable</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../serialization/implementing-portable-serialization.html">Implementing Portable Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../serialization/custom-serialization.html">Custom Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../serialization/global-serializer.html">Global Serializer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../serialization/implementing-hazelcastinstanceaware.html">Implementing HazelcastInstanceAware</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../serialization/untrusted-deserialization-protection.html">Untrusted Deserialization Protection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../serialization/serialization-configuration.html">Serialization Configuration Wrap-Up</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../management/management.html">Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../management/member-statistics.html">Getting Member Statistics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../management/jmx-api.html">JMX API per Member</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../management/jmx-monitoring.html">Monitoring with JMX</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../management/rest-endpoint-groups.html">Using the REST Endpoint Groups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../management/cluster-utilities.html">Cluster Utilities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../management/metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../management/diagnostics.html">Diagnostics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../management/health-check-monitoring.html">Health Check and Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../management/management-center.html">Management Center</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../management/license-info.html">License Information</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../management/instance-tracking.html">Instance Tracking</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../security/security.html">Security</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/enabling-jaas.html">Enabling JAAS Security</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/socket-interceptor.html">Socket Interceptor</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/security-interceptor.html">Security Interceptor</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/encryption.html">Encryption</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/tls-ssl.html">TLS/SSL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/integrating-openssl.html">Integrating OpenSSL / BoringSSL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/tls-configuration.html">Other TLS related configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/validating-secrets.html">Validating Secrets Using Strength Policy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/security-realms.html">Security Realms</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/jaas-authentication.html">JAAS authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/cluster-member-security.html">Cluster Member Security</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/default-authentication.html">Default authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/native-client-security.html">Native Client Security</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/logging-auditable-events.html">Logging Auditable Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/security-debugging.html">Security Debugging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/fips-140-2.html">FIPS 140-2</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../performance/performance.html">Performance</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../performance/pipelining.html">Pipelining</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../performance/data-affinity.html">Data Affinity</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../performance/cpu-thread-affinity.html">CPU Thread Affinity</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../performance/running-on-ec2.html">Running on EC2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../performance/back-pressure.html">Back Pressure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../performance/threading-model.html">Threading Model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../performance/slowoperationdetector.html">SlowOperationDetector</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../performance/near-cache.html">Near Cache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../performance/caching-deserialized-values.html">Caching Deserialized Values</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../simulator.html">Hazelcast Simulator</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../wan/wan.html">WAN Replication</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../wan/modes.html">WAN Replication Modes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../wan/quick-start.html">Quick Start</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../wan/defining-wan-replication.html">Configuring WAN Replication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../wan/configuring-for-map-and-cache.html">Configuring for IMap and ICache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../wan/advanced-features.html">Advanced Features</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../wan/tuning.html">Fine-Tuning WAN Replication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../wan/failures.html">Failure Detection and Recovery</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../wan/rest-api.html">REST API Wrap-Up</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../osgi/osgi.html">OSGI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../osgi/osgi-support.html">OSGI Support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../osgi/api.html">API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../osgi/configuring-osgi-support.html">Configuring Hazelcast OSGI Support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../osgi/design.html">Design</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../osgi/using-osgi-service.html">Using Hazelcast OSGI Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../extending-hazelcast/extending-hazelcast.html">Extending Hazelcast</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../extending-hazelcast/operationparker.html">OperationParker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../extending-hazelcast/discovery-spi.html">Discovery SPI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../extending-hazelcast/config-properties-spi.html">Config Properties SPI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../plugins/hazelcast-plugins.html">Hazelcast Plugins</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/cloud-discovery.html">Cloud Discovery Plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/web-session-replication.html">Web Session Replication Plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/framework-integration.html">Framework Integration Plugins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/other-integrations.html">Other Integrations</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../consistency-and-replication/consistency.html">Consistency and Replication Model</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../consistency-and-replication/replication-algorithm.html">Hazelcast&#8217;s Replication Algorithm</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../consistency-and-replication/invocation-lifecycle.html">Invocation Lifecycle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../consistency-and-replication/exactly-once-execution.html">Exactly-once, At-least-once or At-most-once Execution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../consistency-and-replication/indeterminateoperationstateexception.html">IndeterminateOperationStateException</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../network-partitioning/network-partitioning.html">Network Partitioning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network-partitioning/dealing-with-network-partitions.html">Dealing with Network Partitions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network-partitioning/split-brain-protection.html">Split-Brain Protection</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network-partitioning/split-brain-recovery.html">Split-Brain Recovery</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network-partitioning/partial-network-partitions.html">Partial Network Partitions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../system-properties.html">Appendix A: System Properties</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../migration-guides.html">Appendix B: Migration Guides</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../common-exception-types.html">Appendix C: Common Exception Types</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../licenses.html">Appendix D: License Questions</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../phone-homes.html">Appendix E: Phone Homes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../faq.html">Appendix F: Frequently Asked Questions</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../revision-history.html">Appendix G: Document Revision History</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../glossary.html">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Hazelcast IMDG</span>
    <span class="version">4.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Hazelcast IMDG</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">4.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Home</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../home/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../home/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Hazelcast IMDG</a></li>
    <li><a href="storage.html">Storage</a></li>
    <li><a href="hot-restart-persistence.html">Hot Restart Persistence</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Hot Restart Persistence</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><strong class="navy">Hazelcast IMDG Enterprise HD</strong></p>
</div>
<div class="paragraph">
<p>This chapter explains Hazelcast&#8217;s Hot Restart Persistence feature. It provides fast
cluster restarts by storing the states of the cluster members on the disk.
This feature is currently provided for the Hazelcast map data structure and Hazelcast JCache implementation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hot-restart-persistence-overview"><a class="anchor" href="#hot-restart-persistence-overview"></a>Hot Restart Persistence Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hot Restart Persistence enables you to get your cluster up and running swiftly
after a cluster restart. A restart can be caused by a planned shutdown
(including rolling upgrades) or a sudden cluster-wide crash, e.g., power outage.
For Hot Restart Persistence, required states for Hazelcast clusters and members are
introduced. See the <a href="../management/cluster-utilities.html#managing-cluster-and-member-states" class="page">Managing Cluster and Member States section</a>
for information on the cluster and member states. The purpose of the Hot Restart Persistence
is to provide a maintenance window for member operations and restart the cluster
in a fast way. It is not meant to recover the catastrophic shutdown of one member.</p>
</div>
<div class="paragraph">
<p>Hot Restart Persistence supports optional data encryption. See the <a href="#encryption-at-rest">Encryption at Rest section</a>
for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hot-restart-types"><a class="anchor" href="#hot-restart-types"></a>Hot Restart Types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Hot Restart feature is supported for the following restart types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Restart after a planned shutdown</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>The cluster is shut down completely and restarted with the exact same
previous setup and data.</p>
<div class="paragraph">
<p>You can shut down the cluster completely using the <code>HazelcastInstance.getCluster().shutdown()</code>
method or you can manually change the cluster state to <code>PASSIVE</code> and then shut
down each member one by one. When you send the command to shut the cluster down, i.e.,
<code>HazelcastInstance.getCluster().shutdown()</code>, the members that are not in the <code>PASSIVE</code>
state temporarily change their states to <code>PASSIVE</code>. Then, each member shuts itself down
by calling the method <code>HazelcastInstance.shutdown()</code>.</p>
</div>
<div class="paragraph">
<p>Difference between explicitly changing state to <code>PASSIVE</code> before shutdown and shutting
down cluster directly via <code>HazelcastInstance.getCluster().shutdown()</code> is, on the latter
case when cluster is restarted, the cluster state will be in the latest state before shutdown.
That means if cluster is <code>ACTIVE</code> before shutdown, cluster state automatically becomes
<code>ACTIVE</code> after restart is completed.</p>
</div>
</li>
<li>
<p>Rolling restart: The cluster is restarted intentionally member by member.
For example, this could be done to install an operating system patch or new hardware.</p>
<div class="paragraph">
<p>To be able to shut down the cluster member by member as part of a planned restart,
each member in the cluster should be in the <code>FROZEN</code> or <code>PASSIVE</code> state. After the
cluster state is changed to <code>FROZEN</code> or <code>PASSIVE</code>, you can manually shut down each
member by calling the method <code>HazelcastInstance.shutdown()</code>. When that member is
restarted, it rejoins the running cluster. After all members are restarted, the
cluster state can be changed back to <code>ACTIVE</code>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Restart after a cluster crash</strong>: The cluster is restarted after all its members
crashed at the same time due to a power outage, networking interruptions, etc.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="restart-process"><a class="anchor" href="#restart-process"></a>Restart Process</h2>
<div class="sectionbody">
<div class="paragraph">
<p>During the restart process, each member waits to load data until all the members in the
partition table are started. During this process, no operations are allowed. Once all
cluster members are started, Hazelcast changes the cluster state to <code>PASSIVE</code> and starts
to load data. When all data is loaded, Hazelcast changes the cluster state to its previous
known state before shutdown and starts to accept the operations which are allowed by the
restored cluster state.</p>
</div>
<div class="paragraph">
<p>If a member fails to either start, join the cluster in time (within the timeout), or
load its data, then that member is terminated immediately. After the problems causing
the failure are fixed, that member can be restarted. If the cluster start cannot be
completed in time, then all members fail to start. See the <a href="#configuring-hot-restart">Configuring Hot Restart section</a> for defining timeouts.</p>
</div>
<div class="paragraph">
<p>In the case of a restart after a cluster crash, the Hot Restart feature realizes that
it was not a clean shutdown and Hazelcast tries to restart the cluster with the last
saved data following the process explained above. In some cases, specifically when the
cluster crashes while it has an ongoing partition migration process, currently it is
not possible to restore the last saved state.</p>
</div>
<div class="sect2">
<h3 id="restart-of-a-member-in-running-cluster"><a class="anchor" href="#restart-of-a-member-in-running-cluster"></a>Restart of a Member in Running Cluster</h3>
<div class="paragraph">
<p>Assume the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You have a cluster consisting of members A, B and C with Hot Restart enabled,
which is initially stable.</p>
</li>
<li>
<p>Member B is killed.</p>
</li>
<li>
<p>Member B restarts.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since only a single member has failed, the cluster performed the standard
High Availability routine by recovering member B&#8217;s data from backups and
redistributing the data among the remaining members (the members A and C
in this case). Member B&#8217;s persisted Hot Restart data is completely irrelevant.</p>
</div>
<div class="paragraph">
<p>Furthermore, when a member starts with existing Hot Restart data,
it expects to find itself within a cluster that has been shut down
as a whole and is now restarting as a whole. Since the reality is that
the cluster has been running all along, member B&#8217;s persisted cluster state
does not match the actual state. Depending on the <a href="#configuring-hot-restart">automatic removal of stale data (<code>auto-remove-stale-data</code>)</a> configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>auto-remove-stale-data</code> is enabled, member B automatically deletes its
Hot Restart directory inside the <a href="#configuring-hot-restart">base directory</a>
(<code>base-dir</code>) and starts as a fresh, empty member. The cluster assigns some
partitions to it, unrelated to the partitions it owned before going down.</p>
</li>
<li>
<p>Otherwise, member B aborts the initialization and shuts down. To be able
to join the cluster, Hot Restart directory previously used by member B inside
the <a href="#configuring-hot-restart">base directory</a> (<code>base-dir</code>) must be deleted manually.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="force-start"><a class="anchor" href="#force-start"></a>Force Start</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A member can crash permanently and then be unable to recover from the failure.
In that case, restart process cannot be completed since some of the members do
not start or fail to load their own data. In that case, you can force the cluster
to clean its persisted data and make a fresh start. This process is called <strong>force start</strong>.</p>
</div>
<div class="paragraph">
<p>Assume the following which is a valid scenario to use force start:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You have a cluster consisting of members A and B which is initially stable.</p>
</li>
<li>
<p>Cluster transitions into <code>FROZEN</code> or <code>PASSIVE</code> state.</p>
</li>
<li>
<p>Cluster gracefully shuts down.</p>
</li>
<li>
<p>Member A restarts, but member B does not.</p>
</li>
<li>
<p>Member A uses its Hot Restart data to initiate the Hot Restart procedure.</p>
</li>
<li>
<p>Since it knows the cluster originally contained member B as well, it waits
for it to join.</p>
</li>
<li>
<p>This never happens.</p>
</li>
<li>
<p>Now you have the choice to Force Start the cluster without member B.</p>
</li>
<li>
<p>Cluster discards all Hot Restart data and starts empty.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can trigger the force start process using the Management Center,
REST API and cluster management scripts.</p>
</div>
<div class="paragraph">
<p>Please note that force start is a destructive process, which results
in deletion of persisted Hot Restart data.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#hot-restart" target="_blank" rel="noopener">Hot Restart functionality</a>
of the Management Center section to learn how you can perform a
force start using the Management Center.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="partial-start"><a class="anchor" href="#partial-start"></a>Partial Start</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When one or more members fail to start or have incorrect Hot Restart
data (stale or corrupted data) or fail to load their Hot Restart data,
cluster becomes incomplete and restart mechanism cannot proceed.
One solution is to use <a href="#force-start">Force Start</a> and make a fresh
start with existing members. Another solution is to do a partial start.</p>
</div>
<div class="paragraph">
<p>Partial start means that the cluster starts with an incomplete member set.
Data belonging to those missing members is assumed lost and Hazelcast tries
to recover missing data using the restored backups. For example, if you have
minimum two backups configured for all maps and caches, then a partial start
up to two missing members will be safe against data loss. If there are more
than two missing members or there are maps/caches with less than two backups,
then data loss is expected.</p>
</div>
<div class="paragraph">
<p>Partial start is controlled by <code>cluster-data-recovery-policy</code> configuration
parameter and is not allowed by default. To enable partial start, one of the
configuration values <code>PARTIAL_RECOVERY_MOST_RECENT</code> or <code>PARTIAL_RECOVERY_MOST_COMPLETE</code>
should be set. See the <a href="#configuring-hot-restart">Configuring Hot Restart section</a>
for details.</p>
</div>
<div class="paragraph">
<p>When partial start is enabled, Hazelcast can perform a partial start
automatically or manually, in case of some members are unable to restart
successfully. Partial start proceeds automatically when some members fail to
start and join to the cluster in <code>validation-timeout-seconds</code>. After the
<code>validation-timeout-seconds</code> duration is passed, Hot Restart chooses to perform
partial start with the members present in the cluster. Moreover, partial start can
be requested manually using the
<a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#hot-restart" target="_blank" rel="noopener">Management Center</a>,
<a href="../management/cluster-utilities.html#using-rest-api-for-cluster-management" class="page">REST API</a> and <a href="../management/cluster-utilities.html#example-usages-for-cluster-sh" class="page">cluster management scripts</a>
before the <code>validation-timeout-seconds</code> duration passes.</p>
</div>
<div class="paragraph">
<p>The other situation to decide to perform a partial start is failures during
the data load phase. When Hazelcast learns data load result of all members which
have passed the validation step, it automatically performs a partial start with
the ones which have successfully restored their Hot Restart data. Please note that
partial start does not expect every member to succeed in the data load step.
It completes the process when it learns data load result for every member and
there is at least one member which has successfully restored its Hot Restart data.
Relatedly, if it cannot learn data load result of all members before <code>data-load-timeout-seconds</code>
duration, it proceeds with the ones which have already completed the data load process.</p>
</div>
<div class="paragraph">
<p>Selection of members to perform partial start among live members is done
according to the <code>cluster-data-recovery-policy</code> configuration.
Set of members which are not selected by the <code>cluster-data-recovery-policy</code>
are called <code>Excluded members</code> and they are instructed to perform <a href="#force-start">force start</a>.
Excluded members are allowed to join cluster only when they clean their
Hot Restart data and make a fresh-new start. This is a completely automatic
process. For instance, if you start the missing members after partial start
is completed, they clean their Hot Restart data and join to the cluster.</p>
</div>
<div class="paragraph">
<p>Please note that partial start is a destructive process. Once it is completed,
it cannot be repeated with a new configuration. For this reason, one may need
to perform the partial start process manually. Automatic behavior of partial start
relies on <code>validation-timeout-seconds</code> and <code>data-load-timeout-seconds</code> configuration
values. If you need to control the process manually, <code>validation-timeout-seconds</code> and
<code>data-load-timeout-seconds</code> properties can be set to very big values so that
Hazelcast cannot make progress on timeouts automatically. Then, the overall
process can be managed manually via aforementioned methods, i.e.,
Management Center, REST API and cluster management scripts.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-hot-restart"><a class="anchor" href="#configuring-hot-restart"></a>Configuring Hot Restart</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can configure Hot Restart feature programmatically or declaratively.
There are two steps of configuration:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enabling and configuring the Hot Restart feature globally in your Hazelcast
configuration: This is done using the configuration element <code>hot-restart-persistence</code>.
See the <a href="#global-hot-restart-configuration">Global Hot Restart Configuration section</a> below.</p>
</li>
<li>
<p>Enabling and configuring the Hazelcast data structures to use the
Hot Restart feature: This is done using the configuration element <code>hot-restart</code>.
See the <a href="#per-data-structure-hot-restart-configuration">Per Data Structure Hot Restart Configuration section</a> below.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="global-hot-restart-configuration"><a class="anchor" href="#global-hot-restart-configuration"></a>Global Hot Restart Configuration</h3>
<div class="paragraph">
<p>This is where you configure the Hot Restart feature itself using the
<code>hot-restart-persistence</code> element. The following are the descriptions of its attribute and sub-elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code>: Attribute of the <code>hot-restart-persistence</code> element which
specifies whether the feature is globally enabled in your Hazelcast
configuration. Set this attribute to <code>true</code> if you want any of your
data structures to use the Hot Restart feature.</p>
</li>
<li>
<p><code>base-dir</code>: Specifies the parent directory where the Hot Restart data
is stored. The default value for <code>base-dir</code> is <code>hot-restart</code>. You can use
the default value, or you can specify the value of another folder containing
the Hot Restart configuration, but it is mandatory that <code>base-dir</code> element has
a value. This directory is created automatically if it does not exist.</p>
<div class="paragraph">
<p><code>base-dir</code> is used as the parent directory, and a unique Hot Restart
directory is created inside <code>base-dir</code> for each Hazelcast member which
uses the same <code>base-dir</code>. That means, <code>base-dir</code> can be shared among
multiple Hazelcast members safely. This is especially useful for cloud
environments where the members generally use a shared filesystem.</p>
</div>
<div class="paragraph">
<p>When a Hazelcast member starts, it tries to acquire the ownership of the
first available Hot Restart directory inside the <code>base-dir</code>. If <code>base-dir</code>
is empty or if the starting member fails to acquire the ownership of any
directory (happens when all the directories are already acquired by other
Hazelcast members), then it creates its own fresh directory.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Previously, <code>base-dir</code> was being used only by a single Hazelcast member.
If such an existing <code>base-dir</code> is configured for a Hazelcast member, Hot Restart
starts in legacy mode and <code>base-dir</code> is used only by a single member, without
creating a unique sub-directory. Other members trying to use that <code>base-dir</code>
fails during the startup.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>backup-dir</code>: Specifies the directory under which Hot Restart snapshots
(Hot Backups) are stored. See the <a href="#hot-backup">Hot Backup section</a> for
more information.</p>
</li>
<li>
<p><code>parallelism</code>: Level of parallelism in Hot Restart Persistence. There
are this many I/O threads, each writing in parallel to its own files.
During the Hot Restart procedure, this many I/O threads are reading the files
and this many rebuilder threads are rebuilding the Hot Restart metadata. The
default value for this property is 1. This is a good default in most but not
all cases. You should measure the raw I/O throughput of your infrastructure and
test with different values of parallelism. In some cases such as dedicated
hardware higher parallelism can yield more throughput of Hot Restart. In other
cases such as running on EC2, it can yield diminishing returns - more thread
scheduling, more contention on I/O and less efficient garbage collection.</p>
</li>
<li>
<p><code>validation-timeout-seconds</code>: Validation timeout for the Hot Restart process
when validating the cluster members expected to join and the partition table on the whole cluster.</p>
</li>
<li>
<p><code>data-load-timeout-seconds</code>: Data load timeout for the Hot Restart process.
All members in the cluster should finish restoring their local data before this timeout.</p>
</li>
<li>
<p><code>cluster-data-recovery-policy</code>: Specifies the data recovery policy that is
respected during the Hot Restart cluster start. Valid values are;</p>
<div class="ulist">
<ul>
<li>
<p><code>FULL_RECOVERY_ONLY</code>: Starts the cluster only when all expected members
are present and correct. Otherwise, it fails. This is the default value.</p>
</li>
<li>
<p><code>PARTIAL_RECOVERY_MOST_RECENT</code>: Starts the cluster with the members which have
most up-to-date partition table and successfully restored their data. All other
members leave the cluster and force start themselves. If no member restores its
data successfully, cluster start fails.</p>
</li>
<li>
<p><code>PARTIAL_RECOVERY_MOST_COMPLETE</code>: Starts the cluster with the largest group of
members which have the same partition table version and successfully restored their
data. All other members leave the cluster and force start themselves. If no member
restores its data successfully, cluster start fails.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>auto-remove-stale-data</code>: Enables automatic removal of the stale Hot Restart data.
When a member terminates or crashes when the cluster state is <code>ACTIVE</code>, the remaining
members redistribute the data among themselves and the data persisted on terminated
member&#8217;s storage becomes stale. That terminated member cannot rejoin the cluster
without removing Hot Restart data. When auto-removal of stale Hot Restart data is enabled,
while restarting that member, Hot Restart data is automatically removed and it joins
the cluster as a completely new member. Otherwise, Hot Restart data should be removed manually.</p>
</li>
<li>
<p><code>encryption-at-rest</code>: Configures encryption on the Hot Restart data level.
See the <a href="#encryption-at-rest">Encryption at Rest section</a> for more information.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="per-data-structure-hot-restart-configuration"><a class="anchor" href="#per-data-structure-hot-restart-configuration"></a>Per Data Structure Hot Restart Configuration</h3>
<div class="paragraph">
<p>This is where you configure the data structures of your choice, so that they can
have the Hot Restart feature. This is done using the <code>hot-restart</code> configuration
element. As it is explained in the <a href="#hot-restart-persistence">introduction</a>
paragraph, Hot Restart feature is currently supported by Hazelcast map data
structure and JCache implementation (<code>map</code> and <code>cache</code>), each of which has the
<code>hot-restart</code> configuration element. The following are the descriptions of this
element&#8217;s attribute and sub-element:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code>: Attribute of the <code>hot-restart</code> element which specifies whether the
Hot Restart feature is enabled for the related data structure. Its default value
is <code>false</code>.</p>
</li>
<li>
<p><code>fsync</code>: Turning on <code>fsync</code> guarantees that data is persisted to the disk
device when a write operation returns successful response to the caller. By default,
<code>fsync</code> is turned off (<code>false</code>). That means data is persisted to the disk device
eventually, instead of on every disk write. This generally provides a better performance.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="hot-restart-configuration-examples"><a class="anchor" href="#hot-restart-configuration-examples"></a>Hot Restart Configuration Examples</h3>
<div class="paragraph">
<p>The following are example configurations for a Hazelcast map and JCache implementation.</p>
</div>
<div class="paragraph">
<p><strong>Declarative Configuration</strong>:</p>
</div>
<div class="paragraph">
<p>An example configuration is shown below.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_xml"></a>XML</p>
</li>
<li>
<p><a id="tabset1_yaml"></a>YAML</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_xml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;hot-restart-persistence enabled="true"&gt;
        &lt;base-dir&gt;/mnt/hot-restart&lt;/base-dir&gt;
        &lt;backup-dir&gt;/mnt/hot-backup&lt;/backup-dir&gt;
        &lt;validation-timeout-seconds&gt;120&lt;/validation-timeout-seconds&gt;
        &lt;data-load-timeout-seconds&gt;900&lt;/data-load-timeout-seconds&gt;
        &lt;cluster-data-recovery-policy&gt;FULL_RECOVERY_ONLY&lt;/cluster-data-recovery-policy&gt;
    &lt;/hot-restart-persistence&gt;
    ...
    &lt;map name="test-map"&gt;
        &lt;hot-restart enabled="true"&gt;
            &lt;fsync&gt;false&lt;/fsync&gt;
        &lt;/hot-restart&gt;
    &lt;/map&gt;
    ...
    &lt;cache name="test-cache"&gt;
        &lt;hot-restart enabled="true"&gt;
            &lt;fsync&gt;false&lt;/fsync&gt;
        &lt;/hot-restart&gt;
    &lt;/cache&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">hazelcast:
  hot-restart-persistence:
    enabled: true
    base-dir: /mnt/hot-restart
    backup-dir: /mnt/hot-backup
    validation-timeout-seconds: 120
    data-load-timeout-seconds: 900
    cluster-data-recovery-policy: FULL_RECOVERY_ONLY
  map:
    test-map:
      hot-restart:
        enabled: true
        fsync: false
  cache:
    test-cache:
      hot-restart:
        enabled: true
        fsync: false</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic Configuration</strong>:</p>
</div>
<div class="paragraph">
<p>The programmatic equivalent of the above declarative configuration is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        Config config = new Config();
        HotRestartPersistenceConfig hotRestartPersistenceConfig = new HotRestartPersistenceConfig()
        .setEnabled(true)
        .setBaseDir(new File("/mnt/hot-restart"))
        .setParallelism(1)
        .setValidationTimeoutSeconds(120)
        .setDataLoadTimeoutSeconds(900)
        .setClusterDataRecoveryPolicy(HotRestartClusterDataRecoveryPolicy.FULL_RECOVERY_ONLY)
        .setAutoRemoveStaleData(true);
        config.setHotRestartPersistenceConfig(hotRestartPersistenceConfig);

        MapConfig mapConfig = config.getMapConfig("test-map");
        mapConfig.getHotRestartConfig().setEnabled(true);

        CacheSimpleConfig cacheConfig = config.getCacheConfig("test-cache");
        cacheConfig.getHotRestartConfig().setEnabled(true);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-hot-restart-store-on-intel-optane-dc-persistent-memory"><a class="anchor" href="#configuring-hot-restart-store-on-intel-optane-dc-persistent-memory"></a>Configuring Hot Restart Store on Intel Optane DC Persistent Memory</h3>
<div class="paragraph">
<p>Hazelcast can be configured to use Intel Optane DC Persistent Memory as
the Hot Restart directory. For this, you need to perform the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure the Persistent Memory as a File System</p>
</li>
<li>
<p>Configure the Hot Restart Store to Use Persistent Memory</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Using Persistent Memory, Hot Restart times can be drastically improved.
You can find the configuration steps in the Hot Restart Store section
of the <a href="https://hazelcast.com/resources/hazelcast-deployment-operations-guide/" target="_blank" rel="noopener">Hazelcast IMDG Operations and Deployment Guide</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="movingcopying-hot-restart-data"><a class="anchor" href="#movingcopying-hot-restart-data"></a>Moving/Copying Hot Restart Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After Hazelcast member owning the Hot Restart data is shutdown, Hot Restart
<code>base-dir</code> can be copied/moved to a different server (which may have different
IP address and/or different number of CPU cores) and Hazelcast member can be
restarted using the existing Hot Restart data on that new server. Having a new
IP address does not affect Hot Restart, since it does not rely on the IP address
of the server but instead uses <code>Member</code> UUID as a unique identifier.</p>
</div>
<div class="paragraph">
<p>This flexibility provides the following abilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Replacing one or more faulty servers with the new ones easily without
touching remaining cluster.</p>
</li>
<li>
<p>Using Hot Restart on the cloud environments easily. Sometimes cloud providers
do not preserve the IP addresses on restart or after shutdown. Also it is
possible to startup the whole cluster on a different set of machines.</p>
</li>
<li>
<p>Copying production data to the test environment, so that a more functional
test cluster can bet setup.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unfortunately having different number of CPU cores is not that straightforward.
Hazelcast partition threads, by default, uses a heuristic from the number of
cores, e.g., <code># of partition threads = # of CPU cores</code>. When a Hazelcast member
is started on a server with a different CPU core count, number of Hazelcast
partition threads changes and that makes Hot Restart fail during the startup.
Solution is to explicitly set number of Hazelcast partition threads
(<code>hazelcast.operation.thread.count</code> system property) and Hot Restart <code>parallelism</code>
configuration and use the same parameters on the new server. For setting system
properties see the <a href="../system-properties.html" class="page">System Properties appendix</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hot-restart-persistence-design-details"><a class="anchor" href="#hot-restart-persistence-design-details"></a>Hot Restart Persistence Design Details</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hazelcast&#8217;s Hot Restart Persistence uses the log-structured
storage approach. The following is a top-level design description:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The only kind of update operation on persistent data is <em>appending</em>.</p>
</li>
<li>
<p>What is appended are facts about events that happened to the data model
represented by the store; either a new value was assigned to a key or a key was removed.</p>
</li>
<li>
<p>Each record associated with a key makes stale the previous record
that was associated with that key.</p>
</li>
<li>
<p>Stale records contribute to the amount of <em>garbage</em> present in
the persistent storage.</p>
</li>
<li>
<p>Measures are taken to remove garbage from the storage.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This kind of design focuses almost all of the system&#8217;s complexity
into the garbage collection (GC) process, stripping down the client&#8217;s
operation to the bare necessity of guaranteeing persistent behavior: a
simple file append operation. Consequently, the latency of operations is
close to the theoretical minimum in almost all cases. Complications arise
only during prolonged periods of maximum load; this is where the details of
the GC process begin to matter.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="concurrent-incremental-generational-gc"><a class="anchor" href="#concurrent-incremental-generational-gc"></a>Concurrent, Incremental, Generational GC</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to maintain the lowest possible footprint in the update operation
latency, the following properties are built into the garbage collection process:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A dedicated thread performs the GC. In Hazelcast terms, this thread
is called the Collector and the application thread is called the Mutator.</p>
</li>
<li>
<p>On each update there is metadata to be maintained; this is done asynchronously
by the Collector thread. The Mutator enqueues update events to the Collector&#8217;s work queue.</p>
</li>
<li>
<p>The Collector keeps draining its work queue at all times, including the time
it goes through the GC cycle. Updates are taken into account at each stage in the
GC cycle, preventing the copying of already dead records into compacted files.</p>
</li>
<li>
<p>All GC-induced I/O competes for the same resources as the Mutator&#8217;s update operations.
Therefore, measures are taken to minimize the impact of I/O done during GC:</p>
<div class="ulist">
<ul>
<li>
<p>data is never read from files, but from RAM</p>
</li>
<li>
<p>a heuristic scheme is employed which minimizes the number of bytes written
to the disk for each kilobyte of the reclaimed garbage</p>
</li>
<li>
<p>measures are also taken to achieve a good interleaving of Collector and
Mutator operations, minimizing latency outliers perceived by the Mutator</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="io-minimization-scheme"><a class="anchor" href="#io-minimization-scheme"></a>I/O Minimization Scheme</h3>
<div class="paragraph">
<p>The success of this scheme is subject to a bet on the Weak Generational Garbage Hypothesis,
which states that a new record entering the system is likely to become garbage soon.
In other words, a key updated now is more likely than average to be updated again soon.</p>
</div>
<div class="paragraph">
<p>The scheme was taken from the seminal Sprite LFS paper,
<a href="http://www.cs.berkeley.edu/~brewer/cs262/LFS.pdf" target="_blank" rel="noopener">Rosenblum, Ousterhout, <em>The Design and Implementation of a Log-Structured File System</em></a>.
The following is an outline of the paper:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Data is not written to one huge file, but to many files of moderate size (8 MB) called "chunks".</p>
</li>
<li>
<p>Garbage is collected incrementally, i.e. by choosing several chunks, then
copying all their live data to new chunks, then deleting the old ones.</p>
</li>
<li>
<p>I/O is minimized using a collection technique which results in a bimodal
distribution of chunks with respect to their garbage content: most files
are either almost all live data or they are all garbage.</p>
</li>
<li>
<p>The technique consists of two main principles:</p>
<div class="ulist">
<ul>
<li>
<p>Chunks are selected based on their <em>Cost-Benefit factor</em> (see below).</p>
</li>
<li>
<p>Records are sorted by age before copying to new chunks.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="cost-benefit-factor"><a class="anchor" href="#cost-benefit-factor"></a>Cost-Benefit Factor</h3>
<div class="paragraph">
<p>The Cost-Benefit factor of a chunk consists of two components multiplied together:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The ratio of benefit (amount of garbage that can be collected) to
I/O cost (amount of live data to be written).</p>
</li>
<li>
<p>The age of the data in the chunk, measured as the age of the
youngest record it contains.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The essence is in the second component: given equal amount of garbage in all chunks,
it makes the young ones less attractive to the Collector.
Assuming the generational garbage hypothesis, this allows the young chunks to
quickly accumulate more garbage. On the flip side, it also ensures that even
files with little garbage are eventually garbage collected. This removes garbage
which would otherwise linger on, thinly spread across many chunk files.</p>
</div>
<div class="paragraph">
<p>Sorting records by age groups the young records together in a single chunk and
does the same for older records. Therefore the chunks are either tend to keep
their data live for a longer time, or quickly become full of garbage.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hot-restart-performance-considerations"><a class="anchor" href="#hot-restart-performance-considerations"></a>Hot Restart Performance Considerations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section you can find performance test summaries which are results of
benchmark tests performed with a single Hazelcast member running on a physical server and on AWS R3.</p>
</div>
<div class="sect2">
<h3 id="performance-on-a-physical-server"><a class="anchor" href="#performance-on-a-physical-server"></a>Performance on a Physical Server</h3>
<div class="paragraph">
<p>We have tested a member which has an IMap with High-Density Data Store.
Its data size is changed for each test, started from 10 GB to 500 GB
(each map entry has a value of 1 KB).</p>
</div>
<div class="paragraph">
<p>The tests investigate the write and read performance of Hot Restart Persistence and
are performed on HP ProLiant servers with RHEL 7 operating system using Hazelcast Simulator.</p>
</div>
<div class="paragraph">
<p>The following are the specifications of the server hardware used for the test:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CPU: 2x Intel&#174; Xeon&#174; CPU E5-2687W v3 @ 3.10GHz  with 10 cores per processor.
Total 20 cores, 40 with hyper threading enabled.</p>
</li>
<li>
<p>Memory: 768GB 2133 MHz memory 24x HP 32GB 4Rx4 PC4-2133P-L Kit</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following are the storage media used for the test:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A hot-pluggable 2.5 inch HDD with 1 TB capacity and 10K RPM.</p>
</li>
<li>
<p>An SSD, Light Endurance PCle Workload Accelerator.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The below table shows the test results.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/HotRestartPerf.png" alt="Hot Restart Perf"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="performance-on-aws-r3"><a class="anchor" href="#performance-on-aws-r3"></a>Performance on AWS R3</h3>
<div class="paragraph">
<p>We have tested a member which has an IMap with High-Density Data Store:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>This map has 40 million distinct keys, each map entry is 1 KB.</p>
</li>
<li>
<p>High-Density Memory Store is 59 GiB whose 19% is metadata.</p>
</li>
<li>
<p>Hot Restart is configured with <code>fsync</code> turned off.</p>
</li>
<li>
<p>Data size reloaded on restart is 38 GB.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The tests investigate the write and read performance of Hot Restart Persistence
and are performed on R3.2xlarge and R3.4xlarge EC2 instances using Hazelcast Simulator.</p>
</div>
<div class="paragraph">
<p>The following are the AWS storage types used for the test:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Elastic Block Storage (EBS) General Purpose SSD (GP2)</p>
</li>
<li>
<p>Elastic Block Storage with Provisioned IOPS (IO1) (Provisioned 10,000 IOPS on a
340 GiB volume, enabled EBS-optimized on instance)</p>
</li>
<li>
<p>SSD-backed instance store</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The below table shows the test results.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/HotRestartPerf2.png" alt="Hot Restart Perf2"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hot-backup"><a class="anchor" href="#hot-backup"></a>Hot Backup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>During Hot Restart operations you can take a snapshot of the Hot Restart Store
at a certain point in time. This is useful when you wish to bring up a new cluster
with the same data or parts of the data. The new cluster can then be used to share
load with the original cluster, to perform testing, QA or reproduce an issue on production data.</p>
</div>
<div class="paragraph">
<p>Simple file copying of a currently running cluster does not suffice and can produce
inconsistent snapshots with problems such as resurrection of deleted values or missing values.</p>
</div>
<div class="sect2">
<h3 id="configuring-hot-backup"><a class="anchor" href="#configuring-hot-backup"></a>Configuring Hot Backup</h3>
<div class="paragraph">
<p>To create snapshots you must first configure the Hot Restart backup directory.
You can configure the directory programmatically or declaratively using the following configuration element:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>backup-dir</code>: This element is included in the <code>hot-restart-persistence</code> and
denotes the destination under which backups are stored. If this element is not defined,
hot backup is disabled. If a directory is defined which does not exist, it is created on
the first backup. To avoid clashing data on multiple backups, each backup has a unique
sequence ID which determines the name of the directory which contains all Hot Restart data.
This unique directory is created as a subdirectory of the configured <code>backup-dir</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following are the example configurations for Hot backup.</p>
</div>
<div class="paragraph">
<p><strong>Declarative Configuration</strong>:</p>
</div>
<div class="paragraph">
<p>An example configuration is shown below.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_xml"></a>XML</p>
</li>
<li>
<p><a id="tabset2_yaml"></a>YAML</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_xml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;hot-restart-persistence enabled="true"&gt;
        &lt;backup-dir&gt;/mnt/hot-backup&lt;/backup-dir&gt;
	...
    &lt;/hot-restart-persistence&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">hazelcast:
  hot-restart-persistence:
    enabled: true
    backup-dir: /mnt/hot-backup</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic Configuration</strong>:</p>
</div>
<div class="paragraph">
<p>The programmatic equivalent of the above declarative configuration is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HotRestartPersistenceConfig hotRestartPersistenceConfig = new HotRestartPersistenceConfig();
hotRestartPersistenceConfig.setBackupDir(new File("/mnt/hot-backup"));
...
config.setHotRestartPersistenceConfig(hotRestartPersistenceConfig);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-hot-backup"><a class="anchor" href="#using-hot-backup"></a>Using Hot Backup</h3>
<div class="paragraph">
<p>Once configured, you can initiate a new backup via API or from the Management Center.
The backup is started transactionally and cluster-wide. This means that either
all or none of the members start the same backup. The member which receives the backup
request determines a new backup sequence ID and send that information to all members.
If all members respond that no other backup is currently in progress and that
no other backup request has already been made, then the coordinating member commands
the other members to start the actual backup process. This creates a directory under
the configured <code>backup-dir</code> with the name <code>backup-&lt;backupSeq&gt;</code> and start copying the
data from the original store.</p>
</div>
<div class="paragraph">
<p>The backup process is initiated nearly instantaneously on all members. Note that
since there is no limitation as to when the backup process is initiated, it may be
initiated during membership changes, partition table changes or during normal data update.
Some of these operations may not be completed fully yet, which means that some members
will backup some data while some members will backup a previous version of the same data.
This is usually solved by the anti-entropy mechanism on the new cluster which
reconciles different versions of the same data. Please check the
<a href="#achieving-high-consistency-of-backup-data">Achieving High Consistency of Backup Data section</a>
for more information.</p>
</div>
<div class="paragraph">
<p>The duration of the backup process and the disk data usage drastically depends on
what is supported by the system and the configuration. Please check the
<a href="#achieving-high-performance-of-backup-process">Achieving high performance of backup process section</a>
for more information on achieving better resource usage of the backup process.</p>
</div>
<div class="paragraph">
<p>Following is an example of how to trigger the Hot Backup via API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HotRestartService service = instance.getCluster().getHotRestartService();
service.backup();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>backupSeq</code> is generated by the hot backup process, but you can define
your own backup sequences as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HotRestartService service = instance.getCluster().getHotRestartService();
long backupSeq = ...
service.backup(backupSeq);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Keep in mind that the backup fails if any member contains a backup directory
with the name <code>backup-&lt;backupSeq&gt;</code>, where <code>backupSeq</code> is the given sequence.</p>
</div>
</div>
<div class="sect2">
<h3 id="starting-the-cluster-from-a-hot-backup"><a class="anchor" href="#starting-the-cluster-from-a-hot-backup"></a>Starting the Cluster From a Hot Backup</h3>
<div class="paragraph">
<p>As mentioned in the previous section, hot backup process creates subdirectories
named <code>backup-&lt;backupSeq&gt;</code> under the configured <a href="#configuring-hot-backup">hot backup directory</a>
(i.e., <code>backup-dir</code>). When starting your cluster with data from a hot backup, you need to set
the <a href="#global-hot-restart-configuration">base directory</a> (i.e., <code>base-dir</code>) to the desired backup subdirectory.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say you have configured your hot backup directory as follows:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset3_xml"></a>XML</p>
</li>
<li>
<p><a id="tabset3_yaml"></a>YAML</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset3_xml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;hot-restart-persistence enabled="true"&gt;
        &lt;backup-dir&gt;/mnt/hot-backup&lt;/backup-dir&gt;
	...
    &lt;/hot-restart-persistence&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset3_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">hazelcast:
  hot-restart-persistence:
    enabled: true
    backup-dir: /mnt/hot-backup</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And let&#8217;s say you have a subdirectory named <code>backup-2018Oct24</code> under the
backup directory <code>/mnt/hot-backup</code>. When you want to start your cluster with data
from this backup (<code>backup-2018Oct24</code>), here is the configuration you should have
for the <code>base-dir</code> while starting the cluster:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset4_xml"></a>XML</p>
</li>
<li>
<p><a id="tabset4_yaml"></a>YAML</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset4_xml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;hot-restart-persistence enabled="true"&gt;
        &lt;base-dir&gt;backup-2018Oct24&lt;/base-dir&gt;
        &lt;parallelism&gt;1&lt;/parallelism&gt;
    &lt;/hot-restart-persistence&gt;
    ...
    &lt;map name="test-map"&gt;
        &lt;hot-restart enabled="true"&gt;
            &lt;fsync&gt;false&lt;/fsync&gt;
        &lt;/hot-restart&gt;
    &lt;/map&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset4_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">hazelcast:
  hot-restart-persistence:
    enabled: true
    base-dir: backup-2018Oct24
    parallelism: 1
  map:
    test-map:
      hot-restart:
        enabled: true
        fsync: false</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="achieving-high-consistency-of-backup-data"><a class="anchor" href="#achieving-high-consistency-of-backup-data"></a>Achieving High Consistency of Backup Data</h3>
<div class="paragraph">
<p>The backup is initiated nearly simultaneously on all members but you can
encounter some inconsistencies in the data. This is because some members might have
and some might not have received updated values yet from executed operations,
because the system could be undergoing partition and membership changes or
because there are some transactions which have not yet been committed.</p>
</div>
<div class="paragraph">
<p>To achieve a high consistency of data on all members, the cluster should be
put to <code>PASSIVE</code> state for the duration of the call to the backup method.
See the <a href="../management/cluster-utilities.html#cluster-member-states" class="page">Cluster Member States section</a> on information on how to do this.
The cluster does not need to be in <code>PASSIVE</code> state for the entire
duration of the backup process, though. Because of the design, only partition metadata
is copied synchronously during the invocation of the backup method. Once the backup method has returned,
all cluster metadata is copied and the exact partition data which needs to be copied is marked.
After that, the backup process continues asynchronously and you can return the cluster to the
<code>ACTIVE</code> state and resume operations.</p>
</div>
</div>
<div class="sect2">
<h3 id="achieving-high-performance-of-backup-process"><a class="anchor" href="#achieving-high-performance-of-backup-process"></a>Achieving High Performance of Backup Process</h3>
<div class="paragraph">
<p>Because of the design of Hot Restart Store, we can use hard links to achieve
backups/snapshots of the store. The hot backup process uses hard links
whenever possible because they provide big performance benefits and because
the backups share disk usage.</p>
</div>
<div class="paragraph">
<p>The performance benefit comes from the fact that Hot Restart file contents are
not being duplicated (thus using disk and I/O resources) but rather a new file name
is created for the same contents on disk (another pointer to the same inode).
Since all backups and stores share the same inode, disk usage drops.</p>
</div>
<div class="paragraph">
<p>The bigger the percentage of stable data in the Hot Restart Store
(data not undergoing changes), the more files each backup shares with the operational
Hot Restart Store and the less disk space it uses. For the hot backup to use hard links,
you must be running Hazelcast members on JDK 7 or higher and must satisfy all requirements for the
<a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#createLink(java.nio.file.Path,%20java.nio.file.Path)" target="_blank" rel="noopener">Files.createLink() method</a> to be supported.</p>
</div>
<div class="paragraph">
<p>The backup process initially attempts to create a new hard link and
if that fails for any reason it continues by copying the data.
Subsequent backups also attempt to use hard links.</p>
</div>
</div>
<div class="sect2">
<h3 id="backup-process-progress-and-completion"><a class="anchor" href="#backup-process-progress-and-completion"></a>Backup Process Progress and Completion</h3>
<div class="paragraph">
<p>Only cluster and distributed object metadata is copied synchronously
during the invocation of the backup method. The rest of the
Hot Restart Store containing partition data is copied asynchronously
after the method call has ended. You can track the progress by API or
view it from the Management Center.</p>
</div>
<div class="paragraph">
<p>An example of how to track the progress via API is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HotRestartService service = instance.getCluster().getHotRestartService();
BackupTaskStatus status = service.getBackupTaskStatus();
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The returned object contains the local member&#8217;s backup status:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the backup state (NOT_STARTED, IN_PROGRESS, FAILURE, SUCCESS)</p>
</li>
<li>
<p>the completed count</p>
</li>
<li>
<p>the total count</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The completed and total count can provide you a way to track the
percentage of the copied data. Currently the count defines the
number of copied and total local member Hot Restart Stores
(defined by <code>HotRestartPersistenceConfig.setParallelism()</code>)
but this can change at a later point to provide greater resolution.</p>
</div>
<div class="paragraph">
<p>Besides tracking the Hot Restart status by API, you can view the status in the
Management Center and you can inspect the on-disk files for each member.
Each member creates an <code>inprogress</code> file which is created in each of the copied Hot Restart Stores.
This means that the backup is currently in progress. When the backup task completes
the backup operation, this file is removed. If an error occurs during the backup task,
the <code>inprogress</code> file is renamed to <code>failure</code> which contains a stack trace of the exception.</p>
</div>
</div>
<div class="sect2">
<h3 id="backup-task-interruption-and-cancellation"><a class="anchor" href="#backup-task-interruption-and-cancellation"></a>Backup Task Interruption and Cancellation</h3>
<div class="paragraph">
<p>Once the backup method call has returned and asynchronous copying of the
partition data has started, the backup task can be interrupted.
This is helpful in situations where the backup task has started at an inconvenient time.
For instance, the backup task could be automatized and it could be accidentally triggered
during high load on the Hazelcast instances, causing the performance of the Hazelcast instances to drop.</p>
</div>
<div class="paragraph">
<p>The backup task mainly uses disk IO, consumes little CPU and it generally
does not last for a long time (although you should test it with your environment
to determine the exact impact). Nevertheless, you can abort the backup tasks
on all members via a cluster-wide interrupt operation.
This operation can be triggered programmatically or from the Management Center.</p>
</div>
<div class="paragraph">
<p>An example of programmatic interruption is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HotRestartService service = instance.getCluster().getHotRestartService();
service.interruptBackupTask();
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method sends an interrupt to all members.
The interrupt is ignored if the backup task is currently not in progress
so you can safely call this method even though it has previously been
called or when some members have already completed their local backup tasks.</p>
</div>
<div class="paragraph">
<p>You can also interrupt the local member backup task as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">HotRestartService service = instance.getCluster().getHotRestartService();
service.interruptLocalBackupTask();
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The backup task stops as soon as possible and it does not remove the
disk contents of the backup directory meaning that you must remove it manually.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="encryption-at-rest"><a class="anchor" href="#encryption-at-rest"></a>Encryption at Rest</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Records stored in the Hot Restart Store may contain sensitive information. This sensitive
information may be present in the keys, in the values, or in both. In Hot Restart terms,
Encryption at Rest concerns with encryption on the chunk file level. Since complete chunk
files are encrypted, all data stored in the Hot Restart Store is protected when
Encryption at Rest is enabled.</p>
</div>
<div class="paragraph">
<p>Data persisted in the Hot Restart Store is encrypted using symmetric encryption. The
implementation is based on
<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html" target="_blank" rel="noopener">Java Cryptography Architecture</a> (JCA).
The encryption scheme uses two levels of encryption keys: auto-generated Hot Restart
Store-level encryption keys (one per configured parallelism) that are used to encrypt
the chunk files and a master encryption key that is used to encrypt the store-specific
encryption keys. The master encryption key is sourced from an external system called Secure
Store and, in contrast to the Hot Restart Store-level encryption keys, it is not persisted
anywhere within the Hot Restart Store.</p>
</div>
<div class="paragraph">
<p>When Hot Restart with Encryption at Rest is first enabled on a member, the member contacts
the Secure Store during the startup and retrieves the master encryption key. Then it generates
the Hot Restart Store-level encryption keys for the parallel Stores and stores them (encrypted
using the master key) under the Hot Restart Store&#8217;s directory. The subsequent writes to Hot
Restart chunk files will be encrypted using the Store-level encryption key. During Hot Restart,
the member retrieves the master encryption key from the Secure Store, decrypts the Store-level
encryption keys and uses those to decrypt the chunk files.</p>
</div>
<div class="paragraph">
<p>Master key rotation is supported. If the master encryption key changes in the Secure Store,
the Hot Restart subsystem will detect it and retrieve the new master encryption key. During
this process, it will also re-encrypt the Hot Restart Store-level encryption keys using
the new master encryption key.</p>
</div>
<div class="paragraph">
<p>The <a href="#configuring-secure-store">Configuring a Secure Store section</a> provides information
about the supported Secure Store types.</p>
</div>
<div class="sect2">
<h3 id="configuring-encryption-at-rest"><a class="anchor" href="#configuring-encryption-at-rest"></a>Configuring Encryption at Rest</h3>
<div class="paragraph">
<p>Encryption at Rest can be enabled and configured programmatically or declaratively using the
<code>encryption-at-rest</code> sub-element of <code>hot-restart-persistence</code>. The <code>encryption-at-rest</code>
element has the following attributes and sub-elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code>: Attribute that specifies whether Encryption at Rest is enabled; <code>false</code>
by default.</p>
</li>
<li>
<p><code>algorithm</code>: Specifies the symmetric cipher to use (such as <code>AES/CBC/PKCS5Padding</code>).</p>
</li>
<li>
<p><code>salt</code>: The encryption salt.</p>
</li>
<li>
<p><code>key-size</code>: The size of the auto-generated Hot Restart Store-level encryption key.</p>
</li>
<li>
<p><code>secure-store</code>: Specifies the Secure Store to use for the retrieval of master
encryption keys. See the <a href="#configuring-secure-store">Configuring a Secure Store section</a>
for more details.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following are the example configurations for Encryption at Rest.</p>
</div>
<div class="paragraph">
<p><strong>Declarative Configuration</strong>:</p>
</div>
<div class="paragraph">
<p>An example configuration is shown below.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset5_xml"></a>XML</p>
</li>
<li>
<p><a id="tabset5_yaml"></a>YAML</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset5_xml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;hazelcast&gt;
    ...
    &lt;hot-restart-persistence enabled="true"&gt;
        ...
        &lt;encryption-at-rest enabled="true"&gt;
            &lt;algorithm&gt;AEC/CBC/PKCS5Padding&lt;/algorithm&gt;
            &lt;salt&gt;thesalt&lt;/salt&gt;
            &lt;key-size&gt;128&lt;/key-size&gt;
            &lt;secure-store&gt;...&lt;/secure-store&gt;
        &lt;/encryption-at-rest&gt;
        ...
    &lt;/hot-restart-persistence&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset5_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">hazelcast:
  hot-restart-persistence:
    enabled: true
    encryption-at-rest:
      enabled: true
      algorithm: AES/CBC/PKCS5Padding
      salt: thesalt
      key-size: 128
      secure-store:
         ...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic Configuration</strong>:</p>
</div>
<div class="paragraph">
<p>The programmatic equivalent of the above declarative configuration is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        HotRestartPersistenceConfig hotRestartPersistenceConfig = new HotRestartPersistenceConfig();
        EncryptionAtRestConfig encryptionAtRestConfig =
                hotRestartPersistenceConfig.getEncryptionAtRestConfig();
        encryptionAtRestConfig.setEnabled(true)
                .setAlgorithm("AES/CBC/PKCS5Padding")
                .setSalt("thesalt")
                .setKeySize(128)
                .setSecureStoreConfig(secureStore());</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-secure-store"><a class="anchor" href="#configuring-secure-store"></a>Configuring a Secure Store</h3>
<div class="paragraph">
<p>A Secure Store represents a (secure) source of master encryption keys and
is required for using Encryption at Rest.</p>
</div>
<div class="paragraph">
<p>Hazelcast IMDG Enterprise provides Secure Store implementations for the
<a href="https://docs.oracle.com/javase/8/docs/api/java/security/KeyStore.html" target="_blank" rel="noopener">Java KeyStore</a>
and for <a href="https://www.vaultproject.io/" target="_blank" rel="noopener">HashiCorp Vault</a>.</p>
</div>
<div class="paragraph">
<p><strong>Java KeyStore Secure Store</strong></p>
</div>
<div class="paragraph">
<p>The Java KeyStore Secure Store provides integration with the <a href="https://docs.oracle.com/javase/8/docs/api/java/security/KeyStore.html" target="_blank" rel="noopener">Java KeyStore</a>.
It can be configured programmatically or declaratively using the
<code>keystore</code> sub-element of <code>secure-store</code>. The <code>keystore</code> element has the following sub-elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>path</code>: The path to the KeyStore file.</p>
</li>
<li>
<p><code>type</code>: The type of the KeyStore (<code>PKCS12</code>, <code>JCEKS</code>, etc.).</p>
</li>
<li>
<p><code>password</code>: The KeyStore password.</p>
</li>
<li>
<p><code>current-key-alias</code>: The alias for the current encryption key entry (optional).</p>
</li>
<li>
<p><code>polling-interval</code>: The polling interval (in seconds) for checking for changes in the KeyStore.
Disabled by default.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Sensitive configuration properties such as <code>password</code> should be protected using
<a href="../configuration/variable-replacers.html" class="page">encryption replacers</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Java KeyStore Secure treats all <code>KeyStore.SecretKeyEntry</code> entries stored in the KeyStore as
encryption keys. It expects that these entries use the same protection password as the KeyStore
itself. Entries of other types (private key entries, certificate entries) are ignored. If
<code>current-key-alias</code> is set, the corresponding entry will be treated as the current encryption key;
otherwise, the highest entry in the alphabetical order will be used. The remaining entries will
represent historical versions of the encryption key.</p>
</div>
<div class="paragraph">
<p>An example declarative configuration is shown below:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset6_xml"></a>XML</p>
</li>
<li>
<p><a id="tabset6_yaml"></a>YAML</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset6_xml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;secure-store&gt;
    &lt;keystore&gt;
        &lt;path&gt;/path/to/keystore.file&lt;/path&gt;
        &lt;type&gt;PKCS12&lt;/type&gt;
        &lt;password&gt;password&lt;/password&gt;
        &lt;current-key-alias&gt;current&lt;/current-key-alias&gt;
        &lt;polling-interval&gt;60&lt;/polling-interval&gt;
    &lt;/keystore&gt;
&lt;/secure-store&gt;</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset6_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">      secure-store:
        keystore:
          path: /path/to/keystore.file
          type: PKCS12
          password: password
          current-key-alias: current
          polling-interval: 60</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following is an equivalent programmatic configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        JavaKeyStoreSecureStoreConfig keyStoreConfig =
                new JavaKeyStoreSecureStoreConfig(new File("/path/to/keystore.file"))
                        .setType("PKCS12")
                        .setPassword("password")
                        .setCurrentKeyAlias("current")
                        .setPollingInterval(60);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>HashiCorp Vault Secure Store</strong></p>
</div>
<div class="paragraph">
<p>The HashiCorp Vault Secure Store provides integration with <a href="https://www.vaultproject.io/" target="_blank" rel="noopener">HashiCorp Vault</a>.
It can be configured programmatically or declaratively using the
<code>vault</code> sub-element of <code>secure-store</code>. The <code>vault</code> element has the following sub-elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>address</code>: The address of the Vault server.</p>
</li>
<li>
<p><code>secret-path</code>: The secret path under which the encryption keys are stored.</p>
</li>
<li>
<p><code>token</code>: The Vault authentication token.</p>
</li>
<li>
<p><code>polling-interval</code>: The polling interval (in seconds) for checking for changes in Vault. Disabled
by default.</p>
</li>
<li>
<p><code>ssl</code>: The TLS/SSL configuration for HTTPS support. See the <a href="../security/tls-ssl.html" class="page">TLS/SSL section</a> for more
information about how to use the <code>ssl</code> element.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Sensitive configuration properties such as <code>token</code> should be protected using
<a href="../configuration/variable-replacers.html" class="page">encryption replacers</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The HashiCorp Vault Secure Store implementation uses the official REST API to integrate with
HashiCorp Vault. Only for the <a href="https://www.vaultproject.io/docs/secrets/kv/index.html" target="_blank" rel="noopener">KV secrets engine</a>,
both KV V1 and KV V2 can be used, but since only V2 provides secrets versioning, this is
the recommended option. With KV V1 (no versioning support), only one version of the encryption
key can be kept, whereas with KV V2, the HashiCorp Vault Secure Store is able to retrieve
also the historical encryption keys. (Note that the size of the version history is configurable
on the Vault side.) Having access to the previous encryption keys may be critical to avoid
scenarios where the Hot Restart data becomes undecryptable because the master encryption key
is no longer usable (for instance, when the original master encryption key got rotated out
in the Secure Store while the cluster was down).</p>
</div>
<div class="paragraph">
<p>The encryption key is expected to be stored at the specified secret path and represented as a
single key/value pair in the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>name=Base64-encoded-data</code></pre>
</div>
</div>
<div class="paragraph">
<p>where name can be an arbitrary string. Multiple key/value pairs under the same secret path are not
supported. Here is an example of how such a key/value pair can be stored using the HashiCorp
Vault command-line client (under the secret path <code>hz/cluster</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>vault kv put hz/cluster value=HEzO124Vz...</code></pre>
</div>
</div>
<div class="paragraph">
<p>With KV V2, a second <code>put</code> to the same secret path creates a new version of the encryption key.
With KV V1, it simply overwrites the current encryption key, discarding the old value.</p>
</div>
<div class="paragraph">
<p>An example declarative configuration is shown below:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset7_xml"></a>XML</p>
</li>
<li>
<p><a id="tabset7_yaml"></a>YAML</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset7_xml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;secure-store&gt;
    &lt;vault&gt;
        &lt;address&gt;http://localhost:1234&lt;/address&gt;
        &lt;secret-path&gt;secret/path&lt;/secret-path&gt;
        &lt;token&gt;token&lt;/token&gt;
        &lt;polling-interval&gt;60&lt;/polling-interval&gt;
        &lt;ssl&gt;...&lt;/ssl&gt;
    &lt;/vault&gt;
&lt;/secure-store&gt;</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset7_yaml">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">      secure-store:
        vault:
          address: http://localhost:1234
          secret-path: secret/path
          token: token
          polling-interval: 60
          ssl:
            ...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following is an equivalent programmatic configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        VaultSecureStoreConfig vaultConfig =
                new VaultSecureStoreConfig("http://localhost:1234", "secret/path", "token")
                        .setPollingInterval(60);
        configureSSL(vaultConfig.getSSLConfig());</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="1">
  <div class="toc-menu">
  </div>
  </br>
<div id="feedback-prompt">
  <h3>Was this page helpful?</h3>
  <a href="#yes-feedback" id="yes-button"><i class="far fa-check-circle"></i>  Yes </a>
  <a href="#no-feedback" id="no-button"><i class="far fa-times-circle"></i>  No </a>
</div>
<div id="feedback-response">
<p class="feedback-response">Thanks for the feedback!</p>
</div>
<div class="additional-feedback"><a href="https://github.com/JakeSCahill/hazelcast-reference-manual/issues/new?title=Docs: Feedback for Hot Restart Persistence&body=Hi, I have some feedback about [this page](https://github.com/JakeSCahill/hazelcast-reference-manual/edit/docs-poc-v1/docs/modules/storage/pages/hot-restart-persistence.adoc)%0D%0A" class ="git">Report an issue</a></div>
<div class="edit-this-page"><a class="git-pull" href="https://github.com/JakeSCahill/hazelcast-reference-manual/edit/docs-poc-v1/docs/modules/storage/pages/hot-restart-persistence.adoc">Edit this Page</a></div>
</aside>
  </div>
</main>

</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/search.js" id="search-script" data-base-path="../../.." data-page-path="/hazelcast/4.1/storage/hot-restart-persistence.html"></script>
<script async src="../../../_/../search-index.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script async src="../../../_/js/vendor/enlarge-images.js"></script>
  </body>
</html>
