<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Transactions :: Hazelcast Documentation</title>
    <link rel="canonical" href="https://JakeSCahill.github.io/hazelcast/4.1/develop/transactions.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=GTM-M267KFN"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','GTM-M267KFN')</script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://JakeSCahill.github.io">Hazelcast Documentation</a>
        <div class="navbar-item">
          <input id="search-input" type="text" placeholder="Search docs">
        </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Hazelcast IMDG</a>
            <a class="navbar-item" href="#">Hazelcast Jet</a>
            <a class="navbar-item" href="#">Hazelcast Cloud</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Use cases</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Demos</a>
            <a class="navbar-item" href="#">GitHub</a>
            <a class="navbar-item" href="#">Community</a>
            <a class="navbar-item" href="#">Blog</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="hazelcast" data-version="4.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../hazelcast_overview.html">Hazelcast IMDG</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../hazelcast_overview.html">Overview</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../get-started/getting_started.html">Get Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../get-started/glossary.html">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="hazelcast_clients.html">Develop Solutions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="jcache.html">JCache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="performance.html">Performance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="serialization.html">Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="striim_cdc.html">Striim Hot Cache</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="transactions.html">Transactions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="distributed_query.html">Distributed Query</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="distributed_sql.html">Distributed SQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="distributed_events.html">Distributed Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="distributed_computing.html">Distributed Computing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../deploy/installing_upgrading.html">Deploy Clusters</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../deploy/starting_members_clients.html">Starting Members and Clients</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../deploy/setting_up_clusters.html">Setting Up Clusters</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../deploy/management.html">Management</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../deploy/security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../deploy/simulator.html">Hazelcast Simulator</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../deploy/wan.html">WAN Replication</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../deploy/network_partitioning.html">Network Partitioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../migrate/migration_guides.html">Migrate</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../troubleshoot/common_exception_types.html">Troubleshooting</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../reference/faq.html">Reference</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/dds.html">Distributed data structures</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/system_properties.html">System properties</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/understanding_configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/phone_homes.html">Phone homes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/hazelcast_plugins.html">Plugins</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../contribute/extending_hazelcast.html">Contribute</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../contribute/licenses.html">Licenses</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../contribute/revision_history.html">Documentation changes</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Hazelcast IMDG</span>
    <span class="version">4.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Hazelcast IMDG</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../hazelcast_overview.html">4.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../preface.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../hazelcast_overview.html">Hazelcast IMDG</a></li>
    <li><a href="hazelcast_clients.html">Develop Solutions</a></li>
    <li><a href="transactions.html">Transactions</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a class="git" href="https://github.com/JakeSCahill/docs-poc/edit/master/hazelcast-docs/modules/develop/pages/transactions.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Transactions</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains the usage of Hazelcast in a transactional context.
It describes the Hazelcast transaction types and how they work,
how to provide XA (e<strong>X</strong>tended <strong>A</strong>rchiteture) transactions and
how to integrate Hazelcast with J2EE containers.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_a_transaction_interface"><a class="anchor" href="#_creating_a_transaction_interface"></a>Creating a Transaction Interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You create a <code>TransactionContext</code> object to begin, commit and rollback
a transaction. You can obtain transaction-aware instances of queues,
maps, sets, lists and multimaps via <code>TransactionContext</code>, work with
them and commit/rollback in one shot. You can see the TransactionContext API
<a href="https://docs.hazelcast.org/docs/4.1/javadoc/com/hazelcast/transaction/TransactionContext.html" target="_blank" rel="noopener">here</a>.</p>
</div>
<div class="paragraph">
<p>Hazelcast supports two types of transactions: ONE_PHASE and TWO_PHASE.
The type of transaction controls what happens when a member crashes
while a transaction is committing. The default behavior is TWO_PHASE.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ONE_PHASE</strong>: By selecting this transaction type, you execute the
transactions with a single phase that is committing the changes.
Since a preparing phase does not exist, the conflicts are not detected.
When a conflict happens while committing the changes, e.g., due to a
member crash, not all the changes are written and this leaves the
system in an inconsistent state.</p>
</li>
<li>
<p><strong>TWO_PHASE</strong>: When you select this transaction type, Hazelcast
first tries to execute the prepare phase. This phase fails if there
are any conflicts. Once the prepare phase is successful, Hazelcast
executes the commit phase (writing the changes). Before TWO_PHASE
commits, Hazelcast copies the commit log to other members, so in case
of a member failure, another member can complete the commit.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class TransactionalMember {

    public static void main(String[] args) throws Exception {
        HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();

        TransactionOptions options = new TransactionOptions()
                .setTransactionType( TransactionOptions.TransactionType.ONE_PHASE );

        TransactionContext context = hazelcastInstance.newTransactionContext( options );
        context.beginTransaction();

        TransactionalQueue queue = context.getQueue( "myqueue" );
        TransactionalMap map = context.getMap( "mymap" );
        TransactionalSet set = context.getSet( "myset" );

        try {
            Object obj = queue.poll();
            //process obj
            map.put( "1", "value1" );
            set.add( "value" );
            //do other things
            context.commitTransaction();
        } catch ( Throwable t ) {
            context.rollbackTransaction();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a transaction, operations are not executed immediately.
Their changes are local to the <code>TransactionContext</code> until
committed. However, they ensure the changes via locks.</p>
</div>
<div class="paragraph">
<p>For the above example, when <code>map.put</code> is executed, no data
is put in the map but the key is locked against changes.
While committing, operations are executed, the value is put
to the map and the key is unlocked.</p>
</div>
<div class="paragraph">
<p>The isolation level in Hazelcast Transactions is <code>READ_COMMITTED</code>
on the level of a single partition. If you are in a transaction,
you can read the data in your transaction and the data that is
already committed. If you are not in a transaction, you can only
read the committed data.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The REPEATABLE_READ isolation level can also be exercised
using the method <code>getForUpdate()</code> of <code>TransactionalMap</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The isolation levels might be broken if the objects involved
in the transaction span multiple partitions. A reader which is not
in a transaction can then temporarily observe partially committed data.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_queuesetlist_vs_mapmultimap"><a class="anchor" href="#_queuesetlist_vs_mapmultimap"></a>Queue/Set/List vs. Map/Multimap</h3>
<div class="paragraph">
<p>Hazelcast implements queue/set/list operations differently than
map/multimap operations. For queue operations (offer, poll), offered
and/or polled objects are copied to the owner member in order to safely
commit/rollback. For map/multimap, Hazelcast first acquires the locks
for the write operations (put, remove) and holds the differences (what
is added/removed/updated) locally for each transaction. When the
transaction is set to commit, Hazelcast releases the locks and apply
the differences. When rolling back, Hazelcast releases the locks and
discard the differences.</p>
</div>
<div class="paragraph">
<p><code>MapStore</code> and <code>QueueStore</code> do not participate in transactions.
Hazelcast suppresses exceptions thrown by the store in a transaction.
See the <a href="#providing-xa-transactions">XA Transactions section</a> for
further information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_one_phase_vs_two_phase"><a class="anchor" href="#_one_phase_vs_two_phase"></a>ONE_PHASE vs. TWO_PHASE</h3>
<div class="paragraph">
<p>As discussed in <a href="#creating-a-transaction-interface">Creating a Transaction
Interface</a>, when you choose ONE_PHASE as the transaction type, Hazelcast
tracks all changes you make locally in a commit log, i.e., a list of
changes. In this case, all the other members are asked to agree that the
commit can succeed and once they agree, Hazelcast starts to write the changes.
However, if the member that initiates the commit crashes after it has written
to at least one member (but has not completed writing to all other members),
your system may be left in an inconsistent state.</p>
</div>
<div class="paragraph">
<p>On the other hand, if you choose TWO_PHASE as the transaction type, the commit
log is again tracked locally but it is copied to another cluster member.
Therefore, when a failure happens, e.g., the member initiating the commit
crashes, you still have the commit log in another member and that member can
complete the commit. However, copying the commit log to another member makes
the TWO_PHASE approach slow.</p>
</div>
<div class="paragraph">
<p>Consequently, it is recommended that you choose ONE_PHASE as the transaction
type if you want better performance, and that you choose TWO_PHASE if reliability
of your system is more important than the performance.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It should be noted that in split-brain situations or during a member
failure, Hazelcast might not be able to always hold ACID guarantees.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_providing_xa_transactions"><a class="anchor" href="#_providing_xa_transactions"></a>Providing XA Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>XA describes the interface between the global transaction manager and the
local resource manager. XA allows multiple resources (such as databases,
application servers, message queues and transactional caches) to be accessed
within the same transaction, thereby preserving the ACID properties across
applications. XA uses a two-phase commit to ensure that all resources either
commit or rollback any particular transaction consistently (all do the same).</p>
</div>
<div class="paragraph">
<p>When you implement the <code>XAResource</code> interface, Hazelcast provides XA transactions.
You can obtain the <code>HazelcastXAResource</code> instance via the <code>HazelcastInstance getXAResource</code>
method. You can see the HazelcastXAResource API
<a href="https://docs.hazelcast.org/docs/4.1/javadoc/com/hazelcast/transaction/HazelcastXAResource.html" target="_blank" rel="noopener">here</a>.</p>
</div>
<div class="paragraph">
<p>Below is example code that uses JTA API for transaction management.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        cleanAtomikosLogs();

        HazelcastInstance instance = Hazelcast.newHazelcastInstance();
        HazelcastXAResource xaResource = instance.getXAResource();

        UserTransactionManager tm = new UserTransactionManager();
        tm.begin();

        Transaction transaction = tm.getTransaction();
        transaction.enlistResource(xaResource);
        TransactionContext context = xaResource.getTransactionContext();
        TransactionalMap&lt;Object, Object&gt; map = context.getMap("map");
        map.put("key", "val");
        transaction.delistResource(xaResource, XAResource.TMSUCCESS);

        tm.commit();

        IMap&lt;Object, Object&gt; m = instance.getMap("map");
        Object val = m.get("key");
        System.out.println("value: " + val);

        cleanAtomikosLogs();
        Hazelcast.shutdownAll();</code></pre>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<link rel="shortcut icon" href="http://hazelcast.com/images/favicon.png">
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/search.js" id="search-script" data-base-path="../../.." data-page-path="/hazelcast/4.1/develop/transactions.html"></script>
<script async src="../../../_/../search-index.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
