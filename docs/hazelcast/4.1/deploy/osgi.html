<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hazelcast Hazelcast Documentation</title>
    <link rel="canonical" href="https://jakescahill.github.io/docs-poc/hazelcast/4.1/deploy/osgi.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=GTM-M267KFN"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','GTM-M267KFN')</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://jakescahill.github.io/docs-poc">Hazelcast Documentation</a>
          <div class="navbar-item">
            <input id="search-input" type="text" placeholder="Search docs">
          </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Hazelcast Cloud</a>
            <a class="navbar-item" href="https://jakescahill.github.io/docs-poc/hazelcast/4.1/index.html">Hazelcast IMDG</a>
            <a class="navbar-item" href="#">Hazelcast Jet</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Learn</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://jakescahill.github.io/docs-poc/home/index.html">Docs</a>
            <a class="navbar-item" href="https://training.hazelcast.com/">Online Training</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Demos</a>
            <a class="navbar-item" href="#">Community</a>
            <a class="navbar-item" href="#">Blog</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Get Hazelcast</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="hazelcast" data-version="4.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../hazelcast_overview.html">Hazelcast IMDG</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../hazelcast_overview.html">Overview</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../get-started/getting_started.html">Get Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../get-started/glossary.html">Glossary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../develop/hazelcast_clients.html">Develop Solutions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/jcache.html">JCache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/performance.html">Performance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/serialization.html">Serialization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/striim_cdc.html">Striim Hot Cache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/transactions.html">Transactions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/distributed_query.html">Distributed Query</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/distributed_sql.html">Distributed SQL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/distributed_events.html">Distributed Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../develop/distributed_computing.html">Distributed Computing</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="installing_upgrading.html">Deploy Clusters</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="starting_members_clients.html">Starting Members and Clients</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="setting_up_clusters.html">Setting Up Clusters</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="management.html">Management</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="simulator.html">Hazelcast Simulator</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="wan.html">WAN Replication</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="network_partitioning.html">Network Partitioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../migrate/migration_guides.html">Migrate</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../troubleshoot/common_exception_types.html">Troubleshooting</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../reference/faq.html">Reference</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/dds.html">Distributed data structures</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/system_properties.html">System properties</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/understanding_configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/phone_homes.html">Phone homes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/hazelcast_plugins.html">Plugins</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../contribute/extending_hazelcast.html">Contribute</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../contribute/licenses.html">Licenses</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../contribute/revision_history.html">Documentation changes</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Hazelcast IMDG</span>
    <span class="version">4.1</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Hazelcast Cloud</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../hazelcast%20cloud/5/index.html">5</a>
        </li>
        <li class="version">
          <a href="../../../hazelcast%20cloud/4.1/index.html">4.1</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Hazelcast IMDG</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../hazelcast_overview.html">4.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Hazelcast Jet</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../hazelcast%20jet/4.1/index.html">4.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Home</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../home/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../home/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a class="git" href="file:///C:/Users/Jake%20Cahill/Documents/code-playground/docs/hazelcast-docs/modules/deploy/pages/osgi.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="_osgi"><a class="anchor" href="#_osgi"></a>OSGI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains how Hazelcast is supported on OSGI (Open Service Gateway Initiatives) environments.</p>
</div>
<div class="sect2">
<h3 id="_osgi_support"><a class="anchor" href="#_osgi_support"></a>OSGI Support</h3>
<div class="paragraph">
<p>Hazelcast bundles provide OSGI services so that Hazelcast users can
manage (create, access, shutdown) Hazelcast instances through these services on OSGI environments.
When you enable the property <code>hazelcast.osgi.start</code> (default is disabled), when
an Hazelcast OSGI service is activated, a default Hazelcast instance is created automatically.</p>
</div>
<div class="paragraph">
<p>Created Hazelcast instances can be served as an OSGI service that the other Hazelcast bundles can access.
Registering created Hazelcast instances behavior is enabled by default;
you can disable it using the property <code>hazelcast.osgi.register.disabled</code>.</p>
</div>
<div class="paragraph">
<p>Each Hazelcast bundle provides a different OSGI service.
Their instances can be grouped (clustered) together to prevent possible compatibility issues between
different Hazelcast versions/bundles. This grouping behavior is enabled by default and
you disable it using the property <code>hazelcast.osgi.grouping.disabled</code>.</p>
</div>
<div class="paragraph">
<p>Hazelcast OSGI service&#8217;s lifecycle (and the owned/created instances&#8217;s lifecycles) is the same with
the owner Hazelcast bundles. When the bundle is stopped (deactivated), the owned service and
Hazelcast instances are also deactivated/shutdown and deregistered automatically.
When the bundle is re-activated, its service is registered again.</p>
</div>
<div class="paragraph">
<p>The Hazelcast IMDG Enterprise JAR package is also an OSGI bundle like the Hazelcast Open Source JAR package.</p>
</div>
</div>
<div class="sect2">
<h3 id="_api"><a class="anchor" href="#_api"></a>API</h3>
<div class="paragraph">
<p><strong><code>HazelcastOSGiService</code>:</strong> Contract point for Hazelcast services on top of OSGI.
Registered to <code>org.osgi.framework.BundleContext</code> as the OSGI service so the other bundles can
access and use Hazelcast on the OSGI environment through this service.</p>
</div>
<div class="paragraph">
<p><strong><code>HazelcastOSGiInstance</code>:</strong> Contract point for <code>HazelcastInstance</code> implementations based on OSGI service.
<code>HazelcastOSGiService</code> provides proxy Hazelcast instances typed <code>HazelcastOSGiInstance</code> which is
a subtype of <code>HazelcastInstance</code> and these instances delegate all calls to the underlying <code>HazelcastInstance</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_hazelcast_osgi_support"><a class="anchor" href="#_configuring_hazelcast_osgi_support"></a>Configuring Hazelcast OSGI Support</h3>
<div class="paragraph">
<p><code>HazelcastOSGiService</code> uses the following configurations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>hazelcast.osgi.start</code>:</strong> If this property is enabled (it is disabled by default), when an
<code>HazelcastOSGiService</code> is activated, a default Hazelcast instance is created automatically.</p>
</li>
<li>
<p><strong><code>hazelcast.osgi.register.disabled</code>:</strong> If this property is disabled
(it is disabled by default), when a Hazelcast instance is created by
<code>HazelcastOSGiService</code>, the created <code>HazelcastOSGiInstance</code> is registered automatically as
OSGI service with type of <code>HazelcastOSGiInstance</code> and it is deregistered automatically when
the created <code>HazelcastOSGiInstance</code> is shutdown.</p>
</li>
<li>
<p><strong><code>hazelcast.osgi.grouping.disabled</code>:</strong> If this property is disabled
(it is disabled by default), every created <code>HazelcastOSGiInstance</code> is grouped as
their owner <code>HazelcastOSGiService</code> and do not join each other unless no cluster name is specified in the <code>Config</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_design"><a class="anchor" href="#_design"></a>Design</h3>
<div class="paragraph">
<p><code>HazelcastOSGiService</code> is specific to each Hazelcast bundle. This means that
every Hazelcast bundle has its own <code>HazelcastOSGiService</code> instance.</p>
</div>
<div class="paragraph">
<p>Every Hazelcast bundle registers its <code>HazelcastOSGiService</code> instances via
Hazelcast Bundle Activator (<code>com.hazelcast.osgi.impl.Activator</code>) while they are being started,
and it deregisters its <code>HazelcastOSGiService</code> instances while they are being stopped.</p>
</div>
<div class="paragraph">
<p>Each <code>HazelcastOSGiService</code> instance has a different service ID as the combination of
Hazelcast version and artifact type (<code>OSS</code> or <code>EE</code>). Examples are <code>3.6#OSS</code>, <code>3.6#EE</code>, <code>3.7#OSS</code>, <code>3.7#EE</code>, etc.</p>
</div>
<div class="paragraph">
<p><code>HazelcastOSGiService</code> instance lifecycle is the same with the owner Hazelcast bundle.
This means that when the owner bundle is deactivated, the owned <code>HazelcastOSGiService</code> instance is
deactivated, and all active Hazelcast instances that are created and served by
that <code>HazelcastOSGiService</code> instance are also shutdown and deregistered.
When the Hazelcast bundle is re-activated, its <code>HazelcastOSGiService</code> instance is registered again as the OSGI service.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/Design.png" alt="OSGI Design"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_using_hazelcast_osgi_service"><a class="anchor" href="#_using_hazelcast_osgi_service"></a>Using Hazelcast OSGI Service</h3>
<div class="sect3">
<h4 id="_getting_hazelcast_osgi_service_instances"><a class="anchor" href="#_getting_hazelcast_osgi_service_instances"></a>Getting Hazelcast OSGI Service Instances</h4>
<div class="paragraph">
<p>You can access all <code>HazelcastOSGiService</code> instances through <code>org.osgi.framework.BundleContext</code> for each Hazelcast bundle as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">for (ServiceReference serviceRef : context.getServiceReferences(HazelcastOSGiService.class.getName(), null)) {
    HazelcastOSGiService service = (HazelcastOSGiService) context.getService(serviceRef);
    String serviceId = service.getId();
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_managing_and_using_hazelcast_instances"><a class="anchor" href="#_managing_and_using_hazelcast_instances"></a>Managing and Using Hazelcast instances</h4>
<div class="paragraph">
<p>You can use <code>HazelcastOSGiService</code> instance to create and shutdown Hazelcast instances on OSGI environments.
The created Hazelcast instances are <code>HazelcastOSGiInstance</code> typed (which is sub-type of <code>HazelcastInstance</code>) and
are just proxies to the underlying Hazelcast instance. There are several methods in <code>HazelcastOSGiService</code> to use
Hazelcast instances on OSGI environments as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Get the default Hazelcast instance owned by `hazelcastOsgiService`
// Returns null if `HAZELCAST_OSGI_START` is not enabled
HazelcastOSGiInstance defaultInstance = hazelcastOsgiService.getDefaultHazelcastInstance();


// Creates a new Hazelcast instance with default configurations as owned by `hazelcastOsgiService`
HazelcastOSGiInstance newInstance1 = hazelcastOsgiService.newHazelcastInstance();


// Creates a new Hazelcast instance with specified configuration as owned by `hazelcastOsgiService`
Config config = new Config();
config.setInstanceName("OSGI-Instance");
...
HazelcastOSGiInstance newInstance2 = hazelcastOsgiService.newHazelcastInstance(config);

// Gets the Hazelcast instance with the name `OSGI-Instance`, which is `newInstance2` created above
HazelcastOSGiInstance instance = hazelcastOsgiService.getHazelcastInstanceByName("OSGI-Instance");

// Shuts down the Hazelcast instance with name `OSGI-Instance`, which is `newInstance2`
hazelcastOsgiService.shutdownHazelcastInstance(instance);

// Print all active Hazelcast instances owned by `hazelcastOsgiService`
for (HazelcastOSGiInstance instance : hazelcastOsgiService.getAllHazelcastInstances()) {
    System.out.println(instance);
}

// Shuts down all Hazelcast instances owned by `hazelcastOsgiService`
hazelcastOsgiService.shutdownAll();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<link rel="shortcut icon" href="http://hazelcast.com/images/favicon.png">
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/search.js" id="search-script" data-base-path="../../.." data-page-path="/hazelcast/4.1/deploy/osgi.html"></script>
<script async src="../../../_/../search-index.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
